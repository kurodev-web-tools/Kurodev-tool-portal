(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[762],{2589:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>ei});var l=a(18841),r=a(58669),t=a(28198),i=a(33544),n=a(77902),c=a(98356),o=a(59172),d=a(17550),m=a(20791),x=a(43210),h=a(6166),u=a(74843),j=a(65939),p=a(98156),v=a(84731),g=a(14967),f=a(24156),b=a(2570),N=a(44166),w=a(10768),y=a(87570),A=a(63627),k=a(5081),C=a(23254),S=a(30897),P=a(7934),E=a(83199);let D={string:E.YjP().min(1,"必須項目です"),optionalString:E.YjP().optional(),email:E.YjP().email("有効なメールアドレスを入力してください"),password:E.YjP().min(8,"パスワードは8文字以上で入力してください").regex(/^(?=.*[a-zA-Z])(?=.*\d)/,"英数字を含むパスワードを入力してください"),phone:E.YjP().regex(/^0\d{1,4}-\d{1,4}-\d{4}$/,"有効な電話番号を入力してください（例: 03-1234-5678）"),url:E.YjP().url("有効なURLを入力してください"),number:E.aig().min(0,"0以上の数値を入力してください"),positiveInteger:E.aig().int().positive("正の整数を入力してください"),date:E.YjP().regex(/^\d{4}-\d{2}-\d{2}$/,"有効な日付を入力してください（YYYY-MM-DD）"),datetime:E.YjP().datetime("有効な日時を入力してください"),file:E.Nlp(File,{message:"ファイルを選択してください"}),imageFile:E.Nlp(File).refine(e=>e.type.startsWith("image/"),"画像ファイルを選択してください").refine(e=>e.size<=5242880,"ファイルサイズは5MB以下にしてください")};E.YjP().min(1,"ツールIDは必須です"),E.YjP().min(1,"タイトルは必須です").max(100,"タイトルは100文字以内で入力してください"),E.YjP().min(1,"説明は必須です").max(500,"説明は500文字以内で入力してください"),E.k5n(["released","beta","development"],{message:"有効なステータスを選択してください"}),E.k5n(["planning","production","branding","collaboration"],{message:"有効なカテゴリを選択してください"}),E.YjP().url("有効なURLを入力してください"),E.YOg(E.YjP().min(1,"タグは空にできません")).optional();let z={username:E.YjP().min(2,"ユーザー名は2文字以上で入力してください").max(20,"ユーザー名は20文字以内で入力してください").regex(/^[a-zA-Z0-9_]+$/,"ユーザー名は英数字とアンダースコアのみ使用できます"),displayName:E.YjP().min(1,"表示名は必須です").max(50,"表示名は50文字以内で入力してください"),profile:E.YjP().max(1e3,"プロフィールは1000文字以内で入力してください").optional()};E.YjP().min(1,"検索キーワードを入力してください").max(100,"検索キーワードは100文字以内で入力してください"),E.aig().int().min(1,"ページ番号は1以上である必要があります"),E.aig().int().min(1).max(100,"ページサイズは1-100の範囲で設定してください"),E.k5n(["asc","desc"],{message:"有効なソート順を選択してください"}),E.Ikc({email:D.email,password:E.YjP().min(1,"パスワードは必須です"),remember:E.zMY().optional()}),E.Ikc({email:D.email,password:D.password,confirmPassword:E.YjP(),username:z.username,displayName:z.displayName,agreeToTerms:E.zMY().refine(e=>!0===e,"利用規約に同意してください")}).refine(e=>e.password===e.confirmPassword,{message:"パスワードが一致しません",path:["confirmPassword"]}),E.Ikc({displayName:z.displayName,profile:z.profile,email:D.email.optional()}),E.Ikc({currentPassword:E.YjP().min(1,"現在のパスワードは必須です"),newPassword:D.password,confirmPassword:E.YjP()}).refine(e=>e.newPassword===e.confirmPassword,{message:"新しいパスワードが一致しません",path:["confirmPassword"]});let $=[{id:"analyze",label:"プロンプトを分析中...",estimatedSeconds:3},{id:"prepare",label:"生成パラメータを設定中...",estimatedSeconds:2},{id:"generate",label:"画像を生成中...",estimatedSeconds:10},{id:"process",label:"画像を処理中...",estimatedSeconds:3},{id:"complete",label:"完成！",estimatedSeconds:0}];var R=a(49907),J=a(42542),I=a(22215),L=a(74486),F=a(75359),U=a(77463),B=a(64248),O=a(23473),M=a(79706),Y=a(58935),T=a(81052),V=a(50742),G=a(49752),_=a(39823),K=a(77019),W=a(42990),X=a(93749),Z=a(69522),q=a(45185),Q=a(57870),H=a(34454),ee=a(62663),es=a(21516),ea=a(70381),el=a(53333),er=a(60860);let et=e=>{let{steps:s,currentStepId:a,estimatedTimeRemaining:r,onCancel:i}=e,n=a?s.findIndex(e=>e.id===a):-1,c=n>=0?(n+1)/s.length*100:0;return(0,l.jsx)("div",{className:"w-full space-y-6",children:(0,l.jsxs)("div",{className:"w-full h-full bg-[#2D2D2D] rounded-md flex flex-col items-center justify-center text-center p-8 min-h-[300px]",children:[(0,l.jsx)(o.A,{className:"w-16 h-16 text-primary mb-6 animate-spin","aria-hidden":"true"}),(0,l.jsx)("h3",{className:"text-xl font-semibold text-[#E0E0E0] mb-2",children:"背景を生成中..."}),(0,l.jsxs)("div",{className:"w-full max-w-md mt-6",children:[(0,l.jsx)("div",{className:"w-full h-2 bg-[#1A1A1A] rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-primary transition-all duration-500 ease-out rounded-full",style:{width:"".concat(c,"%")}})}),(0,l.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,l.jsx)("p",{className:"text-sm text-[#A0A0A0] text-center flex-1",children:n>=0&&n<s.length?s[n].label:"準備中..."}),void 0!==r&&r>0&&(0,l.jsxs)("p",{className:"text-sm text-[#A0A0A0] ml-4",children:["残り約",(e=>{if(e<60)return"".concat(Math.ceil(e),"秒");let s=Math.floor(e/60),a=Math.ceil(e%60);return"".concat(s,"分").concat(a,"秒")})(r)]})]})]}),(0,l.jsx)("div",{className:"w-full max-w-2xl mt-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between relative",children:[(0,l.jsx)("div",{className:"absolute top-5 left-0 right-0 h-0.5 bg-[#4A4A4A] -z-10"}),(0,l.jsx)("div",{className:"absolute top-5 left-0 h-0.5 bg-primary transition-all duration-500 ease-out -z-10",style:{width:"".concat(c,"%")}}),s.map((e,s)=>{let a=n>=s,r=n===s;return(0,l.jsxs)("div",{className:"flex flex-col items-center relative z-10 flex-1",children:[(0,l.jsx)("div",{className:(0,el.cn)("w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all duration-300",r?"bg-primary border-primary scale-110 shadow-lg shadow-primary/50":a?"bg-primary/20 border-primary":"bg-[#1A1A1A] border-[#4A4A4A]"),children:r?(0,l.jsx)(o.A,{className:"w-5 h-5 text-white animate-spin"}):a?(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-primary"}):(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-[#4A4A4A]"})}),(0,l.jsx)("p",{className:(0,el.cn)("text-xs mt-2 text-center max-w-[100px] transition-colors duration-300",r?"text-primary font-semibold":a?"text-[#E0E0E0]":"text-[#4A4A4A]"),children:e.label})]},e.id)})]})}),i&&n>=0&&n<s.length-1&&(0,l.jsxs)(t.$,{variant:"outline",onClick:i,className:"mt-6 border-red-500/50 text-red-400 hover:bg-red-500/10",children:[(0,l.jsx)(J.A,{className:"h-4 w-4 mr-2"}),"生成をキャンセル"]})]})})};function ei(){var e,s,a,E,D;let{isOpen:z,setIsOpen:ei,isDesktop:en}=(0,S.c)({defaultOpen:!0,desktopDefaultOpen:!0}),[ec,eo]=(0,r.useState)("generate"),[ed,em]=(0,r.useState)(!0),[ex,eh]=(0,r.useState)(!1),[eu,ej]=(0,r.useState)(!1),ep=(0,r.useRef)(null),ev=(0,r.useCallback)(()=>{en||em(e=>!e&&e)},[en]),eg=(0,r.useCallback)(()=>{em(e=>!e)},[]);(0,r.useEffect)(()=>{if(!en&&ep.current){let e=()=>{let e=ep.current;e&&(eh(e.scrollLeft>0),ej(e.scrollLeft<e.scrollWidth-e.clientWidth-1))};e();let s=ep.current;return s.addEventListener("scroll",e),window.addEventListener("resize",e),()=>{s.removeEventListener("scroll",e),window.removeEventListener("resize",e)}}},[en,ec]);let{isGenerating:ef,generationStep:eb,estimatedTimeRemaining:eN,generate:ew,cancel:ey}=function(){let[e,s]=(0,r.useState)(!1),[a,l]=(0,r.useState)(null),[t,i]=(0,r.useState)(0),n=(0,r.useRef)(null),c=(0,r.useCallback)((e,s)=>new Promise((a,l)=>{if(s.aborted)return void l(Error("Aborted"));let r=setTimeout(()=>{s.aborted?l(Error("Aborted")):a()},e);s.addEventListener("abort",()=>{clearTimeout(r),l(Error("Aborted"))})}),[]);return{isGenerating:e,generationStep:a,estimatedTimeRemaining:t,generate:(0,r.useCallback)(async e=>{let{prompt:a,negativePrompt:r,category:t,style:o,resolution:d,color:m,imageCount:x,onImagesGenerated:h,onHistoryAdd:u,onAutoTag:p,onExpandPreview:v,onError:g}=e,b=a&&0!==a.trim().length?a.length>1e3?"プロンプトは1000文字以内で入力してください":null:"プロンプトを入力してください";if(b){f.vF.error("バリデーションエラー",{error:b},"useBackgroundGeneration"),j.oR.error("プロンプトの検証エラー",{description:b}),g&&g(Error(b));return}s(!0),null==v||v();let N=new AbortController;n.current=N;let w=N.signal;l(null),i(0);try{for(let e=0;e<$.length;e++){if(w.aborted)return;let s=$[e];l(s.id);let a=$.slice(e),r=a.reduce((e,s)=>e+(s.estimatedSeconds||0),0);i(r);let t=1e3*(s.estimatedSeconds||1),n=Date.now(),o=setInterval(()=>{if(w.aborted)return void clearInterval(o);let e=(Date.now()-n)/1e3,l=Math.max(0,(s.estimatedSeconds||1)-e+a.slice(1).reduce((e,s)=>e+(s.estimatedSeconds||0),0));i(l)},100);try{await c(t,w)}catch(e){if(clearInterval(o),e instanceof Error&&"Aborted"===e.message)return;throw e}if(clearInterval(o),w.aborted)return}if(w.aborted)return;let e=Array.from({length:parseInt(x)},(e,s)=>({id:"img-".concat(Date.now(),"-").concat(s),url:"https://picsum.photos/800/600?random=".concat(Date.now()+s),prompt:a||"",negativePrompt:r||void 0,category:t||void 0,style:o||void 0,resolution:d||void 0,color:m||void 0,createdAt:Date.now(),downloadCount:0}));h(e),u&&e.forEach(e=>{u({url:e.url,prompt:e.prompt,negativePrompt:e.negativePrompt,category:e.category,style:e.style,resolution:e.resolution,color:e.color})}),p&&e.forEach(e=>{p(e.id,e)}),j.oR.success("".concat(x,"枚の背景を生成しました"),{description:"生成が完了しました"}),l(null),i(0)}catch(e){if(e instanceof Error&&"Aborted"===e.message)return;throw f.vF.error("背景生成中にエラーが発生しました",e,"useBackgroundGeneration"),g&&g(e instanceof Error?e:Error("Unknown error")),e}finally{s(!1),n.current=null}},[c]),cancel:(0,r.useCallback)(()=>{n.current&&(n.current.abort(),n.current=null),s(!1),l(null),i(0),j.oR.info("生成をキャンセルしました")},[])}}(),[eA,ek]=(0,r.useState)(""),[eC,eS]=(0,r.useState)(""),[eP,eE]=(0,r.useState)(""),[eD,ez]=(0,r.useState)(""),[e$,eR]=(0,r.useState)(""),[eJ,eI]=(0,r.useState)("1"),[eL,eF]=(0,r.useState)(""),[eU,eB]=(0,r.useState)([]),[eO,eM]=(0,r.useState)(null),[eY,eT]=(0,r.useState)("grid"),[eV,eG]=(0,r.useState)("newest"),[e_,eK]=(0,r.useState)(null),[eW,eX]=(0,r.useState)(new Set),[eZ,eq]=(0,r.useState)(!1),[eQ,eH]=(0,r.useState)([]),[e0,e1]=(0,r.useState)([]),[e4,e2]=(0,r.useState)(!1),e3="virtual-bg-saved-prompts",[e5,e8]=(0,r.useState)(""),[e6,e9]=(0,r.useState)([]),[e7,se]=(0,r.useState)([]),[ss,sa]=(0,r.useState)(""),[sl,sr]=(0,r.useState)(""),[st,si]=(0,r.useState)("relevance"),[sn,sc]=(0,r.useState)([]),[so,sd]=(0,r.useState)(1),[sm,sx]=(0,r.useState)(1),[sh,su]=(0,r.useState)(!1),[sj,sp]=(0,r.useState)("medium"),[sv,sg]=(0,r.useState)("relevance"),[sf,sb]=(0,r.useState)(!0),[sN,sw]=(0,r.useState)([]),sy="virtual-bg-saved-search-conditions",sA=(0,r.useRef)(null),sk=(0,r.useRef)(null),sC="virtual-bg-history",[sS,sP]=(0,r.useState)([]),[sE,sD]=(0,r.useState)("all"),[sz,s$]=(0,r.useState)(""),[sR,sJ]=(0,r.useState)(100),sI="virtual-bg-collections",sL="virtual-bg-image-tags",[sF,sU]=(0,r.useState)([]),[sB,sO]=(0,r.useState)(new Map),[sM,sY]=(0,r.useState)([]),[sT,sV]=(0,r.useState)(null),[sG,s_]=(0,r.useState)(!1),[sK,sW]=(0,r.useState)(null),[sX,sZ]=(0,r.useState)(""),[sq,sQ]=(0,r.useState)(""),{handleAsyncError:sH}=(0,P.u)(),s0=[{value:"fantasy",label:"ファンタジー",icon:"\uD83E\uDDD9‍♀️"},{value:"sci-fi",label:"SF",icon:"\uD83D\uDE80"},{value:"daily",label:"日常",icon:"\uD83C\uDFE0"},{value:"nature",label:"自然",icon:"\uD83C\uDF3F"},{value:"urban",label:"都市",icon:"\uD83C\uDFD9️"},{value:"space",label:"宇宙",icon:"\uD83C\uDF0C"}],s1=[{value:"anime",label:"アニメ風"},{value:"oil-painting",label:"油絵風"},{value:"watercolor",label:"水彩画風"},{value:"realistic",label:"リアル"},{value:"cartoon",label:"カートゥーン風"},{value:"minimalist",label:"ミニマル"}],s4=[{value:"1920x1080",label:"1920x1080 (16:9)",aspectRatio:"16:9"},{value:"3840x2160",label:"3840x2160 (4K)",aspectRatio:"16:9"},{value:"1080x1920",label:"1080x1920 (9:16)",aspectRatio:"9:16"},{value:"2560x1440",label:"2560x1440 (16:9)",aspectRatio:"16:9"},{value:"1280x720",label:"1280x720 (16:9)",aspectRatio:"16:9"}],s2=[{value:"1",label:"1枚"},{value:"2",label:"2枚"},{value:"4",label:"4枚"},{value:"8",label:"8枚"}],s3=[{value:"",label:"指定なし",color:"bg-gray-500"},{value:"red",label:"赤",color:"bg-red-500"},{value:"orange",label:"オレンジ",color:"bg-orange-500"},{value:"yellow",label:"黄",color:"bg-yellow-500"},{value:"green",label:"緑",color:"bg-green-500"},{value:"blue",label:"青",color:"bg-blue-500"},{value:"purple",label:"紫",color:"bg-purple-500"},{value:"pink",label:"ピンク",color:"bg-pink-500"},{value:"brown",label:"茶",color:"bg-amber-700"},{value:"black",label:"黒",color:"bg-gray-900"},{value:"white",label:"白",color:"bg-gray-100"}],s5=(0,r.useMemo)(()=>({fantasy:["魔法の森、妖精が舞い踊る神秘的な場所","中世の城、石造りの壮麗な建築物","空に浮かぶ島、雲海の上に広がる異世界"],"sci-fi":["サイバーパンク都市の夜景、ネオンライトが輝く未来都市","宇宙ステーション、星々を見下ろす軌道上の施設","ロボット工場、機械が稼働する未来的な施設"],daily:["コーヒーショップ、温かみのある日常の空間","図書館、本棚が並ぶ静かな読書空間","リビングルーム、くつろぎの家庭空間"],nature:["山頂からの眺め、雲海に浮かぶ山々","森の中の小道、陽光が差し込む緑豊かな道","海辺の夕日、オレンジに染まる水平線"],urban:["大都市の摩天楼、高層ビルが林立する街","商店街の夜景、看板が輝く賑やかな通り","公園のベンチ、都会の中の憩いの場所"],space:["銀河系の中心、星雲が渦巻く宇宙空間","惑星の表面、異世界の風景が広がる大地","星間空間、無数の星が輝く深宇宙"]}),[]);(0,r.useEffect)(()=>{let e=(0,er.GJ)(e3);e&&Array.isArray(e)&&e1(e.filter(e=>"object"==typeof e&&null!==e).map(e=>{var s,a,l;return{id:String(null!=(s=e.id)?s:""),prompt:String(null!=(a=e.prompt)?a:""),negativePrompt:e.negativePrompt?String(e.negativePrompt):void 0,createdAt:Number(null!=(l=e.createdAt)?l:Date.now())}}).filter(e=>e.prompt))},[]);let s8=(0,r.useCallback)(()=>{if(!eA.trim())return void j.oR.error("プロンプトが空です");e2(!0);let e=[{id:Date.now().toString(),prompt:eA.trim(),negativePrompt:eC.trim()||void 0,createdAt:Date.now()},...e0].slice(0,20);e1(e);try{(0,er.PX)(e3,e),j.oR.success("プロンプトを保存しました")}catch(e){f.vF.error("プロンプト保存失敗",e,"VirtualBgGenerator"),j.oR.error("プロンプトの保存に失敗しました")}e2(!1)},[eA,eC,e0]),s6=(0,r.useCallback)(e=>{ek(e.prompt),eS(e.negativePrompt||""),j.oR.success("プロンプトを読み込みました")},[]),s9=(0,r.useCallback)(e=>{let s=e0.filter(s=>s.id!==e);e1(s);try{(0,er.PX)(e3,s),j.oR.success("プロンプトを削除しました")}catch(e){f.vF.error("プロンプト削除失敗",e,"VirtualBgGenerator")}},[e0]),s7=(0,r.useCallback)(e=>{ek(e),j.oR.success("テンプレートを適用しました")},[]),ae=(0,r.useCallback)(()=>{ey()},[ey]),as=(0,r.useCallback)((e,s)=>{let a=[];s.category&&a.push("category:".concat(s.category)),s.style&&a.push("style:".concat(s.style)),s.color&&a.push("color:".concat(s.color)),s.resolution&&a.push("resolution:".concat(s.resolution)),a.length>0&&(sO(s=>{let l=new Map(s),r=[...new Set([...l.get(e)||[],...a])];return l.set(e,r),l}),sY(e=>{let s=new Map(e.map(e=>[e.id,e]));return a.forEach(e=>{s.has(e)||s.set(e,{id:e,label:e,color:void 0})}),Array.from(s.values())}),j.oR.success("".concat(a.length,"個のタグを自動追加しました")))},[]),aa=(0,r.useCallback)(async()=>{try{await navigator.clipboard.writeText(eA),eq(!0),setTimeout(()=>eq(!1),2e3)}catch(e){f.vF.error("コピー失敗",e,"VirtualBgGenerator")}},[eA]),al=(0,r.useCallback)(e=>{eH(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},[]),ar=(0,r.useCallback)(async e=>{try{let s=await fetch(e),a=await s.blob(),l=window.URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download="virtual-background-".concat(Date.now(),".jpg"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(l),eB(s=>s.map(s=>s.url===e?{...s,downloadCount:(s.downloadCount||0)+1}:s))}catch(a){f.vF.error("ダウンロードエラー",a,"VirtualBgGenerator");let s=document.createElement("a");s.href=e,s.download="virtual-background-".concat(Date.now(),".jpg"),s.target="_blank",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},[]),at=(0,r.useCallback)(async()=>{if(0===eW.size)return;let e=eU.filter(e=>eW.has(e.id));for(let s of e)await ar(s.url),await new Promise(e=>setTimeout(e,100));j.oR.success("".concat(e.length,"枚の画像をダウンロードしました")),eX(new Set)},[eW,eU,ar]),ai=(0,r.useMemo)(()=>{let e=[...eU];switch(eV){case"newest":return e.sort((e,s)=>s.createdAt-e.createdAt);case"oldest":return e.sort((e,s)=>e.createdAt-s.createdAt);case"favorite":return e.sort((e,s)=>{let a=eQ.includes(e.url);return a===eQ.includes(s.url)?s.createdAt-e.createdAt:a?-1:1});case"download":return e.sort((e,s)=>(s.downloadCount||0)-(e.downloadCount||0));default:return e}},[eU,eV,eQ]),an=(0,r.useCallback)(e=>{eX(s=>{let a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})},[]),ac=(0,r.useCallback)(()=>{eW.size===ai.length?eX(new Set):eX(new Set(ai.map(e=>e.id)))},[eW.size,ai]),ao=async()=>{su(!0),await sH(async()=>{await new Promise(e=>setTimeout(e,1e3));let e=[...Array.from({length:50},(e,s)=>({id:"search-".concat(Date.now(),"-").concat(s),url:"https://picsum.photos/400/300?random=".concat(Date.now()+s),title:"検索結果 ".concat(s+1),category:s0[s%s0.length].value,color:["red","blue","green","purple","orange"][s%5],resolution:"1920x1080",license:"free",downloads:Math.floor(1e3*Math.random()),createdAt:Date.now()-1e3*s*3600,relevanceScore:Math.random()}))];switch(sv){case"relevance":e.sort((e,s)=>(s.relevanceScore||0)-(e.relevanceScore||0));break;case"popular":e.sort((e,s)=>(s.downloads||0)-(e.downloads||0));break;case"newest":e.sort((e,s)=>(s.createdAt||0)-(e.createdAt||0));break;case"oldest":e.sort((e,s)=>(e.createdAt||0)-(s.createdAt||0))}sc(e),sd(1),sx(Math.ceil(e.length/8)),e.length>0&&aS({url:e[0].url},"search")},"検索中にエラーが発生しました"),su(!1)},ad=(0,r.useCallback)(()=>{let e=window.prompt("検索条件の名前を入力してください:");if(!e||!e.trim())return;let s={id:"search-condition-".concat(Date.now()),name:e.trim(),keyword:e5||void 0,categories:e6.length>0?e6:void 0,colors:e7.length>0?e7:void 0,resolution:ss||void 0,license:sl||void 0,createdAt:Date.now()};sw(e=>[...e,s].slice(-10)),j.oR.success("検索条件を保存しました")},[e5,e6,e7,ss,sl]),am=(0,r.useCallback)(e=>{e8(e.keyword||""),e9(e.categories||[]),se(e.colors||[]),sa(e.resolution||""),sr(e.license||""),j.oR.success("検索条件を適用しました")},[]),ax=(0,r.useCallback)(e=>{sw(s=>s.filter(s=>s.id!==e)),j.oR.success("検索条件を削除しました")},[]),ah=(0,r.useCallback)(()=>{try{let e=sn.map(e=>e.url).join("\n"),s=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="virtual-bg-search-results-".concat(new Date().toISOString().split("T")[0],".txt"),l.click(),URL.revokeObjectURL(a),j.oR.success("検索結果をエクスポートしました")}catch(e){f.vF.error("エクスポートエラー",e,"VirtualBgGenerator"),j.oR.error("エクスポートに失敗しました")}},[sn]),au=(0,r.useCallback)(()=>{sW(null),sZ(""),sQ(""),s_(!0)},[]),aj=(0,r.useCallback)(()=>{if(!sX.trim())return void j.oR.error("コレクション名を入力してください");if(sK)sU(e=>e.map(e=>e.id===sK.id?{...e,name:sX.trim(),description:sq.trim()||void 0,updatedAt:Date.now()}:e)),j.oR.success("コレクションを更新しました");else{let e={id:"collection-".concat(Date.now()),name:sX.trim(),description:sq.trim()||void 0,imageIds:[],createdAt:Date.now(),updatedAt:Date.now()};sU(s=>[...s,e]),j.oR.success("コレクションを作成しました")}s_(!1)},[sX,sq,sK]),ap=(0,r.useCallback)(e=>{window.confirm("このコレクションを削除しますか？")&&(sU(s=>s.filter(s=>s.id!==e)),sT===e&&sV(null),j.oR.success("コレクションを削除しました"))},[sT]),av=(0,r.useCallback)(e=>{sW(e),sZ(e.name),sQ(e.description||""),s_(!0)},[]),ag=(0,r.useCallback)((e,s)=>{sU(a=>a.map(a=>a.id!==s||a.imageIds.includes(e)?a:{...a,imageIds:[...a.imageIds,e],updatedAt:Date.now()})),j.oR.success("コレクションに追加しました")},[]),af=(0,r.useCallback)((e,s)=>{sU(a=>a.map(a=>a.id===s?{...a,imageIds:a.imageIds.filter(s=>s!==e),updatedAt:Date.now()}:a)),j.oR.success("コレクションから削除しました")},[]);(0,r.useCallback)((e,s)=>{let a=s.trim().toLowerCase();a&&(sO(s=>{let l=new Map(s),r=l.get(e)||[];return r.includes(a)||l.set(e,[...r,a]),l}),sY(e=>e.find(e=>e.id===a)?e:[...e,{id:a,label:s.trim(),color:void 0}]),j.oR.success("タグを追加しました"))},[]),(0,r.useCallback)((e,s)=>{sO(a=>{let l=new Map(a),r=l.get(e)||[];return l.set(e,r.filter(e=>e!==s)),l}),j.oR.success("タグを削除しました")},[]);let ab=(0,r.useMemo)(()=>{if(!sT)return[];let e=sF.find(e=>e.id===sT);return e?eU.filter(s=>e.imageIds.includes(s.id)):[]},[sT,sF,eU]),aN=(0,r.useCallback)(async e=>{let s=sF.find(s=>s.id===e);if(s)try{let e=eU.filter(e=>s.imageIds.includes(e.id)),a=e.map(e=>e.url).join("\n"),l={collectionName:s.name,description:s.description,imageCount:e.length,exportedAt:new Date().toISOString(),images:e.map(e=>({id:e.id,url:e.url,prompt:e.prompt,category:e.category,style:e.style,resolution:e.resolution}))},r="コレクション: ".concat(s.name,"\n")+"".concat(s.description?"説明: ".concat(s.description,"\n"):"")+"画像数: ".concat(e.length,"\n")+"エクスポート日時: ".concat(new Date().toLocaleString("ja-JP"),"\n\n")+"=== メタデータ ===\n".concat(JSON.stringify(l,null,2),"\n\n")+"=== URL一覧 ===\n".concat(a),t=new Blob([r],{type:"text/plain"}),i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download="collection-".concat(s.name,"-").concat(new Date().toISOString().split("T")[0],".txt"),n.click(),URL.revokeObjectURL(i),j.oR.success("コレクションをエクスポートしました")}catch(e){f.vF.error("コレクションエクスポートエラー",e,"VirtualBgGenerator"),j.oR.error("エクスポートに失敗しました")}},[sF,eU]),aw=e=>{e9(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},ay=e=>{se(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},aA=e=>{eM(e),eB([{id:"search-".concat(Date.now()),url:e,prompt:e5||"",createdAt:Date.now(),downloadCount:0}]),en||eo("preview")},ak=e=>{sd(e)};(0,r.useEffect)(()=>{if(!sf||!sk.current){sA.current&&sk.current&&(sA.current.unobserve(sk.current),sA.current=null);return}return sA.current=new IntersectionObserver(e=>{e[0].isIntersecting&&!sh&&sn.length>0&&(su(!0),sH(async()=>{await new Promise(e=>setTimeout(e,500));let e=Array.from({length:10},(e,s)=>({id:"search-".concat(Date.now(),"-").concat(sn.length+s),url:"https://picsum.photos/400/300?random=".concat(Date.now()+sn.length+s),title:"検索結果 ".concat(sn.length+s+1),category:s0[(sn.length+s)%s0.length].value,color:["red","blue","green","purple","orange"][(sn.length+s)%5],resolution:"1920x1080",license:"free",downloads:Math.floor(1e3*Math.random()),createdAt:Date.now()-(sn.length+s)*36e5,relevanceScore:Math.random()}));sc(s=>[...s,...e]),su(!1)},"追加読み込み中にエラーが発生しました"))},{threshold:.1}),sk.current&&sA.current.observe(sk.current),()=>{sA.current&&sk.current&&sA.current.unobserve(sk.current)}},[sf,sh,sn.length,sH,s0]);let aC=(0,r.useMemo)(()=>{switch(sj){case"small":return"grid-cols-3 gap-1.5";case"medium":default:return"grid-cols-2 gap-2";case"large":return"grid-cols-1 gap-3"}},[sj]);(0,r.useEffect)(()=>{let e=(0,er.GJ)(sI);e&&Array.isArray(e)&&sU(e.filter(e=>"object"==typeof e&&null!==e).map(e=>{var s,a,l,r;return{...e,id:String(null!=(s=e.id)?s:""),name:String(null!=(a=e.name)?a:""),description:e.description?String(e.description):void 0,imageIds:Array.isArray(e.imageIds)?e.imageIds.map(e=>String(e)):[],tags:Array.isArray(e.tags)?e.tags.map(e=>String(e)):void 0,createdAt:Number(null!=(l=e.createdAt)?l:Date.now()),updatedAt:Number(null!=(r=e.updatedAt)?r:Date.now())}}).filter(e=>e.id&&e.name));let s=(0,er.GJ)(sL);if(s&&"object"==typeof s){let e=new Map;Object.entries(s).forEach(s=>{let[a,l]=s;Array.isArray(l)&&e.set(a,l.map(e=>String(e)))}),sO(e);let a=new Map;e.forEach(e=>{e.forEach(e=>{a.has(e)||a.set(e,{id:e,label:e,color:void 0})})}),sY(Array.from(a.values()))}},[]),(0,r.useEffect)(()=>{try{(0,er.PX)(sI,sF);let e={};sB.forEach((s,a)=>{e[a]=s}),(0,er.PX)(sL,e)}catch(e){f.vF.error("コレクション・タグの保存エラー",e,"VirtualBgGenerator")}},[sF,sB]),(0,r.useEffect)(()=>{let e=(0,er.GJ)(sy);e&&Array.isArray(e)&&sw(e.filter(e=>"object"==typeof e&&null!==e).map(e=>{var s,a,l;return{id:String(null!=(s=e.id)?s:""),name:String(null!=(a=e.name)?a:""),keyword:e.keyword?String(e.keyword):void 0,categories:Array.isArray(e.categories)?e.categories.map(e=>String(e)):void 0,colors:Array.isArray(e.colors)?e.colors.map(e=>String(e)):void 0,resolution:e.resolution?String(e.resolution):void 0,license:e.license?String(e.license):void 0,createdAt:Number(null!=(l=e.createdAt)?l:Date.now())}}).filter(e=>e.id&&e.name))},[]),(0,r.useEffect)(()=>{try{(0,er.PX)(sy,sN)}catch(e){f.vF.error("保存済み検索条件の保存エラー",e,"VirtualBgGenerator")}},[sN]),(0,r.useEffect)(()=>{let e=(0,er.GJ)(sC);e&&Array.isArray(e)&&sP(e.filter(e=>"object"==typeof e&&null!==e).map(e=>{var s,a,l;return{id:String(null!=(s=e.id)?s:""),imageUrl:String(null!=(a=e.imageUrl)?a:""),prompt:e.prompt?String(e.prompt):void 0,negativePrompt:e.negativePrompt?String(e.negativePrompt):void 0,category:e.category?String(e.category):void 0,style:e.style?String(e.style):void 0,resolution:e.resolution?String(e.resolution):void 0,color:e.color?String(e.color):void 0,timestamp:String(null!=(l=e.timestamp)?l:new Date().toISOString()),type:"search"===e.type?"search":"generated",searchKeyword:e.searchKeyword?String(e.searchKeyword):void 0,searchParams:e.searchParams&&"object"==typeof e.searchParams?{categories:Array.isArray(e.searchParams.categories)?e.searchParams.categories.map(e=>String(e)):void 0,colors:Array.isArray(e.searchParams.colors)?e.searchParams.colors.map(e=>String(e)):void 0,resolution:e.searchParams.resolution?String(e.searchParams.resolution):void 0,license:e.searchParams.license?String(e.searchParams.license):void 0}:void 0}}).filter(e=>e.id&&e.imageUrl))},[]),(0,r.useEffect)(()=>{try{(0,er.PX)(sC,sS)}catch(e){f.vF.error("履歴の保存エラー",e,"VirtualBgGenerator")}},[sS]);let aS=(0,r.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generated",a={id:"".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9)),imageUrl:e.url||e,prompt:e.prompt||eA,negativePrompt:e.negativePrompt||eC,category:e.category||eP||void 0,style:e.style||eD||void 0,resolution:e.resolution||e$||void 0,color:e.color||eL||void 0,timestamp:new Date().toISOString(),type:s,searchKeyword:"search"===s?e5:void 0,searchParams:"search"===s?{categories:e6.length>0?e6:void 0,colors:e7.length>0?e7:void 0,resolution:ss||void 0,license:sl||void 0}:void 0};sP(e=>[a,...e].slice(0,sR))},[eA,eC,eP,eD,e$,eL,e5,e6,e7,ss,sl,sR]),aP=(0,r.useCallback)(async()=>{try{await ew({prompt:eA,negativePrompt:eC,category:eP,style:eD,resolution:e$,color:eL,imageCount:eJ,onImagesGenerated:e=>{var s;eB(s=>[...s,...e]),eM((null==(s=e[0])?void 0:s.url)||null)},onHistoryAdd:e=>{aS(e,"generated")},onAutoTag:as,onExpandPreview:ev,onError:e=>{f.vF.error("背景生成中にエラーが発生しました",e,"VirtualBgGenerator"),j.oR.error("背景生成中にエラーが発生しました")}})}catch(e){f.vF.error("背景生成の呼び出しエラー",e,"VirtualBgGenerator")}},[eA,eC,eP,eD,e$,eL,eJ,ew,as,ev,aS]);(0,r.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),!ef&&eA.trim()&&aP()),"Escape"===e.key&&(null!==e_&&eK(null),sG&&s_(!1)),(e.ctrlKey||e.metaKey)&&"a"===e.key&&ai.length>0&&(e.preventDefault(),ac())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ef,eA,aP,e_,sG,ai.length,ac]);let aE=(0,r.useCallback)(e=>{sP(s=>s.filter(s=>s.id!==e)),j.oR.success("履歴を削除しました")},[]),aD=(0,r.useCallback)(()=>{confirm("すべての履歴を削除しますか？")&&(sP([]),j.oR.success("すべての履歴を削除しました"))},[]),az=(0,r.useCallback)(e=>{if("generated"===e.type)ek(e.prompt||""),eS(e.negativePrompt||""),eE(e.category||""),ez(e.style||""),eR(e.resolution||""),eF(e.color||""),eB([{id:"history-".concat(e.id),url:e.imageUrl,prompt:e.prompt||"",negativePrompt:e.negativePrompt,category:e.category,style:e.style,resolution:e.resolution,color:e.color,createdAt:new Date(e.timestamp).getTime(),downloadCount:0}]),eM(e.imageUrl),ev(),j.oR.success("履歴を復元しました");else if("search"===e.type){var s,a,l,r;e8(e.searchKeyword||""),e9((null==(s=e.searchParams)?void 0:s.categories)||[]),se((null==(a=e.searchParams)?void 0:a.colors)||[]),sa((null==(l=e.searchParams)?void 0:l.resolution)||""),sr((null==(r=e.searchParams)?void 0:r.license)||""),j.oR.success("検索条件を復元しました"),ao()}},[ao,ev]),a$=(0,r.useMemo)(()=>{let e=[...sS];if("all"!==sE&&(e=e.filter(e=>e.type===sE)),sz.trim()){let s=sz.toLowerCase();e=e.filter(e=>{var a,l,r,t;return(null==(a=e.prompt)?void 0:a.toLowerCase().includes(s))||(null==(l=e.searchKeyword)?void 0:l.toLowerCase().includes(s))||(null==(r=e.category)?void 0:r.toLowerCase().includes(s))||(null==(t=e.style)?void 0:t.toLowerCase().includes(s))})}return e},[sS,sE,sz]),aR=(0,r.useCallback)(e=>{try{if("csv"===e){let e=a$.map(e=>[e.id,"generated"===e.type?"生成":"検索",e.imageUrl,e.prompt||"",e.category||"",e.style||"",e.resolution||"",new Date(e.timestamp).toLocaleString("ja-JP")]),s=[["ID","タイプ","画像URL","プロンプト","カテゴリ","スタイル","解像度","生成日時"],...e].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n"),a=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download="virtual-bg-history-".concat(new Date().toISOString().split("T")[0],".csv"),r.click(),URL.revokeObjectURL(l)}else{let e=JSON.stringify(a$,null,2),s=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="virtual-bg-history-".concat(new Date().toISOString().split("T")[0],".json"),l.click(),URL.revokeObjectURL(a)}j.oR.success("".concat(e.toUpperCase(),"形式でエクスポートしました"))}catch(e){f.vF.error("エクスポートエラー",e,"VirtualBgGenerator"),j.oR.error("エクスポートに失敗しました")}},[a$]),aJ=(0,l.jsxs)("div",{className:"flex flex-col h-full space-y-4",children:[(0,l.jsx)(v.w,{}),(0,l.jsxs)(N.tU,{value:ec,onValueChange:eo,className:"flex-grow flex flex-col",children:[(0,l.jsxs)(N.j7,{className:"grid w-full grid-cols-4",children:[(0,l.jsx)(N.Xi,{value:"generate",children:"生成"}),(0,l.jsx)(N.Xi,{value:"search",children:"検索"}),(0,l.jsx)(N.Xi,{value:"history",children:"履歴"}),(0,l.jsx)(N.Xi,{value:"collections",children:"コレクション"})]}),(0,l.jsxs)(N.av,{value:"generate",className:"flex-grow space-y-4 mt-4",children:[(0,l.jsxs)(w.nD,{type:"multiple",defaultValue:["basic"],className:"w-full space-y-2",children:[(0,l.jsxs)(w.As,{value:"basic",className:"border rounded-lg px-4",children:[(0,l.jsx)(w.$m,{className:"hover:no-underline",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(I.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"基本設定"})]})}),(0,l.jsxs)(w.ub,{className:"space-y-4 pt-4",children:[eP&&s5[eP]&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{className:"text-xs text-muted-foreground",children:"プロンプトテンプレート"}),(0,l.jsx)("div",{className:"space-y-1",children:s5[eP].map((e,s)=>(0,l.jsxs)(t.$,{variant:"outline",size:"sm",onClick:()=>s7(e),className:"w-full justify-start text-left h-auto py-2 px-3 text-xs",children:[(0,l.jsx)(L.A,{className:"h-3 w-3 mr-2 flex-shrink-0"}),(0,l.jsx)("span",{className:"truncate",children:e})]},s))})]}),e0.length>0&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{className:"text-xs text-muted-foreground",children:"保存済みプロンプト"}),(0,l.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:e0.slice(0,5).map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-1 p-2 border rounded hover:bg-accent group",children:[(0,l.jsx)(t.$,{variant:"ghost",size:"sm",onClick:()=>s6(e),className:"flex-1 justify-start text-left h-auto p-0 text-xs",children:(0,l.jsx)("span",{className:"truncate",children:e.prompt})}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:()=>s9(e.id),className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,l.jsx)(F.A,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"prompt",children:"テキストプロンプト"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(i.T,{id:"prompt",placeholder:"サイバーパンク都市の夜景、ネオンライトが輝く未来都市...",value:eA,onChange:e=>ek(e.target.value),className:"min-h-[100px]"}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[eA&&(0,l.jsx)(t.$,{variant:"outline",size:"sm",onClick:aa,"aria-label":"プロンプトをコピー",children:eZ?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"コピー済み"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.A,{className:"h-4 w-4 mr-1"}),"コピー"]})}),eA.trim()&&(0,l.jsxs)(t.$,{variant:"outline",size:"sm",onClick:s8,disabled:e4,className:"ml-auto",children:[(0,l.jsx)(U.A,{className:"h-4 w-4 mr-1"}),"保存"]})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{children:"カテゴリ"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:s0.map(e=>(0,l.jsxs)(g.E,{variant:eP===e.value?"default":"outline",className:"cursor-pointer hover:bg-primary/10",onClick:()=>eE(e.value),children:[e.icon," ",e.label]},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"style",children:"スタイル"}),(0,l.jsxs)(b.l6,{value:eD,onValueChange:ez,children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"スタイルを選択"})}),(0,l.jsx)(b.gC,{children:s1.map(e=>(0,l.jsx)(b.eb,{value:e.value,children:e.label},e.value))})]})]})]})]}),(0,l.jsxs)(w.As,{value:"advanced",className:"border rounded-lg px-4",children:[(0,l.jsx)(w.$m,{className:"hover:no-underline",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(I.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"詳細設定"})]})}),(0,l.jsxs)(w.ub,{className:"space-y-4 pt-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"negativePrompt",children:"ネガティブプロンプト"}),(0,l.jsx)(i.T,{id:"negativePrompt",placeholder:"除外したい要素を入力（例: 人物、文字、ロゴ...）",value:eC,onChange:e=>eS(e.target.value),className:"min-h-[80px] text-sm"}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"生成時に除外したい要素を指定できます"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{children:"主色（カラーパレット）"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:s3.map(e=>(0,l.jsxs)("button",{onClick:()=>eF(e.value),className:"flex items-center gap-2 px-3 py-1.5 rounded-md border transition-all ".concat(eL===e.value?"border-primary bg-primary/10":"border-border hover:bg-accent"),title:e.label,children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded-full ".concat(e.color," ").concat("white"===e.value?"border border-gray-300":"")}),(0,l.jsx)("span",{className:"text-xs",children:e.label})]},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"resolution",children:"解像度・アスペクト比"}),(0,l.jsxs)(b.l6,{value:e$,onValueChange:eR,children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"解像度を選択"})}),(0,l.jsx)(b.gC,{children:s4.map(e=>(0,l.jsx)(b.eb,{value:e.value,children:(0,l.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,l.jsx)("span",{children:e.label}),e$===e.value&&(0,l.jsx)(B.A,{className:"h-3 w-3 ml-2"})]})},e.value))})]}),e$&&(0,l.jsxs)("div",{className:"mt-2 p-3 bg-muted rounded-md",children:[(0,l.jsx)("div",{className:"text-xs text-muted-foreground mb-2",children:"プレビュー"}),(0,l.jsx)("div",{className:"mx-auto border-2 border-primary rounded ".concat((null==(e=s4.find(e=>e.value===e$))?void 0:e.aspectRatio)==="9:16"?"w-12 h-20":"w-20 h-12"),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),(0,l.jsx)("p",{className:"text-xs text-center text-muted-foreground mt-2",children:(null==(s=s4.find(e=>e.value===e$))?void 0:s.aspectRatio)||"16:9"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"imageCount",children:"生成枚数"}),(0,l.jsxs)(b.l6,{value:eJ,onValueChange:eI,children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"枚数を選択"})}),(0,l.jsx)(b.gC,{children:s2.map(e=>(0,l.jsx)(b.eb,{value:e.value,children:e.label},e.value))})]})]})]})]})]}),(0,l.jsx)(t.$,{onClick:aP,disabled:ef||!eA.trim(),className:"w-full",size:"lg",children:ef?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(O.A,{className:"mr-2 h-4 w-4 animate-spin"}),"生成中..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(O.A,{className:"mr-2 h-4 w-4"}),"背景を生成"]})})]}),(0,l.jsx)(N.av,{value:"search",className:"flex-grow space-y-4 mt-4",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"searchKeyword",children:"キーワード検索"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(n.p,{id:"searchKeyword",placeholder:"背景、都市、自然...",value:e5,onChange:e=>e8(e.target.value),className:"flex-grow"}),(0,l.jsx)(t.$,{variant:"outline",size:"icon",onClick:ao,disabled:sh,children:sh?(0,l.jsx)(O.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(M.A,{className:"h-4 w-4"})})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(c.J,{children:"フィルター"}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{className:"text-sm text-muted-foreground",children:"カテゴリ"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:s0.map(e=>(0,l.jsxs)(g.E,{variant:e6.includes(e.value)?"default":"outline",className:"cursor-pointer hover:bg-primary/10",onClick:()=>aw(e.value),children:[e.icon," ",e.label]},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{className:"text-sm text-muted-foreground",children:"色"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:[{value:"red",label:"赤",color:"bg-red-500"},{value:"blue",label:"青",color:"bg-blue-500"},{value:"green",label:"緑",color:"bg-green-500"},{value:"purple",label:"紫",color:"bg-purple-500"},{value:"orange",label:"オレンジ",color:"bg-orange-500"},{value:"black",label:"黒",color:"bg-black"},{value:"white",label:"白",color:"bg-white border"}].map(e=>(0,l.jsxs)(g.E,{variant:e7.includes(e.value)?"default":"outline",className:"cursor-pointer hover:bg-primary/10 flex items-center gap-1",onClick:()=>ay(e.value),children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.color)}),e.label]},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{className:"text-sm text-muted-foreground",children:"解像度"}),(0,l.jsxs)(b.l6,{value:ss,onValueChange:sa,children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"解像度を選択"})}),(0,l.jsxs)(b.gC,{children:[(0,l.jsx)(b.eb,{value:"all",children:"すべて"}),(0,l.jsx)(b.eb,{value:"4k",children:"4K以上"}),(0,l.jsx)(b.eb,{value:"hd",children:"HD以上"}),(0,l.jsx)(b.eb,{value:"sd",children:"SD以上"})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{className:"text-sm text-muted-foreground",children:"ライセンス"}),(0,l.jsxs)(b.l6,{value:sl,onValueChange:sr,children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"ライセンスを選択"})}),(0,l.jsxs)(b.gC,{children:[(0,l.jsx)(b.eb,{value:"all",children:"すべて"}),(0,l.jsx)(b.eb,{value:"free",children:"無料"}),(0,l.jsx)(b.eb,{value:"commercial",children:"商用利用可"}),(0,l.jsx)(b.eb,{value:"attribution",children:"帰属表示必要"})]})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{className:"text-sm text-muted-foreground",children:"並び順"}),(0,l.jsxs)(b.l6,{value:sv,onValueChange:e=>{sg(e),sn.length>0&&ao()},children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"並び順を選択"})}),(0,l.jsxs)(b.gC,{className:"bg-[#2D2D2D] border-[#4A4A4A]",children:[(0,l.jsx)(b.eb,{value:"relevance",children:"関連度順"}),(0,l.jsx)(b.eb,{value:"popular",children:"人気順"}),(0,l.jsx)(b.eb,{value:"newest",children:"新着順"}),(0,l.jsx)(b.eb,{value:"oldest",children:"古い順"})]})]})]}),sN.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{className:"text-sm text-muted-foreground",children:"保存済み検索条件"}),(0,l.jsx)("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:sN.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-1 p-2 border rounded hover:bg-accent group",children:[(0,l.jsx)(t.$,{variant:"ghost",size:"sm",onClick:()=>{am(e),ao()},className:"flex-1 justify-start text-left h-auto p-0 text-xs",children:(0,l.jsx)("span",{className:"truncate",children:e.name})}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:()=>ax(e.id),className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,l.jsx)(F.A,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]},e.id))})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c.J,{children:"検索結果"}),(0,l.jsxs)(g.E,{variant:"secondary",children:[sn.length,"件"]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(A.rI,{children:[(0,l.jsx)(A.ty,{asChild:!0,children:(0,l.jsx)(t.$,{variant:"outline",size:"sm",children:(0,l.jsx)(Y.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(A.SQ,{className:"bg-[#2D2D2D] border-[#4A4A4A]",children:[(0,l.jsxs)(A._2,{onClick:()=>sp("small"),children:["small"===sj&&"✓ ","小"]}),(0,l.jsxs)(A._2,{onClick:()=>sp("medium"),children:["medium"===sj&&"✓ ","中"]}),(0,l.jsxs)(A._2,{onClick:()=>sp("large"),children:["large"===sj&&"✓ ","大"]})]})]}),sn.length>0&&(0,l.jsx)(t.$,{variant:"outline",size:"sm",onClick:ah,children:(0,l.jsx)(h.A,{className:"h-4 w-4"})}),(0,l.jsx)(t.$,{variant:"outline",size:"sm",onClick:ad,children:(0,l.jsx)(U.A,{className:"h-4 w-4"})})]})]}),(0,l.jsx)("div",{className:"grid ".concat(aC," max-h-96 overflow-y-auto"),children:sn.length>0?(0,l.jsxs)(l.Fragment,{children:[sn.map((e,s)=>{var a;return(0,l.jsx)(p.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>aA(e.url),children:(0,l.jsx)(p.Wu,{className:"p-0",children:(0,l.jsxs)("div",{className:"aspect-video relative overflow-hidden rounded-lg",children:[(0,l.jsx)("img",{src:e.url,alt:e.title,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors"}),(0,l.jsxs)("div",{className:"absolute bottom-1 left-1 right-1 flex gap-1",children:[(0,l.jsxs)(g.E,{variant:"secondary",className:"text-xs",children:[e.downloads," DL"]}),e.category&&(0,l.jsx)(g.E,{variant:"outline",className:"text-xs",children:(null==(a=s0.find(s=>s.value===e.category))?void 0:a.label)||e.category})]})]})})},e.id)}),sf&&(0,l.jsx)("div",{ref:sk,className:"col-span-full h-4 flex items-center justify-center",children:sh&&(0,l.jsx)(o.A,{className:"h-4 w-4 animate-spin text-muted-foreground"})})]}):(0,l.jsxs)("div",{className:"col-span-full text-center text-muted-foreground py-8",children:[(0,l.jsx)(M.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,l.jsx)("p",{children:"検索キーワードを入力して検索してください"})]})}),!sf&&sn.length>8&&(0,l.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,l.jsx)(t.$,{variant:"outline",size:"sm",disabled:1===so,onClick:()=>ak(so-1),children:"前へ"}),(0,l.jsxs)(t.$,{variant:"outline",size:"sm",children:[so," / ",sm]}),(0,l.jsx)(t.$,{variant:"outline",size:"sm",disabled:so===sm,onClick:()=>ak(so+1),children:"次へ"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(c.J,{className:"text-xs text-muted-foreground",children:"無限スクロール"}),(0,l.jsx)(C.d,{checked:sf,onCheckedChange:sb})]})]})]})}),(0,l.jsxs)(N.av,{value:"history",className:"flex-grow space-y-4 mt-4 overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"space-y-3 flex-shrink-0",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c.J,{children:"履歴"}),(0,l.jsxs)(g.E,{variant:"secondary",children:[a$.length,"件"]}),sS.length!==a$.length&&(0,l.jsxs)(g.E,{variant:"outline",className:"text-xs",children:["全",sS.length,"件"]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(A.rI,{children:[(0,l.jsx)(A.ty,{asChild:!0,children:(0,l.jsxs)(t.$,{variant:"default",size:"sm",children:[(0,l.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"エクスポート"]})}),(0,l.jsxs)(A.SQ,{className:"bg-[#2D2D2D] border-[#4A4A4A]",children:[(0,l.jsxs)(A._2,{onClick:()=>aR("csv"),children:[(0,l.jsx)(T.A,{className:"h-4 w-4 mr-2"}),"CSV形式"]}),(0,l.jsxs)(A._2,{onClick:()=>aR("json"),children:[(0,l.jsx)(T.A,{className:"h-4 w-4 mr-2"}),"JSON形式"]})]})]}),sS.length>0&&(0,l.jsxs)(t.$,{variant:"outline",size:"sm",onClick:aD,className:"text-red-400 hover:text-red-300",children:[(0,l.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"全削除"]})]})]}),(0,l.jsx)("div",{className:"flex gap-2",children:(0,l.jsxs)("div",{className:"flex border rounded-md flex-1",children:[(0,l.jsx)(t.$,{variant:"all"===sE?"default":"ghost",size:"sm",onClick:()=>sD("all"),className:"rounded-r-none flex-1",children:"すべて"}),(0,l.jsxs)(t.$,{variant:"generated"===sE?"default":"ghost",size:"sm",onClick:()=>sD("generated"),className:"rounded-none border-x",children:[(0,l.jsx)(V.A,{className:"h-3 w-3 mr-1"}),"生成"]}),(0,l.jsxs)(t.$,{variant:"search"===sE?"default":"ghost",size:"sm",onClick:()=>sD("search"),className:"rounded-l-none flex-1",children:[(0,l.jsx)(M.A,{className:"h-3 w-3 mr-1"}),"検索"]})]})}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(M.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,l.jsx)(n.p,{placeholder:"履歴を検索...",value:sz,onChange:e=>s$(e.target.value),className:"pl-8"})]})]}),(0,l.jsx)("div",{className:"flex-grow overflow-y-auto space-y-3 pr-1",children:a$.length>0?(0,l.jsx)("div",{className:"space-y-3",children:a$.map((e,s)=>{var a,r;let i=s>0?new Date(a$[s-1].timestamp):null,n=new Date(e.timestamp),c=!i||i.toDateString()!==n.toDateString();return(0,l.jsxs)("div",{className:"space-y-2",children:[c&&(0,l.jsxs)("div",{className:"flex items-center gap-2 py-1 sticky top-0 bg-[#1A1A1A] z-10",children:[(0,l.jsx)(G.A,{className:"h-4 w-4 text-muted-foreground"}),(0,l.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:n.toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})})]}),(0,l.jsx)(p.Zp,{className:(0,el.cn)("hover:shadow-md transition-all relative","generated"===e.type?"border-l-4 border-l-primary":"border-l-4 border-l-blue-500"),children:(0,l.jsx)(p.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsxs)("div",{className:"w-24 h-16 relative overflow-hidden rounded flex-shrink-0 cursor-pointer group",onClick:s=>{s.stopPropagation(),eB([{id:"history-".concat(e.id),url:e.imageUrl,prompt:e.prompt||"",negativePrompt:e.negativePrompt,category:e.category,style:e.style,resolution:e.resolution,color:e.color,createdAt:new Date(e.timestamp).getTime(),downloadCount:0}]),eK("history-".concat(e.id))},children:[(0,l.jsx)("img",{src:e.imageUrl,alt:"履歴画像",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-200",loading:"lazy",decoding:"async"}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:(0,l.jsx)(_.A,{className:"h-4 w-4 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),(0,l.jsx)("div",{className:"flex-grow min-w-0",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)(g.E,{variant:"generated"===e.type?"default":"secondary",className:"text-xs",children:"generated"===e.type?"AI生成":"検索"}),(0,l.jsx)("span",{className:"text-xs text-muted-foreground",children:n.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]}),(0,l.jsx)("p",{className:"text-sm font-medium truncate mb-1",children:"generated"===e.type?e.prompt||"プロンプトなし":e.searchKeyword||"検索キーワードなし"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.category&&(0,l.jsx)(g.E,{variant:"outline",className:"text-xs",children:(null==(a=s0.find(s=>s.value===e.category))?void 0:a.label)||e.category}),e.style&&(0,l.jsx)(g.E,{variant:"outline",className:"text-xs",children:(null==(r=s1.find(s=>s.value===e.style))?void 0:r.label)||e.style}),e.resolution&&(0,l.jsx)(g.E,{variant:"outline",className:"text-xs",children:e.resolution})]})]}),(0,l.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),az(e)},title:"復元",children:(0,l.jsx)(K.A,{className:"h-4 w-4"})}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),aE(e.id)},className:"text-red-400 hover:text-red-300",title:"削除",children:(0,l.jsx)(F.A,{className:"h-4 w-4"})})]})]})})]})})})]},e.id)})}):(0,l.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,l.jsx)(W.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,l.jsx)("p",{children:sz||"all"!==sE?"検索条件に一致する履歴が見つかりませんでした":"履歴がここに表示されます"})]})}),sS.length>0&&(0,l.jsxs)("div",{className:"flex-shrink-0 pt-2 border-t space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(c.J,{className:"text-xs text-muted-foreground",children:"履歴保存数上限"}),(0,l.jsx)(n.p,{type:"number",min:"10",max:"1000",value:sR,onChange:e=>{sJ(Math.max(10,Math.min(1e3,parseInt(e.target.value)||100)))},className:"w-20 h-8 text-xs"})]}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground",children:["現在 ",sS.length,"件保存中（上限: ",sR,"件）"]})]})]}),(0,l.jsxs)(N.av,{value:"collections",className:"flex-grow space-y-4 mt-4 overflow-hidden flex flex-col",children:[(0,l.jsx)("div",{className:"space-y-3 flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c.J,{children:"コレクション"}),(0,l.jsxs)(g.E,{variant:"secondary",children:[sF.length,"件"]})]}),(0,l.jsxs)(t.$,{variant:"default",size:"sm",onClick:au,children:[(0,l.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"新規作成"]})]})}),(0,l.jsx)("div",{className:"flex-grow overflow-y-auto space-y-2",children:sF.length>0?sF.map(e=>(0,l.jsx)(p.Zp,{className:(0,el.cn)("hover:shadow-md transition-all cursor-pointer",sT===e.id&&"ring-2 ring-primary"),onClick:()=>sV(sT===e.id?null:e.id),children:(0,l.jsx)(p.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)(Z.A,{className:"h-4 w-4 text-primary"}),(0,l.jsx)("h4",{className:"font-medium truncate",children:e.name}),(0,l.jsxs)(g.E,{variant:"outline",className:"text-xs",children:[e.imageIds.length,"枚"]})]}),e.description&&(0,l.jsx)("p",{className:"text-xs text-muted-foreground truncate mb-1",children:e.description}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,l.jsxs)("span",{children:["作成: ",new Date(e.createdAt).toLocaleDateString("ja-JP")]}),e.updatedAt!==e.createdAt&&(0,l.jsxs)("span",{children:["更新: ",new Date(e.updatedAt).toLocaleDateString("ja-JP")]})]})]}),(0,l.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),av(e)},title:"編集",children:(0,l.jsx)(q.A,{className:"h-4 w-4"})}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),aN(e.id)},title:"エクスポート",children:(0,l.jsx)(h.A,{className:"h-4 w-4"})}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),ap(e.id)},className:"text-red-400 hover:text-red-300",title:"削除",children:(0,l.jsx)(F.A,{className:"h-4 w-4"})})]})]})})},e.id)):(0,l.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,l.jsx)(Z.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,l.jsx)("p",{children:"コレクションを作成して画像を整理できます"})]})}),sT&&ab.length>0&&(0,l.jsxs)("div",{className:"flex-shrink-0 pt-2 border-t space-y-2 max-h-64 overflow-y-auto",children:[(0,l.jsxs)(c.J,{className:"text-xs text-muted-foreground",children:[null==(a=sF.find(e=>e.id===sT))?void 0:a.name," の画像"]}),(0,l.jsx)("div",{className:"grid grid-cols-4 gap-2",children:ab.map(e=>(0,l.jsxs)("div",{className:"relative aspect-video rounded overflow-hidden",children:[(0,l.jsx)("img",{src:e.url,alt:e.id,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:()=>af(e.id,sT),className:"absolute top-1 right-1 sm:h-9 h-11 sm:w-9 w-11 bg-black/50 hover:bg-black/70 text-white",children:(0,l.jsx)(J.A,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]},e.id))})]})]})]})]}),aI=(0,l.jsxs)("div",{className:"flex flex-col h-full space-y-4 p-3 sm:p-4",children:[(0,l.jsxs)(w.nD,{type:"multiple",defaultValue:["basic"],className:"w-full space-y-2",children:[(0,l.jsxs)(w.As,{value:"basic",className:"rounded-lg px-4",children:[(0,l.jsx)(w.$m,{className:"hover:no-underline",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(I.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"基本設定"})]})}),(0,l.jsxs)(w.ub,{className:"space-y-4 pt-4",children:[eP&&s5[eP]&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{className:"text-xs text-muted-foreground",children:"プロンプトテンプレート"}),(0,l.jsx)("div",{className:"space-y-1",children:s5[eP].map((e,s)=>(0,l.jsxs)(t.$,{variant:"outline",size:"sm",onClick:()=>s7(e),className:"w-full justify-start text-left h-auto py-2 px-3 text-xs",children:[(0,l.jsx)(L.A,{className:"h-3 w-3 mr-2 flex-shrink-0"}),(0,l.jsx)("span",{className:"truncate",children:e})]},s))})]}),e0.length>0&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{className:"text-xs text-muted-foreground",children:"保存済みプロンプト"}),(0,l.jsx)("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:e0.slice(0,3).map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-1 p-2 border rounded hover:bg-accent group",children:[(0,l.jsx)(t.$,{variant:"ghost",size:"sm",onClick:()=>s6(e),className:"flex-1 justify-start text-left h-auto p-0 text-xs",children:(0,l.jsx)("span",{className:"truncate",children:e.prompt})}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:()=>s9(e.id),className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,l.jsx)(F.A,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"prompt-mobile",children:"テキストプロンプト"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(i.T,{id:"prompt-mobile",placeholder:"サイバーパンク都市の夜景、ネオンライトが輝く未来都市...",value:eA,onChange:e=>ek(e.target.value),className:"min-h-[80px]"}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[eA&&(0,l.jsx)(t.$,{variant:"outline",size:"sm",onClick:aa,"aria-label":"プロンプトをコピー",children:eZ?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"コピー済み"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.A,{className:"h-4 w-4 mr-1"}),"コピー"]})}),eA.trim()&&(0,l.jsxs)(t.$,{variant:"outline",size:"sm",onClick:s8,disabled:e4,className:"ml-auto",children:[(0,l.jsx)(U.A,{className:"h-4 w-4 mr-1"}),"保存"]})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{children:"カテゴリ"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:s0.map(e=>(0,l.jsxs)(g.E,{variant:eP===e.value?"default":"outline",className:"cursor-pointer hover:bg-primary/10 text-xs",onClick:()=>eE(e.value),children:[e.icon," ",e.label]},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"style-mobile",children:"スタイル"}),(0,l.jsxs)(b.l6,{value:eD,onValueChange:ez,children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"スタイル"})}),(0,l.jsx)(b.gC,{children:s1.map(e=>(0,l.jsx)(b.eb,{value:e.value,children:e.label},e.value))})]})]})]})]}),(0,l.jsxs)(w.As,{value:"advanced",className:"rounded-lg px-4",children:[(0,l.jsx)(w.$m,{className:"hover:no-underline",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(I.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"詳細設定"})]})}),(0,l.jsxs)(w.ub,{className:"space-y-4 pt-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"negativePrompt-mobile",children:"ネガティブプロンプト"}),(0,l.jsx)(i.T,{id:"negativePrompt-mobile",placeholder:"除外したい要素を入力...",value:eC,onChange:e=>eS(e.target.value),className:"min-h-[60px] text-sm"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{children:"主色（カラーパレット）"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:s3.map(e=>(0,l.jsxs)("button",{onClick:()=>eF(e.value),className:"flex items-center gap-1 px-2 py-1 rounded-md border transition-all text-xs ".concat(eL===e.value?"border-primary bg-primary/10":"border-border hover:bg-accent"),title:e.label,children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.color," ").concat("white"===e.value?"border border-gray-300":"")}),(0,l.jsx)("span",{children:e.label})]},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"resolution-mobile",children:"解像度"}),(0,l.jsxs)(b.l6,{value:e$,onValueChange:eR,children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"解像度"})}),(0,l.jsx)(b.gC,{children:s4.map(e=>(0,l.jsx)(b.eb,{value:e.value,children:e.label},e.value))})]}),e$&&(0,l.jsxs)("div",{className:"mt-2 p-2 bg-muted rounded-md",children:[(0,l.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"プレビュー"}),(0,l.jsx)("div",{className:"mx-auto border-2 border-primary rounded ".concat((null==(E=s4.find(e=>e.value===e$))?void 0:E.aspectRatio)==="9:16"?"w-8 h-14":"w-14 h-8"),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"imageCount-mobile",children:"生成枚数"}),(0,l.jsxs)(b.l6,{value:eJ,onValueChange:eI,children:[(0,l.jsx)(b.bq,{children:(0,l.jsx)(b.yv,{placeholder:"枚数"})}),(0,l.jsx)(b.gC,{children:s2.map(e=>(0,l.jsx)(b.eb,{value:e.value,children:e.label},e.value))})]})]})]})]})]}),(0,l.jsx)(t.$,{onClick:aP,disabled:ef||!eA.trim(),className:"w-full",size:"lg",children:ef?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(O.A,{className:"mr-2 h-4 w-4 animate-spin"}),"生成中..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(O.A,{className:"mr-2 h-4 w-4"}),"背景を生成"]})})]}),aL=(0,l.jsx)("div",{className:"flex flex-col h-full space-y-4 p-3 sm:p-4",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"searchKeyword-mobile",children:"キーワード検索"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(n.p,{id:"searchKeyword-mobile",placeholder:"背景、都市、自然...",value:e5,onChange:e=>e8(e.target.value),className:"flex-grow"}),(0,l.jsx)(t.$,{variant:"outline",size:"icon",onClick:ao,disabled:sh,children:sh?(0,l.jsx)(O.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(M.A,{className:"h-4 w-4"})})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(c.J,{children:"フィルター"}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{className:"text-sm text-muted-foreground",children:"カテゴリ"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:s0.map(e=>(0,l.jsxs)(g.E,{variant:e6.includes(e.value)?"default":"outline",className:"cursor-pointer hover:bg-primary/10 text-xs",onClick:()=>aw(e.value),children:[e.icon," ",e.label]},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{className:"text-sm text-muted-foreground",children:"色"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:[{value:"red",label:"赤",color:"bg-red-500"},{value:"blue",label:"青",color:"bg-blue-500"},{value:"green",label:"緑",color:"bg-green-500"},{value:"purple",label:"紫",color:"bg-purple-500"},{value:"orange",label:"オレンジ",color:"bg-orange-500"},{value:"black",label:"黒",color:"bg-black"},{value:"white",label:"白",color:"bg-white border"}].map(e=>(0,l.jsxs)(g.E,{variant:e7.includes(e.value)?"default":"outline",className:"cursor-pointer hover:bg-primary/10 flex items-center gap-1 text-xs",onClick:()=>ay(e.value),children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.color)}),e.label]},e.value))})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c.J,{children:"検索結果"}),(0,l.jsxs)(g.E,{variant:"secondary",children:[sn.length,"件"]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(A.rI,{children:[(0,l.jsx)(A.ty,{asChild:!0,children:(0,l.jsx)(t.$,{variant:"outline",size:"sm",children:(0,l.jsx)(Y.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(A.SQ,{className:"bg-[#2D2D2D] border-[#4A4A4A]",children:[(0,l.jsxs)(A._2,{onClick:()=>sp("small"),children:["small"===sj&&"✓ ","小"]}),(0,l.jsxs)(A._2,{onClick:()=>sp("medium"),children:["medium"===sj&&"✓ ","中"]}),(0,l.jsxs)(A._2,{onClick:()=>sp("large"),children:["large"===sj&&"✓ ","大"]})]})]}),sn.length>0&&(0,l.jsx)(t.$,{variant:"outline",size:"sm",onClick:ah,children:(0,l.jsx)(h.A,{className:"h-4 w-4"})})]})]}),(0,l.jsx)("div",{className:"grid ".concat(aC," overflow-y-auto"),style:{maxHeight:"calc(100vh - 28rem)"},children:sn.length>0?(0,l.jsxs)(l.Fragment,{children:[sn.map((e,s)=>{var a;return(0,l.jsx)(p.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>aA(e.url),children:(0,l.jsx)(p.Wu,{className:"p-0",children:(0,l.jsxs)("div",{className:"aspect-video relative overflow-hidden rounded-lg",children:[(0,l.jsx)("img",{src:e.url,alt:e.title,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors"}),(0,l.jsxs)("div",{className:"absolute bottom-1 left-1 right-1 flex gap-1",children:[(0,l.jsxs)(g.E,{variant:"secondary",className:"text-xs",children:[e.downloads," DL"]}),e.category&&(0,l.jsx)(g.E,{variant:"outline",className:"text-xs",children:(null==(a=s0.find(s=>s.value===e.category))?void 0:a.label)||e.category})]})]})})},e.id)}),sf&&(0,l.jsx)("div",{ref:sk,className:"col-span-full h-4 flex items-center justify-center",children:sh&&(0,l.jsx)(o.A,{className:"h-4 w-4 animate-spin text-muted-foreground"})})]}):(0,l.jsxs)("div",{className:"col-span-full text-center text-muted-foreground py-8",children:[(0,l.jsx)(M.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,l.jsx)("p",{children:"検索キーワードを入力して検索してください"})]})}),!sf&&sn.length>8&&(0,l.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,l.jsx)(t.$,{variant:"outline",size:"sm",disabled:1===so,onClick:()=>ak(so-1),children:"前へ"}),(0,l.jsxs)(t.$,{variant:"outline",size:"sm",children:[so," / ",sm]}),(0,l.jsx)(t.$,{variant:"outline",size:"sm",disabled:so===sm,onClick:()=>ak(so+1),children:"次へ"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(c.J,{className:"text-xs text-muted-foreground",children:"無限スクロール"}),(0,l.jsx)(C.d,{checked:sf,onCheckedChange:sb})]})]})]})}),aF=(0,l.jsxs)("div",{className:"flex flex-col h-full space-y-4 p-3 sm:p-4",children:[(0,l.jsxs)("div",{className:"space-y-3 flex-shrink-0",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c.J,{children:"履歴"}),(0,l.jsxs)(g.E,{variant:"secondary",children:[a$.length,"件"]})]}),(0,l.jsx)("div",{className:"flex gap-2",children:sS.length>0&&(0,l.jsxs)(t.$,{variant:"outline",size:"sm",onClick:aD,className:"text-red-400 hover:text-red-300",children:[(0,l.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"全削除"]})})]}),(0,l.jsx)("div",{className:"flex gap-2",children:(0,l.jsxs)("div",{className:"flex border rounded-md flex-1",children:[(0,l.jsx)(t.$,{variant:"all"===sE?"default":"ghost",size:"sm",onClick:()=>sD("all"),className:"rounded-r-none flex-1 text-xs",children:"すべて"}),(0,l.jsxs)(t.$,{variant:"generated"===sE?"default":"ghost",size:"sm",onClick:()=>sD("generated"),className:"rounded-none border-x text-xs",children:[(0,l.jsx)(V.A,{className:"h-3 w-3 mr-1"}),"生成"]}),(0,l.jsxs)(t.$,{variant:"search"===sE?"default":"ghost",size:"sm",onClick:()=>sD("search"),className:"rounded-l-none flex-1 text-xs",children:[(0,l.jsx)(M.A,{className:"h-3 w-3 mr-1"}),"検索"]})]})}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(M.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,l.jsx)(n.p,{placeholder:"履歴を検索...",value:sz,onChange:e=>s$(e.target.value),className:"pl-8"})]})]}),(0,l.jsx)("div",{className:"flex-grow overflow-y-auto space-y-3 pr-1",children:a$.length>0?(0,l.jsx)("div",{className:"space-y-3",children:a$.map((e,s)=>{let a=s>0?new Date(a$[s-1].timestamp):null,r=new Date(e.timestamp),i=!a||a.toDateString()!==r.toDateString();return(0,l.jsxs)("div",{className:"space-y-2",children:[i&&(0,l.jsxs)("div",{className:"flex items-center gap-2 py-2 sticky top-0 bg-[#1A1A1A] backdrop-blur-sm z-10 border-b border-[#4A4A4A]/50",children:[(0,l.jsx)(G.A,{className:"h-4 w-4 text-muted-foreground"}),(0,l.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:r.toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})})]}),(0,l.jsx)(p.Zp,{className:(0,el.cn)("hover:shadow-md transition-all relative","generated"===e.type?"border-l-4 border-l-primary":"border-l-4 border-l-blue-500"),children:(0,l.jsx)(p.Wu,{className:"p-3",children:(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("div",{className:"w-20 h-14 relative overflow-hidden rounded flex-shrink-0 cursor-pointer group",onClick:s=>{s.stopPropagation(),eB([{id:"history-".concat(e.id),url:e.imageUrl,prompt:e.prompt||"",negativePrompt:e.negativePrompt,category:e.category,style:e.style,resolution:e.resolution,color:e.color,createdAt:new Date(e.timestamp).getTime(),downloadCount:0}]),eK("history-".concat(e.id)),en||ev()},children:(0,l.jsx)("img",{src:e.imageUrl,alt:"履歴画像",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-200",loading:"lazy",decoding:"async"})}),(0,l.jsx)("div",{className:"flex-grow min-w-0",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)(g.E,{variant:"generated"===e.type?"default":"secondary",className:"text-xs",children:"generated"===e.type?"AI生成":"検索"}),(0,l.jsx)("span",{className:"text-xs text-muted-foreground",children:r.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]}),(0,l.jsx)("p",{className:"text-sm font-medium truncate mb-1",children:"generated"===e.type?e.prompt||"プロンプトなし":e.searchKeyword||"検索キーワードなし"})]}),(0,l.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),az(e)},title:"復元",className:"h-8 w-8",children:(0,l.jsx)(K.A,{className:"h-3 w-3"})}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),aE(e.id)},className:"text-red-400 hover:text-red-300 h-8 w-8",title:"削除",children:(0,l.jsx)(F.A,{className:"h-3 w-3"})})]})]})})]})})})]},e.id)})}):(0,l.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,l.jsx)(W.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,l.jsx)("p",{className:"text-sm",children:sz||"all"!==sE?"検索条件に一致する履歴が見つかりませんでした":"履歴がここに表示されます"})]})})]}),aU=(0,l.jsxs)("div",{className:"flex flex-col h-full space-y-4 p-3 sm:p-4",children:[(0,l.jsx)("div",{className:"space-y-3 flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c.J,{children:"コレクション"}),(0,l.jsxs)(g.E,{variant:"secondary",children:[sF.length,"件"]})]}),(0,l.jsxs)(t.$,{variant:"default",size:"sm",onClick:au,children:[(0,l.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"新規作成"]})]})}),(0,l.jsx)("div",{className:"flex-grow overflow-y-auto space-y-2",children:sF.length>0?(0,l.jsxs)(l.Fragment,{children:[sF.map(e=>(0,l.jsx)(p.Zp,{className:(0,el.cn)("hover:shadow-md transition-all cursor-pointer",sT===e.id&&"ring-2 ring-primary bg-primary/5"),onClick:()=>sV(sT===e.id?null:e.id),children:(0,l.jsx)(p.Wu,{className:"p-3",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)(Z.A,{className:"h-4 w-4 text-primary"}),(0,l.jsx)("h4",{className:"font-medium truncate text-sm",children:e.name}),(0,l.jsxs)(g.E,{variant:"outline",className:"text-xs",children:[e.imageIds.length,"枚"]})]}),e.description&&(0,l.jsx)("p",{className:"text-xs text-muted-foreground truncate mb-1",children:e.description})]}),(0,l.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),av(e)},title:"編集",className:"h-8 w-8",children:(0,l.jsx)(q.A,{className:"h-3 w-3"})}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),ap(e.id)},className:"text-red-400 hover:text-red-300 h-8 w-8",title:"削除",children:(0,l.jsx)(F.A,{className:"h-3 w-3"})})]})]})})},e.id)),sT&&ab.length>0&&(0,l.jsxs)("div",{className:"mt-4 pt-4 border-t border-[#4A4A4A] space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)(c.J,{className:"text-sm font-medium",children:[null==(D=sF.find(e=>e.id===sT))?void 0:D.name," の画像"]}),(0,l.jsxs)(g.E,{variant:"secondary",className:"text-xs",children:[ab.length,"枚"]})]}),(0,l.jsx)("div",{className:"grid grid-cols-3 gap-2 max-h-[40vh] overflow-y-auto",children:ab.map(e=>(0,l.jsxs)("div",{className:"relative aspect-video rounded overflow-hidden group",children:[(0,l.jsx)("img",{src:e.url,alt:e.id,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:()=>af(e.id,sT),className:"absolute top-1 right-1 h-8 w-8 bg-black/50 hover:bg-black/70 text-white opacity-0 group-hover:opacity-100 transition-opacity",children:(0,l.jsx)(J.A,{className:"h-3 w-3"})})]},e.id))})]})]}):(0,l.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,l.jsx)(Z.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,l.jsx)("p",{className:"text-sm",children:"コレクションがここに表示されます"})]})})]}),aB=(0,l.jsx)("div",{className:(0,el.cn)("p-3 sm:p-4 lg:p-6",en?"h-full":""),children:ef&&eb?(0,l.jsx)(et,{steps:$,currentStepId:eb,estimatedTimeRemaining:eN,onCancel:ae}):ai.length>0?(0,l.jsxs)("div",{className:(0,el.cn)("flex flex-col",en?"h-full":""),children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-2 md:space-y-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold",children:"生成された背景"}),(0,l.jsxs)(g.E,{variant:"secondary",children:[ai.length,"枚"]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[en&&(0,l.jsxs)("div",{className:"flex border rounded-md",children:[(0,l.jsx)(t.$,{variant:"grid"===eY?"default":"ghost",size:"sm",onClick:()=>eT("grid"),className:"rounded-r-none",children:(0,l.jsx)(Y.A,{className:"h-4 w-4"})}),(0,l.jsx)(t.$,{variant:"list"===eY?"default":"ghost",size:"sm",onClick:()=>eT("list"),className:"rounded-l-none",children:(0,l.jsx)(Q.A,{className:"h-4 w-4"})})]}),(0,l.jsxs)(A.rI,{children:[(0,l.jsx)(A.ty,{asChild:!0,children:(0,l.jsxs)(t.$,{variant:"outline",size:"sm",children:[(0,l.jsx)(H.A,{className:"mr-2 h-4 w-4"}),"並び替え"]})}),(0,l.jsxs)(A.SQ,{className:"bg-[#2D2D2D] border-[#4A4A4A]",children:[(0,l.jsx)(A.lp,{children:"並び替え"}),(0,l.jsx)(A.mB,{}),(0,l.jsx)(A._2,{onClick:()=>eG("newest"),children:"新しい順"}),(0,l.jsx)(A._2,{onClick:()=>eG("oldest"),children:"古い順"}),(0,l.jsx)(A._2,{onClick:()=>eG("favorite"),children:"お気に入り順"}),(0,l.jsx)(A._2,{onClick:()=>eG("download"),children:"ダウンロード数順"})]})]}),eW.size>0&&(0,l.jsxs)(t.$,{variant:"default",size:"sm",onClick:at,children:[(0,l.jsx)(h.A,{className:"mr-2 h-4 w-4"}),eW.size,"枚ダウンロード"]}),(0,l.jsx)(t.$,{variant:"outline",size:"sm",onClick:ac,children:eW.size===ai.length?"選択解除":"すべて選択"})]})]}),"grid"!==eY&&en?(0,l.jsx)("div",{className:"flex-grow overflow-y-auto space-y-3",children:ai.map(e=>{var s,a;return(0,l.jsx)(p.Zp,{className:"cursor-pointer transition-all ".concat(eO===e.url?"ring-2 ring-primary":"hover:shadow-md"," ").concat(eW.has(e.id)?"ring-2 ring-blue-500":""),onClick:()=>eM(e.url),children:(0,l.jsx)(p.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)(k.S,{checked:eW.has(e.id),onCheckedChange:s=>{an(e.id)},onClick:e=>e.stopPropagation()}),(0,l.jsx)("div",{className:"w-32 h-20 relative flex-shrink-0 rounded overflow-hidden",children:(0,l.jsx)("img",{src:e.url,alt:"Generated background ".concat(e.id),className:"w-full h-full object-cover",loading:"lazy",decoding:"async"})}),(0,l.jsx)("div",{className:"flex-grow min-w-0",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,l.jsx)("p",{className:"text-sm font-medium truncate",children:e.prompt||"プロンプトなし"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.category&&(0,l.jsx)(g.E,{variant:"secondary",className:"text-xs",children:(null==(s=s0.find(s=>s.value===e.category))?void 0:s.label)||e.category}),e.style&&(0,l.jsx)(g.E,{variant:"secondary",className:"text-xs",children:(null==(a=s1.find(s=>s.value===e.style))?void 0:a.label)||e.style}),e.resolution&&(0,l.jsx)(g.E,{variant:"outline",className:"text-xs",children:e.resolution}),void 0!==e.downloadCount&&(0,l.jsxs)(g.E,{variant:"outline",className:"text-xs",children:["ダウンロード: ",e.downloadCount,"回"]})]}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.createdAt).toLocaleString("ja-JP")})]}),(0,l.jsxs)("div",{className:"flex gap-2 flex-shrink-0",children:[sF.length>0&&(0,l.jsxs)(A.rI,{children:[(0,l.jsx)(A.ty,{asChild:!0,children:(0,l.jsx)(t.$,{variant:"ghost",size:"sm",onClick:e=>e.stopPropagation(),className:"h-8 w-8 p-0",title:"コレクションに追加",children:(0,l.jsx)(X.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(A.SQ,{className:"bg-[#2D2D2D] border-[#4A4A4A]",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)(A.lp,{children:"コレクションに追加"}),sF.map(s=>(0,l.jsxs)(A._2,{onClick:()=>{s.imageIds.includes(e.id)?j.oR.info("この画像は既にコレクションに含まれています"):ag(e.id,s.id)},disabled:s.imageIds.includes(e.id),children:[(0,l.jsx)(Z.A,{className:"h-4 w-4 mr-2"}),s.name,s.imageIds.includes(e.id)&&" ✓"]},s.id)),(0,l.jsx)(A.mB,{}),(0,l.jsxs)(A._2,{onClick:()=>au(),children:[(0,l.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"新しいコレクションを作成"]})]})]}),(0,l.jsx)(t.$,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),al(e.url)},className:"h-8 w-8 p-0",children:(0,l.jsx)(x.A,{className:"h-4 w-4 ".concat(eQ.includes(e.url)?"fill-red-500 text-red-500":"text-[#A0A0A0]")})}),(0,l.jsx)(t.$,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),ar(e.url)},className:"h-8 w-8 p-0",children:(0,l.jsx)(h.A,{className:"h-4 w-4"})}),(0,l.jsx)(t.$,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),eK(e.id)},className:"h-8 w-8 p-0",children:(0,l.jsx)(_.A,{className:"h-4 w-4"})})]})]})})]})})},e.id)})}):(0,l.jsx)("div",{className:(0,el.cn)("flex-grow gap-4",en?"grid grid-cols-1 md:grid-cols-2 overflow-y-auto":"flex overflow-x-auto snap-x snap-mandatory scrollbar-thin scrollbar-thumb-[#20B2AA] scrollbar-track-[#2D2D2D]"),style:en?void 0:{scrollbarWidth:"thin"},children:ai.map(e=>{var s,a;return(0,l.jsx)(p.Zp,{className:(0,el.cn)("cursor-pointer transition-all relative",eO===e.url?"ring-2 ring-primary":"hover:shadow-md",eW.has(e.id)&&"ring-2 ring-blue-500",!en&&"flex-shrink-0 w-[85vw] snap-center"),onClick:()=>eM(e.url),children:(0,l.jsx)(p.Wu,{className:"p-0",children:(0,l.jsxs)("div",{className:"aspect-video relative overflow-hidden rounded-lg bg-[#1A1A1A]",children:[(0,l.jsx)("div",{className:"absolute top-2 left-2 z-10",children:(0,l.jsx)(k.S,{checked:eW.has(e.id),onCheckedChange:s=>{an(e.id)},onClick:e=>e.stopPropagation(),className:"bg-white/90"})}),(0,l.jsx)("img",{src:e.url,alt:"Generated background ".concat(e.id),className:(0,el.cn)("w-full h-full",en?"object-cover":"object-contain"),loading:"lazy",decoding:"async"}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors"}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[sF.length>0&&(0,l.jsxs)(A.rI,{children:[(0,l.jsx)(A.ty,{asChild:!0,children:(0,l.jsx)(t.$,{variant:"secondary",size:"icon",onClick:e=>e.stopPropagation(),title:"コレクションに追加",children:(0,l.jsx)(X.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(A.SQ,{className:"bg-[#2D2D2D] border-[#4A4A4A]",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)(A.lp,{children:"コレクションに追加"}),sF.map(s=>(0,l.jsxs)(A._2,{onClick:()=>{s.imageIds.includes(e.id)?j.oR.info("この画像は既にコレクションに含まれています"):ag(e.id,s.id)},disabled:s.imageIds.includes(e.id),children:[(0,l.jsx)(Z.A,{className:"h-4 w-4 mr-2"}),s.name,s.imageIds.includes(e.id)&&" ✓"]},s.id)),(0,l.jsx)(A.mB,{}),(0,l.jsxs)(A._2,{onClick:()=>{au()},children:[(0,l.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"新しいコレクションを作成"]})]})]}),(0,l.jsx)(t.$,{variant:"secondary",size:"icon",onClick:s=>{s.stopPropagation(),al(e.url)},"aria-label":eQ.includes(e.url)?"お気に入りから削除":"お気に入りに追加",children:(0,l.jsx)(x.A,{className:"h-4 w-4 ".concat(eQ.includes(e.url)?"fill-red-500 text-red-500":"text-[#A0A0A0]")})}),(0,l.jsx)(t.$,{variant:"secondary",size:"icon",onClick:s=>{s.stopPropagation(),ar(e.url)},"aria-label":"画像をダウンロード",children:(0,l.jsx)(h.A,{className:"h-4 w-4"})}),(0,l.jsx)(t.$,{variant:"secondary",size:"icon",onClick:s=>{s.stopPropagation(),eK(e.id)},"aria-label":"拡大表示",children:(0,l.jsx)(_.A,{className:"h-4 w-4"})})]}),(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2",children:(0,l.jsxs)("div",{className:"flex flex-wrap gap-1 text-xs text-white",children:[e.category&&(0,l.jsx)(g.E,{variant:"secondary",className:"text-xs",children:(null==(s=s0.find(s=>s.value===e.category))?void 0:s.label)||e.category}),e.style&&(0,l.jsx)(g.E,{variant:"secondary",className:"text-xs",children:(null==(a=s1.find(s=>s.value===e.style))?void 0:a.label)||e.style}),e.downloadCount&&e.downloadCount>0&&(0,l.jsxs)(g.E,{variant:"secondary",className:"text-xs",children:["DL: ",e.downloadCount]})]})})]})})},e.id)})}),(0,l.jsx)(y.lG,{open:null!==e_,onOpenChange:e=>!e&&eK(null),children:(0,l.jsxs)(y.Cf,{className:"max-w-4xl w-full",children:[(0,l.jsx)(y.c7,{children:(0,l.jsx)(y.L3,{children:"画像プレビュー"})}),e_&&(()=>{var e,s;let a=ai.find(e=>e.id===e_)||eU.find(e=>e.id===e_);return a?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"relative w-full aspect-video bg-[#1A1A1A] rounded-lg overflow-hidden",children:(0,l.jsx)("img",{src:a.url,alt:"拡大表示",className:"w-full h-full object-contain",loading:"lazy",decoding:"async"})}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(y.rr,{className:"text-sm font-semibold",children:"生成パラメータ"}),(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"プロンプト:"}),(0,l.jsx)("p",{className:"text-muted-foreground mt-1",children:a.prompt||"なし"})]}),a.negativePrompt&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"ネガティブプロンプト:"}),(0,l.jsx)("p",{className:"text-muted-foreground mt-1",children:a.negativePrompt})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[a.category&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"カテゴリ:"}),(0,l.jsx)(g.E,{variant:"secondary",className:"ml-2",children:(null==(e=s0.find(e=>e.value===a.category))?void 0:e.label)||a.category})]}),a.style&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"スタイル:"}),(0,l.jsx)(g.E,{variant:"secondary",className:"ml-2",children:(null==(s=s1.find(e=>e.value===a.style))?void 0:s.label)||a.style})]}),a.resolution&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"解像度:"}),(0,l.jsx)(g.E,{variant:"outline",className:"ml-2",children:a.resolution})]}),a.color&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:"色:"}),(0,l.jsx)(g.E,{variant:"outline",className:"ml-2",children:a.color})]})]}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground",children:["生成日時: ",new Date(a.createdAt).toLocaleString("ja-JP"),void 0!==a.downloadCount&&(0,l.jsxs)("span",{className:"ml-4",children:["ダウンロード回数: ",a.downloadCount]})]})]})]}),(0,l.jsxs)(y.Es,{children:[(0,l.jsxs)(t.$,{variant:"outline",onClick:()=>a&&ar(a.url),children:[(0,l.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"ダウンロード"]}),(0,l.jsx)(t.$,{onClick:()=>eK(null),children:"閉じる"})]})]}):null})()]})})]}):(0,l.jsx)("div",{className:"h-full flex items-center justify-center",children:ef?(0,l.jsxs)("div",{className:"text-center text-muted-foreground px-4",children:[(0,l.jsxs)("div",{className:"w-full h-full bg-[#2D2D2D] rounded-md flex flex-col items-center justify-center text-center p-8 min-h-[400px]",children:[(0,l.jsx)(o.A,{className:"w-16 h-16 text-[#A0A0A0] mb-4 animate-spin","aria-hidden":"true"}),(0,l.jsx)("h3",{className:"text-xl font-semibold text-[#E0E0E0]",children:"バーチャル背景を生成中..."}),(0,l.jsx)("p",{className:"text-[#A0A0A0] mt-2",children:"AIがあなたにぴったりの背景画像を生成しています。しばらくお待ちください。"})]}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",role:"status","aria-label":"バーチャル背景生成中",children:[(0,l.jsx)(u.EA,{className:"aspect-video w-full"}),(0,l.jsx)(u.EA,{className:"aspect-video w-full"})]})]}):(0,l.jsxs)("div",{className:"text-center text-muted-foreground px-4",children:[(0,l.jsx)(ee.A,{className:"h-12 w-12 lg:h-16 lg:w-16 mx-auto mb-4 opacity-50"}),(0,l.jsx)("h3",{className:"text-lg lg:text-xl font-semibold mb-2",children:"バーチャル背景を生成"}),(0,l.jsx)("p",{className:"max-w-md text-sm lg:text-base",children:en?(0,l.jsx)(l.Fragment,{children:"左側のコントロールパネルでプロンプトを入力し、「背景を生成」ボタンをクリックしてAIが背景画像を生成します。"}):(0,l.jsx)(l.Fragment,{children:"「生成」タブでプロンプトを入力し、「背景を生成」ボタンをクリックしてAIが背景画像を生成します。"})})]})})});return(0,l.jsxs)("div",{className:"h-full flex flex-col md:flex-row md:h-screen",children:[en?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("main",{className:"flex-grow p-4 w-full md:w-auto",children:aB}),!z&&(0,l.jsx)(R.R,{onOpen:()=>ei(!0),isDesktop:en,tabs:[{id:"generate",label:"生成",icon:(0,l.jsx)(O.A,{className:"h-4 w-4"})},{id:"search",label:"検索",icon:(0,l.jsx)(M.A,{className:"h-4 w-4"})},{id:"history",label:"履歴",icon:(0,l.jsx)(W.A,{className:"h-4 w-4"})},{id:"collections",label:"コレクション",icon:(0,l.jsx)(Z.A,{className:"h-4 w-4"})}],onTabClick:e=>{eo(e)}}),(0,l.jsx)(R.B,{isOpen:z,onClose:()=>ei(!1),title:"",isDesktop:en,children:aJ})]}):(0,l.jsxs)("div",{className:"w-full h-[calc(100vh-4.1rem)] flex flex-col overflow-y-auto md:hidden",children:[(0,l.jsx)("div",{className:(0,el.cn)("border-b border-[#4A4A4A] transition-all duration-300 overflow-hidden flex-shrink-0",ed?"max-h-0":1===ai.length?"":"max-h-[55vh]"),children:(0,l.jsxs)("div",{className:"p-3 sm:p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-[#E0E0E0]",children:"プレビュー"}),(0,l.jsx)(t.$,{variant:"ghost",size:"icon",onClick:eg,className:"h-8 w-8","aria-label":ed?"プレビューを展開":"プレビューを折りたたむ",children:ed?(0,l.jsx)(es.A,{className:"h-4 w-4"}):(0,l.jsx)(ea.A,{className:"h-4 w-4"})})]}),(0,l.jsx)("div",{children:aB})]})}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,l.jsxs)("div",{className:"relative bg-[#1A1A1A] flex-shrink-0 border-b border-[#4A4A4A]",children:[ex&&(0,l.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-8 bg-gradient-to-r from-[#1A1A1A] to-transparent z-10 pointer-events-none"}),(0,l.jsxs)("div",{ref:ep,className:(0,el.cn)("grid grid-cols-4 sm:flex sm:overflow-x-auto scrollbar-thin scrollbar-thumb-[#20B2AA] scrollbar-track-[#2D2D2D] px-2 pt-2"),style:{scrollbarWidth:"thin"},children:[(0,l.jsxs)("button",{onClick:()=>eo("generate"),className:(0,el.cn)("flex-shrink-0 px-3 py-2.5 text-sm font-medium transition-colors relative","generate"===ec?"text-[#20B2AA]":"text-[#A0A0A0] hover:text-[#E0E0E0]"),children:[(0,l.jsx)(O.A,{className:"h-4 w-4 inline mr-1.5"}),(0,l.jsx)("span",{className:"hidden sm:inline",children:"生成"}),"generate"===ec&&(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#20B2AA] z-10"})]}),(0,l.jsxs)("button",{onClick:()=>eo("search"),className:(0,el.cn)("flex-shrink-0 px-3 py-2.5 text-sm font-medium transition-colors relative","search"===ec?"text-[#20B2AA]":"text-[#A0A0A0] hover:text-[#E0E0E0]"),children:[(0,l.jsx)(M.A,{className:"h-4 w-4 inline mr-1.5"}),(0,l.jsx)("span",{className:"hidden sm:inline",children:"検索"}),"search"===ec&&(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#20B2AA] z-10"})]}),(0,l.jsxs)("button",{onClick:()=>eo("history"),className:(0,el.cn)("flex-shrink-0 px-3 py-2.5 text-sm font-medium transition-colors relative","history"===ec?"text-[#20B2AA]":"text-[#A0A0A0] hover:text-[#E0E0E0]"),children:[(0,l.jsx)(W.A,{className:"h-4 w-4 inline mr-1.5"}),(0,l.jsx)("span",{className:"hidden sm:inline",children:"履歴"}),"history"===ec&&(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#20B2AA] z-10"})]}),(0,l.jsxs)("button",{onClick:()=>eo("collections"),className:(0,el.cn)("flex-shrink-0 px-3 py-2.5 text-sm font-medium transition-colors relative","collections"===ec?"text-[#20B2AA]":"text-[#A0A0A0] hover:text-[#E0E0E0]"),children:[(0,l.jsx)(Z.A,{className:"h-4 w-4 inline mr-1.5"}),(0,l.jsx)("span",{className:"hidden sm:inline",children:"コレクション"}),"collections"===ec&&(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-[2px] bg-[#20B2AA] z-10"})]})]}),eu&&(0,l.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-[#1A1A1A] to-transparent z-10 pointer-events-none"})]}),(0,l.jsxs)("div",{className:"flex-1",children:["generate"===ec&&(0,l.jsx)("div",{children:aI}),"search"===ec&&(0,l.jsx)("div",{children:aL}),"history"===ec&&(0,l.jsx)("div",{children:aF}),"collections"===ec&&(0,l.jsx)("div",{children:aU})]})]})]}),(0,l.jsx)(y.lG,{open:sG,onOpenChange:s_,children:(0,l.jsxs)(y.Cf,{className:"bg-[#2D2D2D] border-[#4A4A4A]",children:[(0,l.jsxs)(y.c7,{children:[(0,l.jsx)(y.L3,{children:sK?"コレクションを編集":"新しいコレクションを作成"}),(0,l.jsx)(y.rr,{children:sK?"コレクションの名前と説明を変更できます":"画像を整理するためのコレクションを作成します"})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"collection-name",children:"コレクション名 *"}),(0,l.jsx)(n.p,{id:"collection-name",value:sX,onChange:e=>sZ(e.target.value),placeholder:"例: 配信用背景セット1",className:"mt-1"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"collection-description",children:"説明（任意）"}),(0,l.jsx)(i.T,{id:"collection-description",value:sq,onChange:e=>sQ(e.target.value),placeholder:"このコレクションについての説明を入力...",className:"mt-1",rows:3})]})]}),(0,l.jsxs)(y.Es,{children:[(0,l.jsx)(t.$,{variant:"outline",onClick:()=>s_(!1),children:"キャンセル"}),(0,l.jsx)(t.$,{onClick:aj,disabled:!sX.trim(),children:sK?"更新":"作成"})]})]})})]})}},37659:(e,s,a)=>{Promise.resolve().then(a.bind(a,2589))}},e=>{e.O(0,[96,76,358],()=>e(e.s=37659)),_N_E=e.O()}]);