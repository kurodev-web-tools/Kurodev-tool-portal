(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[837],{38073:(e,t,s)=>{Promise.resolve().then(s.bind(s,94286))},48337:e=>{e.exports={"simple-enhanced":"EnhancedPreview_simple-enhanced__stQF0","stylish-enhanced":"EnhancedPreview_stylish-enhanced__awaVS","cute-enhanced":"EnhancedPreview_cute-enhanced__6ys9p","cool-enhanced":"EnhancedPreview_cool-enhanced__auzqI","abstract-shape":"EnhancedPreview_abstract-shape__IjMNn",s1:"EnhancedPreview_s1__en6j3",float:"EnhancedPreview_float__wtWX0",s2:"EnhancedPreview_s2__2hlTH","dot-pattern":"EnhancedPreview_dot-pattern__FJTZq",blob:"EnhancedPreview_blob__EDZlm",b1:"EnhancedPreview_b1__ZHHLr",b2:"EnhancedPreview_b2__WSX_d","digital-overlay":"EnhancedPreview_digital-overlay__z94bU",scan:"EnhancedPreview_scan__JgCeG","light-ray-1":"EnhancedPreview_light-ray-1__BK13O","light-ray-2":"EnhancedPreview_light-ray-2__H7CGh",ray:"EnhancedPreview_ray___plof","transform-gpu":"EnhancedPreview_transform-gpu__iacsx","export-mode":"EnhancedPreview_export-mode__YU5j4","grid-overlay":"EnhancedPreview_grid-overlay__Sgmdf","center-lines":"EnhancedPreview_center-lines__xOyFP","safe-area":"EnhancedPreview_safe-area__ytpgp","fullscreen-mode":"EnhancedPreview_fullscreen-mode__Aw_rr","preview-container":"EnhancedPreview_preview-container__62W_0"}},94286:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ep});var a=s(36166),i=s(5766),l=s(82789),n=s(49227),r=s(66614),c=s(2391),o=s(26423),d=s(10508),h=s(54038),m=s(87617),x=s(78926),u=s(1219),p=s(86520),g=s(9885),v=s(388),f=s(89534),j=s(28448),b=s(95575),w=s(39425),y=s(32942),N=s(37463),k=s(75141),C=s(28647),E=s(38493),S=s(57347),_=s(54654),z=s(94431),R=s(23191),P=s(83040),A=s(87727),L=s(58421),D=s(4307),$=s(86821),T=s(28098);let J=[{type:"rectangle",name:"四角形",icon:"⬜",description:"基本的な四角形"},{type:"circle",name:"円",icon:"⭕",description:"完全な円形"},{type:"line",name:"線",icon:"➖",description:"直線"},{type:"arrow",name:"矢印",icon:"➡️",description:"方向を示す矢印"}],F=e=>{let{isOpen:t,onClose:s,onSelect:i}=e;return(0,a.jsx)(T.lG,{open:t,onOpenChange:s,children:(0,a.jsxs)(T.Cf,{className:"sm:max-w-md",children:[(0,a.jsx)(T.c7,{children:(0,a.jsx)(T.L3,{children:"図形を選択してください"})}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4 py-4",children:J.map(e=>(0,a.jsxs)(r.$,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-2 hover:bg-accent hover:text-accent-foreground",onClick:()=>{i(e.type),s()},children:[(0,a.jsx)("span",{className:"text-2xl",children:e.icon}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.type))}),(0,a.jsx)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:(0,a.jsx)(r.$,{variant:"outline",onClick:s,children:"キャンセル"})})]})})},q=()=>{let{layers:e,updateLayer:t,removeLayer:s,selectedLayerId:l,setSelectedLayerId:n,reorderLayers:c,duplicateLayer:o,moveLayerUp:h,moveLayerDown:m,addLayer:x}=(0,b.S)(),[u,p]=(0,i.useState)(!1),g=t=>{let s=e.filter(e=>e.type===t).length+1,a="",i={visible:!0,locked:!1,x:100,y:100,width:200,height:100,rotation:0};switch(t){case"text":a="テキスト ".concat(s),i.text="新しいテキスト",i.color="#000000",i.fontSize="2rem";break;case"image":a="画像 ".concat(s),i.src="";let l=document.createElement("input");l.type="file",l.accept="image/*",l.onchange=e=>{var s;let l=null==(s=e.target.files)?void 0:s[0];if(l){let e=URL.createObjectURL(l);x({type:t,name:a,...i,src:e})}},l.click();return;case"shape":p(!0);return}x({type:t,name:a,...i})};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,a.jsxs)(r.$,{size:"sm",variant:"outline",onClick:()=>g("text"),children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-1"}),"テキスト"]}),(0,a.jsxs)(r.$,{size:"sm",variant:"outline",onClick:()=>g("image"),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"画像"]}),(0,a.jsxs)(r.$,{size:"sm",variant:"outline",onClick:()=>g("shape"),children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-1"}),"図形"]}),(0,a.jsx)("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600"}),(0,a.jsxs)(r.$,{size:"sm",variant:"outline",onClick:()=>l&&void o(l),disabled:!l,children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-1"}),"複製"]}),(0,a.jsxs)(r.$,{size:"sm",variant:"outline",disabled:!0,title:"グループ化機能は近日実装予定です",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"グループ化"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"レイヤー一覧"}),(0,a.jsx)(L.F,{className:"h-[400px] w-full rounded-md border p-2",children:0===e.length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm text-center py-8",children:"レイヤーがありません。"}):(0,a.jsx)(D.JY,{onDragEnd:e=>{e.destination&&c(e.source.index,e.destination.index)},children:(0,a.jsx)(D.gL,{droppableId:"layers",children:i=>(0,a.jsxs)("div",{...i.droppableProps,ref:i.innerRef,className:"space-y-2",children:[e.map((i,c)=>(0,a.jsx)(D.sx,{draggableId:i.id,index:c,children:(o,d)=>(0,a.jsxs)("div",{ref:o.innerRef,...o.draggableProps,...o.dragHandleProps,className:(0,$.cn)("flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all group",l===i.id?"bg-blue-100 dark:bg-blue-900/30 border-2 border-blue-500":"bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700",d.isDragging&&"shadow-lg opacity-90 bg-blue-100 dark:bg-blue-900/30"),onClick:()=>n(i.id),children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(e=>{switch(e){case"text":return(0,a.jsx)(y.A,{className:"h-4 w-4 text-blue-500"});case"image":return(0,a.jsx)(N.A,{className:"h-4 w-4 text-green-500"});case"shape":return(0,a.jsx)(k.A,{className:"h-4 w-4 text-purple-500"});default:return(0,a.jsx)(k.A,{className:"h-4 w-4 text-gray-500"})}})(i.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium truncate",children:i.name||"".concat(i.type," ").concat(c+1)}),i.locked&&(0,a.jsx)(E.A,{className:"h-3 w-3 text-gray-400"})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate",children:(e=>{switch(e.type){case"text":var t,s;return(null==(t=e.text)?void 0:t.substring(0,20))+((null==(s=e.text)?void 0:s.length)>20?"...":"");case"image":return"画像";case"shape":return e.shapeType||"図形";default:return""}})(i)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)(r.$,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:e=>{e.stopPropagation(),h(i.id)},disabled:0===c,title:"上に移動",children:(0,a.jsx)(S.A,{className:"h-3 w-3"})}),(0,a.jsx)(r.$,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:e=>{e.stopPropagation(),m(i.id)},disabled:c===e.length-1,title:"下に移動",children:(0,a.jsx)(_.A,{className:"h-3 w-3"})}),(0,a.jsx)(r.$,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:s=>{s.stopPropagation(),(s=>{var a;t(s,{visible:!(null==(a=e.find(e=>e.id===s))?void 0:a.visible)})})(i.id)},title:i.visible?"非表示":"表示",children:i.visible?(0,a.jsx)(z.A,{className:"h-3 w-3"}):(0,a.jsx)(R.A,{className:"h-3 w-3"})}),(0,a.jsx)(r.$,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:s=>{s.stopPropagation(),(s=>{var a;t(s,{locked:!(null==(a=e.find(e=>e.id===s))?void 0:a.locked)})})(i.id)},title:i.locked?"ロック解除":"ロック",children:i.locked?(0,a.jsx)(E.A,{className:"h-3 w-3"}):(0,a.jsx)(P.A,{className:"h-3 w-3"})}),(0,a.jsx)(r.$,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:e=>{e.stopPropagation(),s(i.id)},title:"削除",children:(0,a.jsx)(A.A,{className:"h-3 w-3"})})]})]})},i.id)),i.placeholder]})})})})]}),(0,a.jsx)("div",{className:"p-3 bg-gray-100 dark:bg-gray-800 rounded-lg",children:(0,a.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["レイヤー数: ",e.length," | 選択中: ",l?"1":"0"]})}),(0,a.jsx)(F,{isOpen:u,onClose:()=>p(!1),onSelect:t=>{let s=e.filter(e=>"shape"===e.type).length+1,a="".concat({rectangle:"四角形",circle:"円",line:"線",arrow:"矢印"}[t]," ").concat(s),i={visible:!0,locked:!1,x:100,y:100,width:200,height:100,rotation:0,shapeType:t,backgroundColor:"#cccccc",borderColor:"#000000",borderWidth:2};("line"===t||"arrow"===t)&&(i.width=200,i.height=5),x({type:"shape",name:a,...i})}})]})};var W=s(31676),M=s(6522),O=s(33129),H=s(30951),I=s(49515),X=s(80358),Y=s(61501),B=s(57588),V=s(7463);let U={"youtube-standard":{resolution:"fhd",quality:"high",format:"png",pixelRatio:2,includeTransparency:!0,optimizeForPlatform:"youtube",batchExport:!1,batchSizes:[]},"twitter-optimized":{resolution:"custom",customWidth:1200,customHeight:675,quality:"high",format:"jpeg",pixelRatio:2,includeTransparency:!1,optimizeForPlatform:"twitter",batchExport:!1,batchSizes:[]},"instagram-square":{resolution:"custom",customWidth:1080,customHeight:1080,quality:"high",format:"jpeg",pixelRatio:2,includeTransparency:!1,optimizeForPlatform:"instagram",batchExport:!1,batchSizes:[]},"batch-all-platforms":{resolution:"fhd",quality:"high",format:"png",pixelRatio:2,includeTransparency:!0,optimizeForPlatform:"general",batchExport:!0,batchSizes:[{name:"YouTube",width:1920,height:1080,platform:"youtube"},{name:"Twitter",width:1200,height:675,platform:"twitter"},{name:"Instagram",width:1080,height:1080,platform:"instagram"},{name:"Facebook",width:1200,height:630,platform:"facebook"}]}},K={hd:{width:1280,height:720,label:"HD (1280\xd7720)"},fhd:{width:1920,height:1080,label:"FHD (1920\xd71080)"},"4k":{width:3840,height:2160,label:"4K (3840\xd72160)"},custom:{width:0,height:0,label:"カスタム"}},G={low:{pixelRatio:1,quality:.6,label:"低品質 (軽量)"},medium:{pixelRatio:1.5,quality:.8,label:"中品質 (バランス)"},high:{pixelRatio:2,quality:.9,label:"高品質 (推奨)"},ultra:{pixelRatio:3,quality:1,label:"最高品質 (重い)"}},Z=e=>{let{onExport:t,isExporting:s}=e,[l,c]=(0,i.useState)(U["youtube-standard"]),[d,h]=(0,i.useState)({}),[m,x]=(0,i.useState)(!1);i.useEffect(()=>{let e=localStorage.getItem("thumbnailExportPresets");e&&h(JSON.parse(e))},[]);let u=e=>{c(t=>({...t,...e}))},p=e=>{let t=U[e]||d[e];t&&(c(t),n.oR.success("プリセット「".concat(e,"」を適用しました")))},j=async()=>{try{await t(l)}catch(e){console.error("Export failed:",e)}},b="custom"===l.resolution?{width:l.customWidth||1920,height:l.customHeight||1080}:K[l.resolution];return(0,a.jsxs)(W.Zp,{className:"w-full",children:[(0,a.jsx)(W.aR,{children:(0,a.jsxs)(W.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(X.A,{className:"h-5 w-5"}),"エクスポート設定"]})}),(0,a.jsxs)(W.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"プリセット"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)(r.$,{variant:"fhd"!==l.resolution||l.batchExport?"outline":"default",size:"sm",onClick:()=>p("youtube-standard"),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"YouTube"]}),(0,a.jsxs)(r.$,{variant:"twitter"===l.optimizeForPlatform?"default":"outline",size:"sm",onClick:()=>p("twitter-optimized"),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"Twitter"]}),(0,a.jsxs)(r.$,{variant:"instagram"===l.optimizeForPlatform?"default":"outline",size:"sm",onClick:()=>p("instagram-square"),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"Instagram"]}),(0,a.jsxs)(r.$,{variant:l.batchExport?"default":"outline",size:"sm",onClick:()=>p("batch-all-platforms"),children:[(0,a.jsx)(Y.A,{className:"h-4 w-4 mr-1"}),"一括出力"]})]})]}),(0,a.jsx)(I.w,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium",children:"基本設定"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"解像度"}),(0,a.jsxs)(M.l6,{value:l.resolution,onValueChange:e=>u({resolution:e}),children:[(0,a.jsx)(M.bq,{children:(0,a.jsx)(M.yv,{})}),(0,a.jsxs)(M.gC,{children:[(0,a.jsx)(M.eb,{value:"hd",children:"HD (1280\xd7720)"}),(0,a.jsx)(M.eb,{value:"fhd",children:"FHD (1920\xd71080)"}),(0,a.jsx)(M.eb,{value:"4k",children:"4K (3840\xd72160)"}),(0,a.jsx)(M.eb,{value:"custom",children:"カスタム"})]})]}),"custom"===l.resolution&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-xs",children:"幅 (px)"}),(0,a.jsx)(f.p,{type:"number",value:l.customWidth||1920,onChange:e=>u({customWidth:Number(e.target.value)}),min:"100",max:"8000"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-xs",children:"高さ (px)"}),(0,a.jsx)(f.p,{type:"number",value:l.customHeight||1080,onChange:e=>u({customHeight:Number(e.target.value)}),min:"100",max:"8000"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"品質"}),(0,a.jsxs)(M.l6,{value:l.quality,onValueChange:e=>{let t=G[e];u({quality:e,pixelRatio:t.pixelRatio})},children:[(0,a.jsx)(M.bq,{children:(0,a.jsx)(M.yv,{})}),(0,a.jsxs)(M.gC,{children:[(0,a.jsx)(M.eb,{value:"low",children:"低品質 (軽量)"}),(0,a.jsx)(M.eb,{value:"medium",children:"中品質 (バランス)"}),(0,a.jsx)(M.eb,{value:"high",children:"高品質 (推奨)"}),(0,a.jsx)(M.eb,{value:"ultra",children:"最高品質 (重い)"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"形式"}),(0,a.jsxs)(M.l6,{value:l.format,onValueChange:e=>u({format:e}),children:[(0,a.jsx)(M.bq,{children:(0,a.jsx)(M.yv,{})}),(0,a.jsxs)(M.gC,{children:[(0,a.jsx)(M.eb,{value:"png",children:"PNG (高品質・透明対応)"}),(0,a.jsx)(M.eb,{value:"jpeg",children:"JPEG (軽量・写真向け)"})]})]})]})]}),l.batchExport&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(I.w,{}),(0,a.jsx)("h4",{className:"font-medium",children:"バッチエクスポート"}),(0,a.jsx)("div",{className:"space-y-2",children:l.batchSizes.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:e.name}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:[e.width,"\xd7",e.height]})]}),(0,a.jsx)(H.E,{variant:"secondary",children:e.platform})]},t))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(r.$,{variant:"ghost",size:"sm",onClick:()=>x(!m),className:"w-full",children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-2"}),m?"詳細設定を隠す":"詳細設定を表示"]}),m&&(0,a.jsxs)("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"背景色"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"color",value:l.backgroundColor||"#ffffff",onChange:e=>u({backgroundColor:e.target.value}),className:"w-8 h-8 rounded border border-gray-300"}),(0,a.jsx)(f.p,{value:l.backgroundColor||"#ffffff",onChange:e=>u({backgroundColor:e.target.value}),className:"flex-1"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(O.S,{id:"transparency",checked:l.includeTransparency,onCheckedChange:e=>u({includeTransparency:!!e})}),(0,a.jsx)(v.J,{htmlFor:"transparency",className:"text-sm",children:"透明度を保持する"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(v.J,{className:"text-sm font-medium",children:["ピクセル比: ",l.pixelRatio,"x"]}),(0,a.jsx)(g.A,{value:[l.pixelRatio],onValueChange:e=>{let[t]=e;return u({pixelRatio:t})},min:.5,max:4,step:.5,className:"w-full"})]})]})]}),(0,a.jsx)(I.w,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"出力情報"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"解像度:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium",children:[b.width,"\xd7",b.height]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"形式:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:l.format.toUpperCase()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"品質:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:G[l.quality].label})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"ファイル数:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium",children:[l.batchExport?l.batchSizes.length:1,"個"]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(r.$,{onClick:j,disabled:s,className:"flex-1",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(B.A,{className:"h-4 w-4 mr-2 animate-spin"}),"エクスポート中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"エクスポート"]})}),(0,a.jsxs)(r.$,{variant:"outline",onClick:()=>{let e=prompt("プリセット名を入力してください:");if(e&&e.trim()){let t={...d,[e]:l};h(t),localStorage.setItem("thumbnailExportPresets",JSON.stringify(t)),n.oR.success("プリセット「".concat(e,"」を保存しました"))}},disabled:s,children:[(0,a.jsx)(V.A,{className:"h-4 w-4 mr-2"}),"保存"]})]})]})]})};var Q=s(38120),ee=s(24759),et=s(85035),es=s(6567),ea=s(68738),ei=s(84907),el=s(34437),en=s(65791),er=s(48337),ec=s.n(er),eo=s(72811),ed=s(90542);let eh=i.memo(e=>{let{id:t,isSelected:s,text:l,color:n="white",fontSize:r="2rem",className:c,x:o,y:d,width:h,height:m,rotation:x,onDragStop:u,onResizeStop:p,enableResizing:g,disableDragging:v,onSelect:f,isLocked:j,isDraggable:w,onRotateStart:y,onRotate:N,onRotateStop:k}=e,{updateLayer:C}=(0,b.S)(),[E,S]=(0,i.useState)({x:o,y:d}),[_,z]=(0,i.useState)(!1),R=(0,i.useRef)(null),P=(0,i.useRef)(null);(0,i.useEffect)(()=>{S({x:o,y:d})},[o,d]);let A=(0,i.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),z(!0);let a=null==(s=R.current)?void 0:s.getSelfElement();if(!a)return;let i=a.parentElement;if(!i)return;let l=i.getBoundingClientRect(),n=l.left+E.x+h/2,r=l.top+E.y+m/2,c=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;C(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-r,s)+90})},o=()=>{z(!1),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",o)};window.addEventListener("touchmove",c),window.addEventListener("touchend",o)},[t,C,E.x,E.y,h,m]);return(0,i.useEffect)(()=>{let e=P.current;if(e)return e.addEventListener("touchstart",A,{passive:!1}),()=>{e.removeEventListener("touchstart",A)}},[A]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo.p,{ref:R,size:{width:h,height:m},position:E,onDragStart:()=>{if(_)return!1;null==f||f()},onDrag:(e,t)=>{_||S({x:t.x,y:t.y})},onDragStop:u,onResizeStop:p,minWidth:50,minHeight:20,enableResizing:g,disableDragging:v||_,className:"border border-dashed border-transparent hover:border-gray-500 transition-colors duration-200",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",style:{transform:"rotate(".concat(x,"deg)"),transformOrigin:"center"},children:(0,a.jsx)("p",{className:(0,$.cn)("cursor-move",c),style:{color:n,fontSize:r,lineHeight:1,whiteSpace:"pre-wrap"},children:l})})}),s&&(0,a.jsx)("div",{ref:P,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),z(!0);let a=null==(s=R.current)?void 0:s.getSelfElement();if(!a)return;let i=a.parentElement;if(!i)return;let l=i.getBoundingClientRect(),n=l.left+E.x+h/2,r=l.top+E.y+m/2,c=e=>{let s=e.clientX-n;C(t,{rotation:180/Math.PI*Math.atan2(e.clientY-r,s)+90})},o=()=>{z(!1),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",o)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",o)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-10",style:{left:E.x+h/2,top:E.y-30,transform:"translateX(-50%)"},children:(0,a.jsx)(ed.A,{className:"h-4 w-4"})})]})}),em=i.memo(e=>{let{id:t,isSelected:s,src:l,alt:n,x:r,y:c,width:o,height:d,rotation:h,onDragStop:m,onResize:x,onResizeStop:u,onSelect:p,isLocked:g,isDraggable:v,lockAspectRatio:f,enableResizing:j,disableDragging:w,onRotateStart:y,onRotate:N,onRotateStop:k}=e,{updateLayer:C}=(0,b.S)(),[E,S]=(0,i.useState)({x:r,y:c}),[_,z]=(0,i.useState)(!1),R=(0,i.useRef)(null),P=(0,i.useRef)(null);(0,i.useEffect)(()=>{S({x:r,y:c})},[r,c]);let A=(0,i.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),z(!0);let a=null==(s=R.current)?void 0:s.getSelfElement();if(!a)return;let i=a.parentElement;if(!i)return;let l=i.getBoundingClientRect(),n=l.left+E.x+o/2,r=l.top+E.y+d/2,c=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;C(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-r,s)+90})},h=()=>{z(!1),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",h)};window.addEventListener("touchmove",c),window.addEventListener("touchend",h)},[t,C,E.x,E.y,o,d]);return(0,i.useEffect)(()=>{let e=P.current;if(e)return e.addEventListener("touchstart",A,{passive:!1}),()=>{e.removeEventListener("touchstart",A)}},[A]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo.p,{ref:R,size:{width:o,height:d},position:E,onDragStart:()=>{if(_)return!1},onDrag:(e,t)=>{_||S({x:t.x,y:t.y})},onDragStop:m,onResize:x,onResizeStop:u,lockAspectRatio:f,enableResizing:j,disableDragging:w||_,className:"border border-dashed border-transparent hover:border-gray-500 transition-colors duration-200",children:(0,a.jsx)("div",{style:{width:"100%",height:"100%",transform:"rotate(".concat(h,"deg)"),transformOrigin:"center"},children:(0,a.jsx)("div",{style:{width:"100%",height:"100%",backgroundImage:l?"url(".concat(l,")"):"none",backgroundSize:"cover",backgroundPosition:"center"}})})}),s&&(0,a.jsx)("div",{ref:P,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),z(!0);let a=null==(s=R.current)?void 0:s.getSelfElement();if(!a)return;let i=a.parentElement;if(!i)return;let l=i.getBoundingClientRect(),n=l.left+E.x+o/2,r=l.top+E.y+d/2,c=e=>{let s=e.clientX-n;C(t,{rotation:180/Math.PI*Math.atan2(e.clientY-r,s)+90})},h=()=>{z(!1),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",h)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",h)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-10",style:{left:E.x+o/2,top:E.y-30,transform:"translateX(-50%)"},children:(0,a.jsx)(ed.A,{className:"h-4 w-4"})})]})}),ex=e=>{let{id:t,isSelected:s,shapeType:l,backgroundColor:n,borderColor:r,borderWidth:c,rotation:o,onDragStop:d,onResize:h,onResizeStop:m,lockAspectRatio:x,enableResizing:u,disableDragging:p,x:g,y:v,width:f,height:j,onSelect:w,isLocked:y,isDraggable:N,onRotateStart:k,onRotate:C,onRotateStop:E}=e,{updateLayer:S}=(0,b.S)(),[_,z]=(0,i.useState)({x:g||0,y:v||0}),[R,P]=(0,i.useState)(!1),A=(0,i.useRef)(null),L=(0,i.useRef)(null);(0,i.useEffect)(()=>{z({x:g||0,y:v||0})},[g,v]);let D=(0,i.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),P(!0);let a=null==(s=A.current)?void 0:s.getSelfElement();if(!a)return;let i=a.parentElement;if(!i)return;let l=i.getBoundingClientRect(),n=l.left+_.x+f/2,r=l.top+_.y+j/2,c=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;S(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-r,s)+90})},o=()=>{P(!1),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",o)};window.addEventListener("touchmove",c),window.addEventListener("touchend",o)},[t,S,_.x,_.y,f,j]);return(0,i.useEffect)(()=>{let e=L.current;if(e)return e.addEventListener("touchstart",D,{passive:!1}),()=>{e.removeEventListener("touchstart",D)}},[D]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo.p,{ref:A,size:{width:f,height:j},position:_,onDragStart:()=>{if(R)return!1;null==w||w()},onDrag:(e,t)=>{R||z({x:t.x,y:t.y})},onDragStop:d,onResize:h,onResizeStop:m,lockAspectRatio:x,enableResizing:u,disableDragging:p||R,className:"border border-dashed border-transparent hover:border-gray-500 transition-colors duration-200",children:(0,a.jsx)("div",{style:{width:"100%",height:"100%",transform:"rotate(".concat(o,"deg)"),transformOrigin:"center"},children:(()=>{let e={width:"100%",height:"100%",style:{overflow:"visible"}};switch(l){case"line":return(0,a.jsx)("svg",{...e,children:(0,a.jsx)("line",{x1:0,y1:j/2,x2:f,y2:j/2,stroke:r,strokeWidth:c})});case"arrow":return(0,a.jsxs)("svg",{...e,children:[(0,a.jsx)("defs",{children:(0,a.jsx)("marker",{id:"arrowhead-".concat(t),markerWidth:"10",markerHeight:"7",refX:"10",refY:"3.5",orient:"auto",fill:r,children:(0,a.jsx)("polygon",{points:"0 0, 10 3.5, 0 7"})})}),(0,a.jsx)("line",{x1:0,y1:j/2,x2:f-10,y2:j/2,stroke:r,strokeWidth:c,markerEnd:"url(#arrowhead-".concat(t,")")})]});default:return(0,a.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:n,border:"".concat(c,"px solid ").concat(r),borderRadius:"circle"===l?"50%":"0"}})}})()})}),s&&(0,a.jsx)("div",{ref:L,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),P(!0);let a=null==(s=A.current)?void 0:s.getSelfElement();if(!a)return;let i=a.parentElement;if(!i)return;let l=i.getBoundingClientRect(),n=l.left+_.x+f/2,r=l.top+_.y+j/2,c=e=>{let s=e.clientX-n;S(t,{rotation:180/Math.PI*Math.atan2(e.clientY-r,s)+90})},o=()=>{P(!1),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",o)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",o)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-10",style:{left:_.x+f/2,top:_.y-30,transform:"translateX(-50%)"},children:(0,a.jsx)(ed.A,{className:"h-4 w-4"})})]})};function eu(e){let{isShiftKeyDown:t}=e,{selectedTemplate:s,layers:l,selectedLayerId:n,setSelectedLayerId:c,updateLayer:o}=(0,b.S)(),[d,h]=(0,i.useState)(1),[m,x]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[f,j]=(0,i.useState)(!1),[w,y]=(0,i.useState)(!1),[N,k]=(0,i.useState)("standard"),C=(0,i.useRef)(null),E=(0,i.useRef)(null),S=(0,i.useCallback)(()=>{h(e=>Math.min(e+.25,4))},[]),_=(0,i.useCallback)(()=>{h(e=>Math.max(e-.25,.25))},[]),z=(0,i.useCallback)(()=>{h(1)},[]),R=(0,i.useCallback)(e=>{let[t]=e;h(t)},[]),P=(0,i.useCallback)(e=>{if(e.ctrlKey||e.metaKey){e.preventDefault();let t=e.deltaY>0?-.1:.1;h(e=>Math.max(.25,Math.min(4,e+t)))}},[]),A=(0,i.useCallback)(()=>{y(e=>!e)},[]),L=(0,i.useCallback)((e,t,s)=>{o(e,{x:s.x,y:s.y})},[o]),D=(0,i.useCallback)((e,t,s,a,i)=>{o(e,{width:s.offsetWidth,height:s.offsetHeight,x:i.x,y:i.y})},[o]);if((0,i.useEffect)(()=>{let e=e=>{if(e.ctrlKey||e.metaKey)switch(e.key){case"=":case"+":e.preventDefault(),S();break;case"-":e.preventDefault(),_();break;case"0":e.preventDefault(),z();break;case"f":e.preventDefault(),A()}"g"===e.key&&(e.preventDefault(),x(e=>!e)),"c"===e.key&&(e.preventDefault(),p(e=>!e)),"s"===e.key&&(e.preventDefault(),j(e=>!e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[S,_,z,A]),!s)return(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"テンプレートを読み込み中..."})});let T=!t,J=!t;return(0,a.jsxs)("div",{className:(0,$.cn)("flex flex-col h-full",w&&ec()["fullscreen-mode"]),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"プレビュー"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.$,{size:"sm",variant:"outline",onClick:_,children:(0,a.jsx)(Q.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-[120px]",children:[(0,a.jsx)(g.A,{value:[d],onValueChange:R,min:.25,max:4,step:.25,className:"flex-1"}),(0,a.jsxs)("span",{className:"text-sm font-medium min-w-[40px]",children:[Math.round(100*d),"%"]})]}),(0,a.jsx)(r.$,{size:"sm",variant:"outline",onClick:S,children:(0,a.jsx)(ee.A,{className:"h-4 w-4"})}),(0,a.jsx)(r.$,{size:"sm",variant:"outline",onClick:z,children:(0,a.jsx)(et.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.$,{size:"sm",variant:m?"default":"outline",onClick:()=>x(!m),title:"グリッド表示 (G)",children:(0,a.jsx)(es.A,{className:"h-4 w-4"})}),(0,a.jsx)(r.$,{size:"sm",variant:u?"default":"outline",onClick:()=>p(!u),title:"中央線表示 (C)",children:(0,a.jsx)(ea.A,{className:"h-4 w-4"})}),(0,a.jsx)(r.$,{size:"sm",variant:f?"default":"outline",onClick:()=>j(!f),title:"安全エリア表示 (S)",children:(0,a.jsx)(ei.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v.J,{className:"text-sm",children:"品質:"}),(0,a.jsx)(r.$,{size:"sm",variant:"standard"===N?"default":"outline",onClick:()=>k("standard"),children:"標準"}),(0,a.jsx)(r.$,{size:"sm",variant:"high"===N?"default":"outline",onClick:()=>k("high"),children:"高品質"})]}),(0,a.jsx)(r.$,{size:"sm",variant:"outline",onClick:A,title:"フルスクリーン (Ctrl+F)",children:w?(0,a.jsx)(el.A,{className:"h-4 w-4"}):(0,a.jsx)(en.A,{className:"h-4 w-4"})})]})]}),(0,a.jsx)("div",{ref:E,className:(0,$.cn)("flex-1 overflow-auto bg-gray-100 dark:bg-gray-900",w&&"h-full"),onWheel:P,children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-full p-8",children:(0,a.jsxs)("div",{id:"thumbnail-preview",ref:C,className:(0,$.cn)("relative transition-transform duration-200 ease-in-out preview-container","high"===N&&ec()["transform-gpu"],(0,$.cn)("aspect-video bg-card border rounded-md shadow-lg",{[ec()["simple-enhanced"]]:"template-1"===s.id,[ec()["stylish-enhanced"]]:"template-2"===s.id,[ec()["cute-enhanced"]]:"template-3"===s.id,[ec()["cool-enhanced"]]:"template-4"===s.id,"bg-gray-200":"template-5"===s.id}),ec()["export-mode"]),style:{transform:"scale(".concat(d,")"),transformOrigin:"center",width:"1280px",height:"720px"},children:["template-2"===s.id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,$.cn)(ec()["abstract-shape"],ec().s1)}),(0,a.jsx)("div",{className:(0,$.cn)(ec()["abstract-shape"],ec().s2)})]}),"template-3"===s.id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:ec()["dot-pattern"]}),(0,a.jsx)("div",{className:(0,$.cn)(ec().blob,ec().b1)}),(0,a.jsx)("div",{className:(0,$.cn)(ec().blob,ec().b2)})]}),"template-4"===s.id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:ec()["digital-overlay"]}),(0,a.jsx)("div",{className:ec()["light-ray-1"]}),(0,a.jsx)("div",{className:ec()["light-ray-2"]})]}),m&&(0,a.jsx)("div",{className:(0,$.cn)("absolute inset-0 pointer-events-none",ec()["grid-overlay"]),children:(0,a.jsxs)("svg",{className:"w-full h-full opacity-30",children:[(0,a.jsx)("defs",{children:(0,a.jsx)("pattern",{id:"grid",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:(0,a.jsx)("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"currentColor",strokeWidth:"1"})})}),(0,a.jsx)("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]})}),u&&(0,a.jsx)("div",{className:(0,$.cn)("absolute inset-0 pointer-events-none",ec()["center-lines"])}),f&&(0,a.jsx)("div",{className:(0,$.cn)("absolute inset-0 pointer-events-none",ec()["safe-area"])}),l.slice().reverse().map(e=>{let s=e.id===n;return"image"===e.type?(0,a.jsx)(em,{id:e.id,isSelected:s,src:e.src||"",alt:e.name,x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>L(e.id,t,s),onResize:(t,s,a,i,l)=>D(e.id,s,a,i,l),onResizeStop:(t,s,a,i,l)=>D(e.id,s,a,i,l),lockAspectRatio:t,enableResizing:T,disableDragging:!J,onSelect:()=>c(e.id),isLocked:e.locked,isDraggable:J,onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{}},e.id):"text"===e.type?(0,a.jsx)(eh,{id:e.id,isSelected:s,text:e.text||"",color:e.color||"#000000",fontSize:e.fontSize||"1rem",x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>L(e.id,t,s),onResizeStop:(t,s,a,i,l)=>D(e.id,s,a,i,l),enableResizing:T,disableDragging:!J,onSelect:()=>c(e.id),isLocked:e.locked,isDraggable:J,onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{}},e.id):"shape"===e.type&&e.shapeType?(0,a.jsx)(ex,{id:e.id,isSelected:s,shapeType:e.shapeType,backgroundColor:e.backgroundColor||"#cccccc",borderColor:e.borderColor||"#000000",borderWidth:e.borderWidth||0,x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>L(e.id,t,s),onResize:(t,s,a,i,l)=>D(e.id,s,a,i,l),onResizeStop:(t,s,a,i,l)=>D(e.id,s,a,i,l),lockAspectRatio:t,enableResizing:T,disableDragging:!J,onSelect:()=>c(e.id),isLocked:e.locked,isDraggable:J,onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{}},e.id):null})]})})}),(0,a.jsx)("div",{className:"p-2 bg-muted text-xs text-muted-foreground border-t",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{children:"ショートカット:"}),(0,a.jsx)("span",{children:"Ctrl + +/-: ズーム"}),(0,a.jsx)("span",{children:"Ctrl + 0: リセット"}),(0,a.jsx)("span",{children:"G: グリッド"}),(0,a.jsx)("span",{children:"C: 中央線"}),(0,a.jsx)("span",{children:"S: 安全エリア"}),(0,a.jsx)("span",{children:"Ctrl + F: フルスクリーン"})]})})]})}function ep(){let{isOpen:e,setIsOpen:t,isDesktop:y}=(0,m.c)({defaultOpen:!1,desktopDefaultOpen:!0}),[N,k]=i.useState("settings"),[C,E]=i.useState(!1),{handleAsyncError:S}=(0,x.u)(),{selectedTemplate:_,setSelectedTemplate:z,currentText:R,setCurrentText:P,layers:A,addLayer:L,updateLayer:D,selectedLayerId:$,setSelectedLayerId:T}=(0,b.S)(),J=A.find(e=>e.id===$);i.useEffect(()=>{let e=e=>{"Shift"===e.key&&E(!0)},t=e=>{"Shift"===e.key&&E(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),i.useEffect(()=>{y?t(!0):t(!1)},[y]);let[F,W]=(0,i.useState)(!1),M=i.useCallback(async e=>{let t=document.getElementById("thumbnail-preview");if(!t)return void n.oR.error("サムネイルが見つかりません");W(!0);try{await S(async()=>{e.batchExport?await I(t,e):await H(t,e)},"エクスポートに失敗しました")}finally{W(!1)}},[S]),O=async e=>{let t=Array.from(e.querySelectorAll("img")).map(e=>new Promise(t=>{if(e.complete&&e.naturalWidth>0)t();else{let s=()=>{e.removeEventListener("load",s),e.removeEventListener("error",a),t()},a=()=>{e.removeEventListener("load",s),e.removeEventListener("error",a),console.warn("画像の読み込みに失敗しました:",e.src),t()};e.addEventListener("load",s),e.addEventListener("error",a)}}));await Promise.all(t),await new Promise(e=>setTimeout(e,500))},H=async(e,t)=>{let a,i;await O(e);let r={low:{pixelRatio:1,quality:.6},medium:{pixelRatio:1.5,quality:.8},high:{pixelRatio:2,quality:.9},ultra:{pixelRatio:3,quality:1}}[t.quality],c="custom"===t.resolution?{width:t.customWidth||1920,height:t.customHeight||1080}:({hd:{width:1280,height:720},fhd:{width:1920,height:1080},"4k":{width:3840,height:2160}})[t.resolution],o={cacheBust:!1,pixelRatio:t.pixelRatio||r.pixelRatio,quality:"png"===t.format?1:r.quality,backgroundColor:t.backgroundColor||"#ffffff",width:c.width,height:c.height,style:{transform:"scale(1)",transformOrigin:"top left"}};if("png"===t.format)a=await (0,l.$E)(e,o),i="thumbnail-".concat(t.optimizeForPlatform,"-").concat(c.width,"x").concat(c.height,".png");else if("jpeg"===t.format){let{toJpeg:l}=await Promise.resolve().then(s.bind(s,82789));a=await l(e,o),i="thumbnail-".concat(t.optimizeForPlatform,"-").concat(c.width,"x").concat(c.height,".jpg")}else a=await (0,l.$E)(e,o),i="thumbnail-".concat(t.optimizeForPlatform,"-").concat(c.width,"x").concat(c.height,".png");let d=document.createElement("a");d.download=i,d.href=a,d.click(),n.oR.success("".concat(i," をエクスポートしました"))},I=async(e,t)=>{let a=t.batchSizes.map(async a=>{let i,n,r={cacheBust:!0,pixelRatio:t.pixelRatio||2,quality:"png"===t.format?1:.9,backgroundColor:t.backgroundColor||"#ffffff",width:a.width,height:a.height};if("png"===t.format)i=await (0,l.$E)(e,r),n="thumbnail-".concat(a.platform,"-").concat(a.width,"x").concat(a.height,".png");else if("jpeg"===t.format){let{toJpeg:t}=await Promise.resolve().then(s.bind(s,82789));i=await t(e,r),n="thumbnail-".concat(a.platform,"-").concat(a.width,"x").concat(a.height,".jpg")}else i=await (0,l.$E)(e,r),n="thumbnail-".concat(a.platform,"-").concat(a.width,"x").concat(a.height,".png");let c=document.createElement("a");return c.download=n,c.href=i,c.click(),n}),i=await Promise.all(a);n.oR.success("".concat(i.length,"個のファイルをエクスポートしました"))};if(i.useCallback((e,t,s)=>{D(e,{x:s.x,y:s.y})},[D]),i.useCallback((e,t,s,a,i)=>{D(e,{width:s.offsetWidth,height:s.offsetHeight,x:i.x,y:i.y})},[D]),!_)return(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)("p",{children:"テンプレートを読み込み中..."})});let X=()=>{var e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium",children:"基本情報"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"レイヤー名"}),(0,a.jsx)(f.p,{value:(null==J?void 0:J.name)||"",onChange:e=>J&&D(J.id,{name:e.target.value}),className:"mt-1",placeholder:"レイヤー名を入力",disabled:!J})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"X座標"}),(0,a.jsx)(f.p,{type:"number",value:(null==J?void 0:J.x)||0,onChange:e=>J&&D(J.id,{x:Number(e.target.value)}),className:"mt-1",disabled:!J})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"Y座標"}),(0,a.jsx)(f.p,{type:"number",value:(null==J?void 0:J.y)||0,onChange:e=>J&&D(J.id,{y:Number(e.target.value)}),className:"mt-1",disabled:!J})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"幅"}),(0,a.jsx)(f.p,{type:"number",value:(null==J?void 0:J.width)||0,onChange:e=>J&&D(J.id,{width:Number(e.target.value)}),className:"mt-1",disabled:!J})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"高さ"}),(0,a.jsx)(f.p,{type:"number",value:(null==J?void 0:J.height)||0,onChange:e=>J&&D(J.id,{height:Number(e.target.value)}),className:"mt-1",disabled:!J})]})]})]})]}),(null==J?void 0:J.type)==="text"&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium",children:"テキスト設定"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"テキスト"}),(0,a.jsx)(p.T,{value:J.text||"",onChange:e=>D(J.id,{text:e.target.value}),className:"mt-1 min-h-[80px] resize-none",placeholder:"テキストを入力してください"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"フォントサイズ"}),(0,a.jsx)(g.A,{value:[parseFloat((null==(e=J.fontSize)?void 0:e.replace("rem",""))||"2")],onValueChange:e=>{let[t]=e;return D(J.id,{fontSize:"".concat(t,"rem")})},min:.5,max:8,step:.1,className:"mt-2"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center mt-1",children:J.fontSize||"2rem"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"色"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)("input",{type:"color",value:J.color||"#ffffff",onChange:e=>D(J.id,{color:e.target.value}),className:"w-8 h-8 rounded border border-gray-300"}),(0,a.jsx)(f.p,{value:J.color||"#ffffff",onChange:e=>D(J.id,{color:e.target.value}),className:"flex-1"})]})]})]})]})]}),(null==J?void 0:J.type)==="image"&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium",children:"画像設定"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"画像を変更"}),(0,a.jsx)(f.p,{type:"file",accept:"image/*",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(s){let e=URL.createObjectURL(s);D(J.id,{src:e})}},className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"不透明度"}),(0,a.jsx)(g.A,{value:[J.opacity||100],onValueChange:e=>{let[t]=e;return D(J.id,{opacity:t})},min:0,max:100,step:1,className:"mt-2"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 text-center mt-1",children:[J.opacity||100,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"回転角度"}),(0,a.jsx)(g.A,{value:[J.rotation||0],onValueChange:e=>{let[t]=e;return D(J.id,{rotation:t})},min:-180,max:180,step:1,className:"mt-2"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 text-center mt-1",children:[J.rotation||0,"\xb0"]})]})]})]}),(null==J?void 0:J.type)==="shape"&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium",children:"図形設定"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"図形の種類"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[(0,a.jsx)(r.$,{variant:"rectangle"===J.shapeType?"default":"outline",onClick:()=>D(J.id,{shapeType:"rectangle"}),size:"sm",children:"四角形"}),(0,a.jsx)(r.$,{variant:"circle"===J.shapeType?"default":"outline",onClick:()=>D(J.id,{shapeType:"circle"}),size:"sm",children:"円"}),(0,a.jsx)(r.$,{variant:"line"===J.shapeType?"default":"outline",onClick:()=>D(J.id,{shapeType:"line"}),size:"sm",children:"線"}),(0,a.jsx)(r.$,{variant:"arrow"===J.shapeType?"default":"outline",onClick:()=>D(J.id,{shapeType:"arrow"}),size:"sm",children:"矢印"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"塗りつぶし色"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)("input",{type:"color",value:J.backgroundColor||"#000000",onChange:e=>D(J.id,{backgroundColor:e.target.value}),className:"w-8 h-8 rounded border border-gray-300"}),(0,a.jsx)(f.p,{value:J.backgroundColor||"#000000",onChange:e=>D(J.id,{backgroundColor:e.target.value}),className:"flex-1"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"境界線色"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)("input",{type:"color",value:J.borderColor||"#000000",onChange:e=>D(J.id,{borderColor:e.target.value}),className:"w-8 h-8 rounded border border-gray-300"}),(0,a.jsx)(f.p,{value:J.borderColor||"#000000",onChange:e=>D(J.id,{borderColor:e.target.value}),className:"flex-1"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{className:"text-sm font-medium",children:"境界線の太さ"}),(0,a.jsx)(g.A,{value:[J.borderWidth||0],onValueChange:e=>{let[t]=e;return D(J.id,{borderWidth:t})},min:0,max:20,step:1,className:"mt-2"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 text-center mt-1",children:[J.borderWidth||0,"px"]})]})]})]}),!J&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"レイヤーを選択してください"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"レイヤーパネルからレイヤーを選択すると、ここで詳細設定ができます"})]})]})},Y=(0,a.jsxs)(h.tU,{value:N,onValueChange:k,className:"w-full",children:[(0,a.jsxs)(h.j7,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(h.Xi,{value:"settings",children:"テンプレート"}),(0,a.jsx)(h.Xi,{value:"tools",children:"ツール"}),(0,a.jsx)(h.Xi,{value:"layers",children:"レイヤー"}),(0,a.jsx)(h.Xi,{value:"export",children:"エクスポート"})]}),(0,a.jsx)(h.av,{value:"settings",className:"mt-4",children:(0,a.jsx)(w.A,{onSelectTemplate:z,selectedTemplateId:_.id})}),(0,a.jsx)(h.av,{value:"tools",className:"mt-4",children:X()}),(0,a.jsx)(h.av,{value:"layers",className:"mt-4",children:(0,a.jsx)(q,{})}),(0,a.jsx)(h.av,{value:"export",className:"mt-4",children:(0,a.jsx)(Z,{onExport:M,isExporting:F})})]}),B=(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"テンプレート選択"})}),(0,a.jsx)(w.A,{onSelectTemplate:z,selectedTemplateId:_.id})]});return(0,a.jsxs)("div",{className:"relative flex flex-col lg:h-screen",children:[e&&!y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>t(!1)}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row flex-grow lg:h-full lg:overflow-y-auto",children:[(0,a.jsxs)("main",{className:"flex-1 overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-2 pt-20 lg:p-6 lg:pt-6",children:(0,a.jsx)(eu,{isShiftKeyDown:C})}),(0,a.jsx)("div",{className:"lg:hidden",children:(0,a.jsxs)("div",{className:"p-2 lg:p-4 space-y-4",children:[(0,a.jsx)(j.nD,{type:"single",collapsible:!0,className:"w-full",defaultValue:"tools",children:(0,a.jsxs)(j.As,{value:"tools",children:[(0,a.jsx)(j.$m,{className:"text-base font-semibold",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"ツール"})]})}),(0,a.jsx)(j.ub,{className:"pt-2",children:X()})]})}),(0,a.jsx)("div",{children:(0,a.jsx)(q,{})})]})})]}),!e&&(0,a.jsx)(u.R,{onOpen:()=>t(!0),isDesktop:y,tabs:[{id:"settings",label:"テンプレート",icon:(0,a.jsx)(o.A,{className:"h-4 w-4"})},{id:"tools",label:"ツール",icon:(0,a.jsx)(c.A,{className:"h-4 w-4"})},{id:"layers",label:"レイヤー",icon:(0,a.jsx)(d.A,{className:"h-4 w-4"})}],onTabClick:e=>{console.log("Tab clicked:",e)}}),(0,a.jsx)(u.B,{isOpen:e,onClose:()=>t(!1),title:"",isDesktop:y,className:"lg:w-96",children:y?Y:B})]})]})}}},e=>{e.O(0,[772,96,76,358],()=>e(e.s=38073)),_N_E=e.O()}]);