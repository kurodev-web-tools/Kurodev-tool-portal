(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64],{6727:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>V});var l=s(36166),a=s(5766),r=s(82789),n=s(49227),i=s(66614),o=s(26423),c=s(2391),d=s(10508),h=s(87617),u=s(78926),m=s(1219),x=s(54038),p=s(86520),g=s(9885),v=s(388),f=s(89534),j=s(28448),w=s(43202),y=s(79583),b=s(31676),N=s(86821),k=s(35302),C=s(51549);let E={simple:"シンプル",cute:"かわいい",cool:"クール",stylish:"スタイリッシュ",elegant:"エレガント",modern:"モダン",vintage:"ヴィンテージ",minimal:"ミニマル",colorful:"カラフル",dark:"ダーク",bright:"ブライト",nature:"ナチュラル",urban:"アーバン",fantasy:"ファンタジー",retro:"レトロ",futuristic:"フューチャー",romantic:"ロマンチック",energetic:"エネルギッシュ",calm:"カーム",professional:"プロフェッショナル",casual:"カジュアル",formal:"フォーマル",playful:"プレイフル",serious:"シリアス",artistic:"アーティスティック",tech:"テック",gaming:"ゲーミング",music:"ミュージック",food:"フード",travel:"トラベル",fashion:"ファッション",beauty:"ビューティー",lifestyle:"ライフスタイル",business:"ビジネス",education:"エデュケーション",health:"ヘルス",sports:"スポーツ",entertainment:"エンターテイメント",news:"ニュース",technology:"テクノロジー",science:"サイエンス",culture:"カルチャー",social:"ソーシャル",personal:"パーソナル",creative:"クリエイティブ",innovative:"イノベーティブ",traditional:"トラディショナル",contemporary:"コンテンポラリー",experimental:"エクスペリメンタル",classic:"クラシック",trendy:"トレンディ",unique:"ユニーク",premium:"プレミアム",affordable:"アフォーダブル",luxury:"ラグジュアリー",eco:"エコ",sustainable:"サステナブル",organic:"オーガニック",digital:"デジタル",analog:"アナログ",hybrid:"ハイブリッド",pure:"ピュア",mixed:"ミックス",solid:"ソリッド",gradient:"グラデーション",pattern:"パターン",texture:"テクスチャー",geometric:"ジオメトリック",abstract:"アブストラクト",realistic:"リアリスティック",cartoon:"カートゥーン",anime:"アニメ",manga:"マンガ",illustration:"イラストレーション",photography:"フォトグラフィー",design:"デザイン",art:"アート",craft:"クラフト",handmade:"ハンドメイド",industrial:"インダストリアル",rustic:"ラスティック",cozy:"コージー",spacious:"スペーシャス",compact:"コンパクト",large:"ラージ",small:"スモール",medium:"ミディアム",extra:"エクストラ",mega:"メガ",micro:"マイクロ",macro:"マクロ",nano:"ナノ",pico:"ピコ",giga:"ギガ",kilo:"キロ",milli:"ミリ",centi:"センチ",deci:"デシ",deca:"デカ",hecto:"ヘクト",peta:"ペタ",exa:"エクサ",zetta:"ゼタ",yotta:"ヨタ",ronna:"ロナ",quetta:"クエタ",femto:"フェムト",atto:"アト",zepto:"ゼプト",yocto:"ヨクト",ronto:"ロント",quecto:"クエクト"},S=["1:1","4:3","9:16","16:9"],z=a.memo(e=>{let{onSelectTemplate:t,selectedTemplateId:s}=e,{aspectRatio:r,setAspectRatio:n,customAspectRatio:i,setCustomAspectRatio:o}=(0,w.S)(),[c,d]=(0,a.useState)([]),[h,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{u(!0),console.log("\uD83D\uDD04 テンプレート読み込み開始...");let e=await (0,C.K)();console.log("✅ テンプレート読み込み完了:",e.length,"個"),console.log("\uD83D\uDCDD 読み込まれたジャンル:",[...new Set(e.map(e=>e.genre))]),d(e)}catch(e){console.error("❌ テンプレート読み込み失敗:",e),d([])}finally{u(!1)}})()},[]);let m=(e,t)=>{let s=parseInt(e.target.value,10),l={...i,[t]:s};!isNaN(s)&&s>0&&(o(l),n("custom"))},p=(0,a.useMemo)(()=>{console.log("\uD83C\uDFAF 現在のアスペクト比:",r);let e=c.filter(e=>"custom"===r||e.supportedAspectRatios.includes(r));return console.log("\uD83D\uDD0D フィルタリング前のテンプレート数:",c.length),console.log("\uD83D\uDD0D フィルタリング後のテンプレート数:",e.length),console.log("\uD83D\uDCCB フィルタリング後のジャンル:",[...new Set(e.map(e=>e.genre))]),e},[c,r]),g=(0,a.useMemo)(()=>{let e=[...new Set(p.map(e=>e.genre))];return console.log("\uD83D\uDD0D 利用可能なジャンル:",e),console.log("\uD83D\uDCCA フィルタリングされたテンプレート数:",p.length),console.log("\uD83D\uDCCB 全テンプレート数:",c.length),console.log("\uD83C\uDFAF 現在のアスペクト比:",r),console.log("\uD83D\uDCDD 全ジャンル（フィルタリング前）:",[...new Set(c.map(e=>e.genre))]),e},[p,c,r]),z=(0,a.useMemo)(()=>(e=>{let t={};return e.forEach(e=>{t[e]=(e=>E[e]||e)(e)}),t})(g),[g]);return h?(0,l.jsx)("div",{className:"w-full p-4 text-center",children:(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"テンプレートを読み込み中..."})}):(0,l.jsxs)(j.nD,{type:"multiple",className:"w-full",defaultValue:["aspect-ratio","templates"],children:[(0,l.jsxs)(j.As,{value:"aspect-ratio",children:[(0,l.jsx)(j.$m,{children:"アスペクト比"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[(0,l.jsx)(v.J,{children:"プリセット"}),(0,l.jsx)(k.O,{type:"single",value:"custom"===r?"":r,onValueChange:e=>{e&&n(e)},variant:"outline",className:"flex-wrap justify-start",children:S.map(e=>(0,l.jsx)(k.d,{value:e,"aria-label":"比率 ".concat(e),children:e},e))}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{children:"手動設定"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(f.p,{type:"number",placeholder:"幅",className:"w-24",value:i.width,onChange:e=>m(e,"width")}),(0,l.jsx)("span",{children:":"}),(0,l.jsx)(f.p,{type:"number",placeholder:"高さ",className:"w-24",value:i.height,onChange:e=>m(e,"height")})]}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"小さい数字で比率、大きい数字で解像度を指定できます。"})]})]})]}),(0,l.jsxs)(j.As,{value:"templates",children:[(0,l.jsx)(j.$m,{children:"テンプレート選択"}),(0,l.jsx)(j.ub,{className:"pt-4",children:g.length>0?(0,l.jsxs)(x.tU,{defaultValue:g[0],className:"w-full",children:[(0,l.jsx)(x.j7,{className:(0,N.cn)("w-full",g.length<=4?1===g.length?"grid grid-cols-1":2===g.length?"grid grid-cols-2":3===g.length?"grid grid-cols-3":"grid grid-cols-4":"flex overflow-x-auto space-x-1 p-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"),children:g.map(e=>(0,l.jsx)(x.Xi,{value:e,className:g.length>4?"min-w-fit whitespace-nowrap":"",children:z[e]},e))}),g.map(e=>(0,l.jsx)(x.av,{value:e,children:(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2 mt-4",children:p.filter(t=>t.genre===e).map(e=>(0,l.jsx)(b.Zp,{className:(0,N.cn)("cursor-pointer hover:border-primary transition-colors group",s===e.id&&"border-primary ring-2 ring-primary"),onClick:()=>t(e),children:(0,l.jsx)(b.Wu,{className:"p-0 rounded-md",children:(0,l.jsx)("div",{className:(0,N.cn)("w-full rounded-md flex items-center justify-center relative overflow-hidden","1:1"===r?"aspect-square":"4:3"===r?"aspect-[4/3]":"9:16"===r?"aspect-[9/16]":"aspect-video"),children:(0,l.jsx)(y.default,{src:e.initialImageSrc,alt:e.name,fill:!0,style:{objectFit:"cover"},className:"transition-transform duration-300 group-hover:scale-105"})})})},e.id))})},e))]}):(0,l.jsx)("div",{className:"text-center text-sm text-muted-foreground py-4",children:"このアスペクト比に対応するテンプレートはありません。"})})]})]})});var R=s(72811),L=s(90542);let D=a.memo(e=>{let{id:t,isSelected:s,text:r,color:n="white",fontSize:i="2rem",className:o,x:c,y:d,width:h,height:u,rotation:m,zIndex:x,onDragStop:p,onResizeStop:g,enableResizing:v,disableDragging:f}=e,{updateLayer:j}=(0,w.S)(),[y,b]=(0,a.useState)({x:c,y:d}),[k,C]=(0,a.useState)(!1),E=(0,a.useRef)(null),S=(0,a.useRef)(null);(0,a.useEffect)(()=>{b({x:c,y:d})},[c,d]);let z=(0,a.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),C(!0);let l=null==(s=E.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let r=a.getBoundingClientRect(),n=r.left+y.x+h/2,i=r.top+y.y+u/2,o=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;j(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-i,s)+90})},c=()=>{C(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",c)};window.addEventListener("touchmove",o),window.addEventListener("touchend",c)},[t,j,y.x,y.y,h,u]);return(0,a.useEffect)(()=>{let e=S.current;if(e)return e.addEventListener("touchstart",z,{passive:!1}),()=>{e.removeEventListener("touchstart",z)}},[z]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R.p,{ref:E,size:{width:h,height:u},position:y,onDragStart:()=>{if(k)return!1},onDrag:(e,t)=>{k||b({x:t.x,y:t.y})},onDragStop:p,onResizeStop:g,minWidth:50,minHeight:20,enableResizing:v,disableDragging:f||k,className:"border border-dashed border-transparent hover:border-gray-500 transition-colors duration-200",style:{display:"flex",alignItems:"center",justifyContent:"center",zIndex:x},children:(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center",style:{transform:"rotate(".concat(m,"deg)"),transformOrigin:"center"},children:(0,l.jsx)("p",{className:(0,N.cn)("cursor-move",o),style:{color:n,fontSize:i,lineHeight:1,whiteSpace:"pre-wrap"},children:r})})}),s&&(0,l.jsx)("div",{ref:S,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),C(!0);let l=null==(s=E.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let r=a.getBoundingClientRect(),n=r.left+y.x+h/2,i=r.top+y.y+u/2,o=e=>{let s=e.clientX-n;j(t,{rotation:180/Math.PI*Math.atan2(e.clientY-i,s)+90})},c=()=>{C(!1),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",c)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",c)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-50",style:{left:y.x+h/2,top:y.y-30,transform:"translateX(-50%)"},children:(0,l.jsx)(L.A,{className:"h-4 w-4"})})]})}),A=a.memo(e=>{let{id:t,isSelected:s,src:r,alt:n,x:i,y:o,width:c,height:d,rotation:h,onDragStop:u,onResize:m,onResizeStop:x,onSelect:p,isLocked:g,isDraggable:v,lockAspectRatio:f,enableResizing:j,disableDragging:y,isBackground:b,zIndex:k}=e,{updateLayer:C}=(0,w.S)(),[E,S]=(0,a.useState)({x:i,y:o}),[z,D]=(0,a.useState)(!1),A=(0,a.useRef)(null),$=(0,a.useRef)(null);(0,a.useEffect)(()=>{S({x:i,y:o})},[i,o]);let F=(0,a.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),D(!0);let l=null==(s=A.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let r=a.getBoundingClientRect(),n=r.left+E.x+c/2,i=r.top+E.y+d/2,o=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;C(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-i,s)+90})},h=()=>{D(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",h)};window.addEventListener("touchmove",o),window.addEventListener("touchend",h)},[t,C,E.x,E.y,c,d]);return(0,a.useEffect)(()=>{let e=$.current;if(e)return e.addEventListener("touchstart",F,{passive:!1}),()=>{e.removeEventListener("touchstart",F)}},[F]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R.p,{ref:A,size:b?{width:"100%",height:"100%"}:{width:c,height:d},position:b?{x:0,y:0}:E,onDragStart:()=>{if(z||b)return!1},onDrag:(e,t)=>{z||b||S({x:t.x,y:t.y})},onDragStop:u,onResize:m,onResizeStop:x,lockAspectRatio:f,enableResizing:!b&&j,disableDragging:b||y||z,className:(0,N.cn)("border border-dashed border-transparent transition-colors duration-200",{"hover:border-gray-500":!b&&s}),onClick:p,style:{zIndex:k},children:(0,l.jsx)("div",{style:{width:"100%",height:"100%",transform:"rotate(".concat(h,"deg)"),transformOrigin:"center"},children:(0,l.jsx)("div",{style:{width:"100%",height:"100%",backgroundImage:r?"url(".concat(r,")"):"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},title:n})})}),s&&!g&&!b&&(0,l.jsx)("div",{ref:$,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),D(!0);let l=null==(s=A.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let r=a.getBoundingClientRect(),n=r.left+E.x+c/2,i=r.top+E.y+d/2,o=e=>{let s=e.clientX-n;C(t,{rotation:180/Math.PI*Math.atan2(e.clientY-i,s)+90})},h=()=>{D(!1),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",h)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",h)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-50",style:{left:E.x+c/2,top:E.y-30,transform:"translateX(-50%)"},children:(0,l.jsx)(L.A,{className:"h-4 w-4"})})]})}),$=e=>{let{id:t,isSelected:s,shapeType:r,backgroundColor:n,borderColor:i,borderWidth:o,rotation:c,zIndex:d,onDragStop:h,onResize:u,onResizeStop:m,lockAspectRatio:x,enableResizing:p,disableDragging:g,x:v,y:f,width:j,height:y}=e,{updateLayer:b}=(0,w.S)(),[N,k]=(0,a.useState)({x:v||0,y:f||0}),[C,E]=(0,a.useState)(!1),S=(0,a.useRef)(null),z=(0,a.useRef)(null);(0,a.useEffect)(()=>{k({x:v||0,y:f||0})},[v,f]);let D=(0,a.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),E(!0);let l=null==(s=S.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let r=a.getBoundingClientRect(),n=r.left+N.x+j/2,i=r.top+N.y+y/2,o=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;b(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-i,s)+90})},c=()=>{E(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",c)};window.addEventListener("touchmove",o),window.addEventListener("touchend",c)},[t,b,N.x,N.y,j,y]);return(0,a.useEffect)(()=>{let e=z.current;if(e)return e.addEventListener("touchstart",D,{passive:!1}),()=>{e.removeEventListener("touchstart",D)}},[D]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R.p,{ref:S,size:{width:j,height:y},position:N,onDragStart:()=>{if(C)return!1},onDrag:(e,t)=>{C||k({x:t.x,y:t.y})},onDragStop:h,onResize:u,onResizeStop:m,lockAspectRatio:x,enableResizing:p,disableDragging:g||C,className:"border border-dashed border-transparent hover:border-gray-500 transition-colors duration-200",style:{zIndex:d},children:(0,l.jsx)("div",{style:{width:"100%",height:"100%",transform:"rotate(".concat(c,"deg)"),transformOrigin:"center"},children:(()=>{let e={width:"100%",height:"100%",style:{overflow:"visible"}};switch(r){case"line":return(0,l.jsx)("svg",{...e,children:(0,l.jsx)("line",{x1:0,y1:y/2,x2:j,y2:y/2,stroke:i,strokeWidth:o})});case"arrow":return(0,l.jsxs)("svg",{...e,children:[(0,l.jsx)("defs",{children:(0,l.jsx)("marker",{id:"arrowhead-".concat(t),markerWidth:"10",markerHeight:"7",refX:"10",refY:"3.5",orient:"auto",fill:i,children:(0,l.jsx)("polygon",{points:"0 0, 10 3.5, 0 7"})})}),(0,l.jsx)("line",{x1:0,y1:y/2,x2:j-10,y2:y/2,stroke:i,strokeWidth:o,markerEnd:"url(#arrowhead-".concat(t,")")})]});default:return(0,l.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:n,border:"".concat(o,"px solid ").concat(i),borderRadius:"circle"===r?"50%":"0"}})}})()})}),s&&(0,l.jsx)("div",{ref:z,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),E(!0);let l=null==(s=S.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let r=a.getBoundingClientRect(),n=r.left+N.x+j/2,i=r.top+N.y+y/2,o=e=>{let s=e.clientX-n;b(t,{rotation:180/Math.PI*Math.atan2(e.clientY-i,s)+90})},c=()=>{E(!1),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",c)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",c)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-50",style:{left:N.x+j/2,top:N.y-30,transform:"translateX(-50%)"},children:(0,l.jsx)(L.A,{className:"h-4 w-4"})})]})};var F=s(57347),P=s(54654),I=s(94431),M=s(23191),J=s(28647),W=s(87727),X=s(58421),B=s(99955);let O=()=>{let{layers:e,updateLayer:t,removeLayer:s,selectedLayerId:a,setSelectedLayerId:r,reorderLayers:n,duplicateLayer:o,moveLayerUp:c,moveLayerDown:d}=(0,w.S)();return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"レイヤー"}),(0,l.jsx)(X.F,{className:"h-[calc(100vh-250px)] w-full rounded-md border p-4",children:0===e.length?(0,l.jsx)("p",{className:"text-muted-foreground",children:"レイヤーがありません。"}):(0,l.jsx)(B.JY,{onDragEnd:e=>{e.destination&&n(e.source.index,e.destination.index)},children:(0,l.jsx)(B.gL,{droppableId:"layers",children:n=>(0,l.jsxs)("div",{...n.droppableProps,ref:n.innerRef,className:"space-y-2",children:[e.map((n,h)=>(0,l.jsx)(B.sx,{draggableId:n.id,index:h,children:(u,m)=>(0,l.jsxs)("div",{ref:u.innerRef,...u.draggableProps,...u.dragHandleProps,className:"flex items-center justify-between p-2 rounded-md border ".concat(a===n.id?"bg-accent":"bg-card"," ").concat(m.isDragging?"shadow-lg opacity-90 bg-blue-100":""),onClick:()=>r(n.id),children:[(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)("span",{className:"text-sm font-medium truncate w-24",children:n.name})}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(i.$,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),c(n.id)},disabled:0===h,children:(0,l.jsx)(F.A,{className:"h-4 w-4"})}),(0,l.jsx)(i.$,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),d(n.id)},disabled:h===e.length-1,children:(0,l.jsx)(P.A,{className:"h-4 w-4"})}),(0,l.jsx)(i.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),(s=>{var l;t(s,{visible:!(null==(l=e.find(e=>e.id===s))?void 0:l.visible)})})(n.id)},children:n.visible?(0,l.jsx)(I.A,{className:"h-4 w-4"}):(0,l.jsx)(M.A,{className:"h-4 w-4"})}),(0,l.jsx)(i.$,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),o(n.id)},children:(0,l.jsx)(J.A,{className:"h-4 w-4"})}),(0,l.jsx)(i.$,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),s(n.id)},children:(0,l.jsx)(W.A,{className:"h-4 w-4 text-red-500"})})]})]})},n.id)),n.placeholder]})})})})]})},T=["image/jpeg","image/jpg","image/png","image/webp"];function V(){let{isOpen:e,setIsOpen:t,isDesktop:s}=(0,h.c)({defaultOpen:!1,desktopDefaultOpen:!0}),[y,b]=a.useState("settings"),[N,k]=a.useState(!1),{handleAsyncError:C}=(0,u.u)(),{selectedTemplate:E,setSelectedTemplate:S,currentText:R,setCurrentText:L,layers:F,addLayer:P,updateLayer:I,selectedLayerId:M,setSelectedLayerId:J,aspectRatio:W,customAspectRatio:X}=(0,w.S)(),B=F.find(e=>e.id===M);a.useEffect(()=>{let e=e=>{"Shift"===e.key&&k(!0)},t=e=>{"Shift"===e.key&&k(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),a.useEffect(()=>{s?t(!0):t(!1)},[s]);let V=a.useCallback(async e=>{await C(async()=>{let t,s=document.getElementById("download-target");if(!s)throw Error("ダウンロード対象の要素が見つかりません");switch(e){case"normal":default:t=720;break;case"high":t=1080;break;case"super":t=2160}let l=16/9;if("custom"===W)X.width>0&&X.height>0&&(l=X.width/X.height);else{let[e,t]=W.split(":").map(Number);e>0&&t>0&&(l=e/t)}let a=Math.round(t*l),n=t,i=await (0,r.$E)(s,{cacheBust:!0,width:a,height:n}),o=document.createElement("a");o.download="creative_".concat(e,".png"),o.href=i,o.click()},"画像の生成に失敗しました")},[W,X,C]),Y=a.useCallback((e,t,s)=>{I(e,{x:s.x,y:s.y})},[I]),_=a.useCallback((e,t,s,l,a)=>{I(e,{width:s.offsetWidth,height:s.offsetHeight,x:a.x,y:a.y})},[I]),H=e=>{let t=e.target.files;if(t){for(let e of Array.from(t)){if(e.size>0xa00000){n.oR.error("ファイルサイズが大きすぎます: ".concat(e.name),{description:"10MB以下のファイルを選択してください。"});continue}if(!T.includes(e.type)){n.oR.error("ファイル形式が無効です: ".concat(e.name),{description:"JPEG, PNG, WEBP形式の画像ファイルを選択してください。"});continue}let t=URL.createObjectURL(e);P({type:"image",name:e.name,visible:!0,locked:!1,x:s?550:50,y:s?250:50,width:s?300:150,height:s?300:150,src:t})}e.target.value=""}},q=e=>{let t=F.filter(e=>"shape"===e.type).length*(s?20:5),l=F.filter(t=>t.shapeType===e).length+1,a="",r=s?550:10,n=s?250:10,i=s?300:50,o=s?300:50,c=s?2:1,d=s?300:100,h=s?5:3;switch(e){case"rectangle":a="四角 ".concat(l);break;case"circle":a="円 ".concat(l);break;case"line":a="線 ".concat(l);break;case"arrow":a="矢印 ".concat(l)}P({type:"shape",shapeType:e,name:a,visible:!0,locked:!1,x:r+t,y:n+t,width:"line"===e||"arrow"===e?d:i,height:"line"===e||"arrow"===e?h:o,backgroundColor:"#cccccc",borderColor:"#000000",borderWidth:c})},U=()=>{P({type:"text",name:"テキスト ".concat(F.filter(e=>"text"===e.type).length+1),visible:!0,locked:!1,x:s?550:50,y:s?250:50,width:s?300:150,height:s?100:50,text:R,color:"#000000",fontSize:s?"2rem":"1rem"})};if(!E)return(0,l.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,l.jsx)("p",{children:"テンプレートを読み込み中..."})});let G=(0,l.jsxs)(x.tU,{value:y,onValueChange:b,className:"w-full",children:[(0,l.jsxs)(x.j7,{className:"grid w-full grid-cols-3",children:[(0,l.jsx)(x.Xi,{value:"settings",children:"テンプレート"}),(0,l.jsx)(x.Xi,{value:"tools",children:"ツール"}),(0,l.jsx)(x.Xi,{value:"layers",children:"レイヤー"})]}),(0,l.jsx)(x.av,{value:"settings",className:"mt-4",children:(0,l.jsx)(z,{onSelectTemplate:S,selectedTemplateId:E.id})}),(0,l.jsx)(x.av,{value:"tools",className:"mt-4",children:(0,l.jsxs)(j.nD,{type:"multiple",className:"w-full",defaultValue:["text"],children:[(0,l.jsxs)(j.As,{value:"text",children:[(0,l.jsx)(j.$m,{children:"テキスト"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"thumbnail-text",children:"テキスト内容"}),(0,l.jsx)(p.T,{id:"thumbnail-text",value:R,onChange:e=>L(e.target.value),className:"h-24"})]}),(0,l.jsx)("div",{className:"pt-4",children:(0,l.jsx)(i.$,{variant:"outline",className:"w-full",onClick:U,children:"テキストを追加"})})]})]}),(0,l.jsxs)(j.As,{value:"images",children:[(0,l.jsx)(j.$m,{children:"画像"}),(0,l.jsx)(j.ub,{className:"space-y-4 pt-4",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"add-images",children:"画像を追加"}),(0,l.jsx)(f.p,{id:"add-images",type:"file",accept:"image/*",multiple:!0,onChange:H})]})})]}),(0,l.jsxs)(j.As,{value:"shapes",children:[(0,l.jsx)(j.$m,{children:"図形"}),(0,l.jsx)(j.ub,{className:"space-y-4 pt-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)(i.$,{variant:"outline",onClick:()=>q("rectangle"),children:"四角を追加"}),(0,l.jsx)(i.$,{variant:"outline",onClick:()=>q("circle"),children:"円を追加"}),(0,l.jsx)(i.$,{variant:"outline",onClick:()=>q("line"),children:"線を追加"}),(0,l.jsx)(i.$,{variant:"outline",onClick:()=>q("arrow"),children:"矢印を追加"})]})})]}),(0,l.jsxs)(j.As,{value:"style",children:[(0,l.jsx)(j.$m,{children:"スタイル"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[!B&&(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"レイヤーを選択してください"}),(null==B?void 0:B.type)==="text"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"text-color",children:"テキストカラー"}),(0,l.jsx)("input",{id:"text-color",type:"color",value:B.color,onChange:e=>I(B.id,{color:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(v.J,{htmlFor:"font-size",children:["フォントサイズ (",B.fontSize,")"]}),(0,l.jsx)(g.A,{id:"font-size",min:1,max:8,step:.1,value:[parseFloat(B.fontSize||"1")],onValueChange:e=>I(B.id,{fontSize:"".concat(e[0],"rem")})})]})]}),(null==B?void 0:B.type)==="shape"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"shape-fill",children:"塗りつぶし"}),(0,l.jsx)("input",{id:"shape-fill",type:"color",value:B.backgroundColor,onChange:e=>I(B.id,{backgroundColor:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"shape-stroke",children:"枠線"}),(0,l.jsx)("input",{id:"shape-stroke",type:"color",value:B.borderColor,onChange:e=>I(B.id,{borderColor:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(v.J,{htmlFor:"shape-stroke-width",children:["枠線の太さ (",B.borderWidth,"px)"]}),(0,l.jsx)(g.A,{id:"shape-stroke-width",min:0,max:20,step:1,value:[B.borderWidth||0],onValueChange:e=>I(B.id,{borderWidth:e[0]})})]})]})]})]})]})}),(0,l.jsx)(x.av,{value:"layers",className:"mt-4",children:(0,l.jsx)(O,{})})]}),K=(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"テンプレート選択"})}),(0,l.jsx)(z,{onSelectTemplate:S,selectedTemplateId:E.id})]});return(0,l.jsxs)("div",{className:"relative flex flex-col lg:h-screen",children:[e&&!s&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>t(!1)}),(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row flex-grow lg:h-full lg:overflow-y-auto",children:[(0,l.jsxs)("main",{className:"flex-1 overflow-y-auto p-2 pt-20 lg:p-4 lg:pt-4",children:[(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{id:"thumbnail-preview",style:{aspectRatio:"custom"===W?"".concat(X.width," / ").concat(X.height):W.replace(":"," / ")},className:"w-full bg-card relative border rounded-md",children:(0,l.jsx)("div",{id:"download-target",className:"w-full h-full relative overflow-hidden",children:F.map(e=>{let t=e.id===M,s=t&&!e.locked,a=t&&!e.locked;return e.visible?"image"===e.type?(0,l.jsx)(A,{id:e.id,isSelected:t,src:e.src||"",alt:e.name,x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>Y(e.id,t,s),onResize:(t,s,l,a,r)=>_(e.id,s,l,a,r),onResizeStop:(t,s,l,a,r)=>_(e.id,s,l,a,r),lockAspectRatio:N,enableResizing:a,disableDragging:!s,onSelect:()=>J(e.id),isLocked:e.locked,isDraggable:s,onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{},isBackground:e.isBackground,zIndex:e.zIndex},e.id):"text"===e.type?(0,l.jsx)(D,{id:e.id,isSelected:t,text:e.text||"",color:e.color||"#000000",fontSize:e.fontSize||"1rem",x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>Y(e.id,t,s),onResizeStop:(t,s,l,a,r)=>_(e.id,s,l,a,r),enableResizing:a,disableDragging:!s,zIndex:e.zIndex},e.id):"shape"===e.type&&e.shapeType?(0,l.jsx)($,{id:e.id,isSelected:t,shapeType:e.shapeType,backgroundColor:e.backgroundColor||"#cccccc",borderColor:e.borderColor||"#000000",borderWidth:e.borderWidth||0,x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>Y(e.id,t,s),onResize:(t,s,l,a,r)=>_(e.id,s,l,a,r),onResizeStop:(t,s,l,a,r)=>_(e.id,s,l,a,r),lockAspectRatio:N,enableResizing:a,disableDragging:!s,zIndex:e.zIndex},e.id):null:null})})}),(0,l.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,l.jsx)(i.$,{onClick:()=>V("normal"),size:"sm",children:"通常画質"}),(0,l.jsx)(i.$,{onClick:()=>V("high"),size:"sm",children:"高画質"}),(0,l.jsx)(i.$,{onClick:()=>V("super"),size:"sm",children:"最高画質"})]})]}),!s&&(0,l.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,l.jsx)("div",{className:"bg-card border rounded-lg p-4",children:(0,l.jsx)(j.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,l.jsxs)(j.As,{value:"tools",children:[(0,l.jsx)(j.$m,{children:(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"ツール"})}),(0,l.jsx)(j.ub,{className:"pt-4",children:(0,l.jsxs)(j.nD,{type:"multiple",className:"w-full",defaultValue:["text"],children:[(0,l.jsxs)(j.As,{value:"text",children:[(0,l.jsx)(j.$m,{children:"テキスト"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"thumbnail-text",children:"テキスト内容"}),(0,l.jsx)(p.T,{id:"thumbnail-text",value:R,onChange:e=>L(e.target.value),className:"h-24"})]}),(0,l.jsx)("div",{className:"pt-4",children:(0,l.jsx)(i.$,{variant:"outline",className:"w-full",onClick:U,children:"テキストを追加"})})]})]}),(0,l.jsxs)(j.As,{value:"images",children:[(0,l.jsx)(j.$m,{children:"画像"}),(0,l.jsx)(j.ub,{className:"space-y-4 pt-4",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"add-images",children:"画像を追加"}),(0,l.jsx)(f.p,{id:"add-images",type:"file",accept:"image/*",multiple:!0,onChange:H})]})})]}),(0,l.jsxs)(j.As,{value:"shapes",children:[(0,l.jsx)(j.$m,{children:"図形"}),(0,l.jsx)(j.ub,{className:"space-y-4 pt-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)(i.$,{variant:"outline",onClick:()=>q("rectangle"),children:"四角を追加"}),(0,l.jsx)(i.$,{variant:"outline",onClick:()=>q("circle"),children:"円を追加"}),(0,l.jsx)(i.$,{variant:"outline",onClick:()=>q("line"),children:"線を追加"}),(0,l.jsx)(i.$,{variant:"outline",onClick:()=>q("arrow"),children:"矢印を追加"})]})})]}),(0,l.jsxs)(j.As,{value:"style",children:[(0,l.jsx)(j.$m,{children:"スタイル"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[!B&&(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"レイヤーを選択してください"}),(null==B?void 0:B.type)==="text"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"text-color",children:"テキストカラー"}),(0,l.jsx)("input",{id:"text-color",type:"color",value:B.color,onChange:e=>I(B.id,{color:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(v.J,{htmlFor:"font-size",children:["フォントサイズ (",B.fontSize,")"]}),(0,l.jsx)(g.A,{id:"font-size",min:1,max:8,step:.1,value:[parseFloat(B.fontSize||"1")],onValueChange:e=>I(B.id,{fontSize:"".concat(e[0],"rem")})})]})]}),(null==B?void 0:B.type)==="shape"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"shape-fill",children:"塗りつぶし"}),(0,l.jsx)("input",{id:"shape-fill",type:"color",value:B.backgroundColor,onChange:e=>I(B.id,{backgroundColor:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"shape-stroke",children:"枠線"}),(0,l.jsx)("input",{id:"shape-stroke",type:"color",value:B.borderColor,onChange:e=>I(B.id,{borderColor:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(v.J,{htmlFor:"shape-stroke-width",children:["枠線の太さ (",B.borderWidth,"px)"]}),(0,l.jsx)(g.A,{id:"shape-stroke-width",min:0,max:20,step:1,value:[B.borderWidth||0],onValueChange:e=>I(B.id,{borderWidth:e[0]})})]})]})]})]})]})})]})})}),(0,l.jsx)("div",{className:"bg-card border rounded-lg p-4",children:(0,l.jsx)(O,{})})]})]}),!e&&(0,l.jsx)(m.R,{onOpen:()=>t(!0),isDesktop:s,tabs:[{id:"settings",label:"テンプレート",icon:(0,l.jsx)(o.A,{className:"h-4 w-4"})},{id:"tools",label:"ツール",icon:(0,l.jsx)(c.A,{className:"h-4 w-4"})},{id:"layers",label:"レイヤー",icon:(0,l.jsx)(d.A,{className:"h-4 w-4"})}],onTabClick:e=>{console.log("Tab clicked:",e)}}),(0,l.jsx)(m.B,{isOpen:e,onClose:()=>t(!1),title:"",isDesktop:s,className:"lg:w-1/4",children:s?G:K})]})]})}},80318:(e,t,s)=>{Promise.resolve().then(s.bind(s,6727))}},e=>{e.O(0,[96,76,358],()=>e(e.s=80318)),_N_E=e.O()}]);