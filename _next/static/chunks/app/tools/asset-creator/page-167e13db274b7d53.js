(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64],{50811:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>U});var l=s(36166),a=s(5766),i=s(82789),n=s(49227),r=s(66614),o=s(26423),c=s(2391),d=s(10508),h=s(87617),u=s(78926),m=s(1219),x=s(54038),p=s(86520),g=s(9885),v=s(388),f=s(89534),j=s(28448);let w=async()=>{try{try{let e=await s.e(860).then(s.t.bind(s,77860,19));return console.log("Loaded ".concat(e.templates.length," templates from generated JSON file")),e.templates}catch(e){return console.warn("Could not load templates from JSON file:",e),[]}}catch(e){throw console.error("Failed to load templates:",e),Error("Failed to load templates.")}};var y=s(70400);let b=(0,a.createContext)(null),N=e=>{let{children:t}=e,[s,i]=(0,a.useState)(null),[n,r]=(0,a.useState)(""),[o,c]=(0,a.useState)("16:9"),[d,h]=(0,a.useState)({width:16,height:9}),[u,m]=(0,a.useState)([]),[x,p]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{let e=await w();e.length>0&&(i(e[0]),r(e[0].initialText))})()},[]);let g=(e,t)=>{m(s=>{let l=Array.from(s),[a]=l.splice(e,1);return l.splice(t,0,a),l.map((e,t)=>({...e,zIndex:t}))})};return(0,a.useEffect)(()=>{var e,t,l,a,i;let n=[];if(!s){m([]),p(null);return}s.initialImageSrc&&n.push({id:"background-image",type:"image",name:"背景画像",visible:!0,locked:!1,x:0,y:0,width:"100%",height:"100%",rotation:0,src:s.initialImageSrc,zIndex:0,isBackground:!0}),s.initialText&&n.push({id:(0,y.A)(),type:"text",name:"テキスト",visible:!0,locked:!1,x:(null==(t=s.initialTextPosition)?void 0:t.x)||50,y:(null==(l=s.initialTextPosition)?void 0:l.y)||50,width:(null==(a=s.initialTextPosition)?void 0:a.width)||300,height:(null==(i=s.initialTextPosition)?void 0:i.height)||100,rotation:0,text:s.initialText,color:s.initialTextColor,fontSize:s.initialFontSize,zIndex:1}),m(n),p(n.length>1?n[1].id:(null==(e=n[0])?void 0:e.id)||null)},[s]),(0,l.jsx)(b.Provider,{value:{selectedTemplate:s,setSelectedTemplate:i,currentText:n,setCurrentText:r,layers:u,setLayers:m,addLayer:e=>{let t=u.reduce((e,t)=>Math.max(e,t.zIndex),-1),s={...e,id:(0,y.A)(),rotation:0,zIndex:t+1};m(e=>[...e,s]),p(s.id)},removeLayer:e=>{m(t=>t.filter(t=>t.id!==e)),x===e&&p(null)},updateLayer:(e,t)=>{m(s=>s.map(s=>s.id===e?{...s,...t}:s))},selectedLayerId:x,setSelectedLayerId:p,reorderLayers:g,duplicateLayer:e=>{let t=u.find(t=>t.id===e);if(!t)return;let s={...t,id:(0,y.A)(),name:"".concat(t.name,"のコピー"),x:t.x+20,y:t.y+20,zIndex:u.length},l=u.findIndex(t=>t.id===e),a=[...u];a.splice(l+1,0,s),m(a.map((e,t)=>({...e,zIndex:t})))},moveLayerUp:e=>{let t=u.findIndex(t=>t.id===e);t>0&&g(t,t-1)},moveLayerDown:e=>{let t=u.findIndex(t=>t.id===e);t<u.length-1&&-1!==t&&g(t,t+1)},aspectRatio:o,setAspectRatio:c,customAspectRatio:d,setCustomAspectRatio:h},children:t})},k=()=>{let e=(0,a.useContext)(b);if(!e)throw Error("useTemplate must be used within a TemplateProvider");return e};var C=s(50521),E=s(31676),S=s(86821),z=s(35302);let R={simple:"シンプル",cute:"かわいい",cool:"クール",stylish:"スタイリッシュ",elegant:"エレガント",modern:"モダン",vintage:"ヴィンテージ",minimal:"ミニマル",colorful:"カラフル",dark:"ダーク",bright:"ブライト",nature:"ナチュラル",urban:"アーバン",fantasy:"ファンタジー",retro:"レトロ",futuristic:"フューチャー",romantic:"ロマンチック",energetic:"エネルギッシュ",calm:"カーム",professional:"プロフェッショナル",casual:"カジュアル",formal:"フォーマル",playful:"プレイフル",serious:"シリアス",artistic:"アーティスティック",tech:"テック",gaming:"ゲーミング",music:"ミュージック",food:"フード",travel:"トラベル",fashion:"ファッション",beauty:"ビューティー",lifestyle:"ライフスタイル",business:"ビジネス",education:"エデュケーション",health:"ヘルス",sports:"スポーツ",entertainment:"エンターテイメント",news:"ニュース",technology:"テクノロジー",science:"サイエンス",culture:"カルチャー",social:"ソーシャル",personal:"パーソナル",creative:"クリエイティブ",innovative:"イノベーティブ",traditional:"トラディショナル",contemporary:"コンテンポラリー",experimental:"エクスペリメンタル",classic:"クラシック",trendy:"トレンディ",unique:"ユニーク",premium:"プレミアム",affordable:"アフォーダブル",luxury:"ラグジュアリー",eco:"エコ",sustainable:"サステナブル",organic:"オーガニック",digital:"デジタル",analog:"アナログ",hybrid:"ハイブリッド",pure:"ピュア",mixed:"ミックス",solid:"ソリッド",gradient:"グラデーション",pattern:"パターン",texture:"テクスチャー",geometric:"ジオメトリック",abstract:"アブストラクト",realistic:"リアリスティック",cartoon:"カートゥーン",anime:"アニメ",manga:"マンガ",illustration:"イラストレーション",photography:"フォトグラフィー",design:"デザイン",art:"アート",craft:"クラフト",handmade:"ハンドメイド",industrial:"インダストリアル",rustic:"ラスティック",cozy:"コージー",spacious:"スペーシャス",compact:"コンパクト",large:"ラージ",small:"スモール",medium:"ミディアム",extra:"エクストラ",mega:"メガ",micro:"マイクロ",macro:"マクロ",nano:"ナノ",pico:"ピコ",giga:"ギガ",kilo:"キロ",milli:"ミリ",centi:"センチ",deci:"デシ",deca:"デカ",hecto:"ヘクト",peta:"ペタ",exa:"エクサ",zetta:"ゼタ",yotta:"ヨタ",ronna:"ロナ",quetta:"クエタ",femto:"フェムト",atto:"アト",zepto:"ゼプト",yocto:"ヨクト",ronto:"ロント",quecto:"クエクト"},L=["1:1","4:3","9:16","16:9"],D=a.memo(e=>{let{onSelectTemplate:t,selectedTemplateId:s}=e,{aspectRatio:i,setAspectRatio:n,customAspectRatio:r,setCustomAspectRatio:o}=k(),[c,d]=(0,a.useState)([]),[h,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{u(!0),console.log("\uD83D\uDD04 テンプレート読み込み開始...");let e=await w();console.log("✅ テンプレート読み込み完了:",e.length,"個"),console.log("\uD83D\uDCDD 読み込まれたジャンル:",[...new Set(e.map(e=>e.genre))]),d(e)}catch(e){console.error("❌ テンプレート読み込み失敗:",e),d([])}finally{u(!1)}})()},[]);let m=(e,t)=>{let s=parseInt(e.target.value,10),l={...r,[t]:s};!isNaN(s)&&s>0&&(o(l),n("custom"))},p=(0,a.useMemo)(()=>{console.log("\uD83C\uDFAF 現在のアスペクト比:",i);let e=c.filter(e=>"custom"===i||e.supportedAspectRatios.includes(i));return console.log("\uD83D\uDD0D フィルタリング前のテンプレート数:",c.length),console.log("\uD83D\uDD0D フィルタリング後のテンプレート数:",e.length),console.log("\uD83D\uDCCB フィルタリング後のジャンル:",[...new Set(e.map(e=>e.genre))]),e},[c,i]),g=(0,a.useMemo)(()=>{let e=[...new Set(p.map(e=>e.genre))];return console.log("\uD83D\uDD0D 利用可能なジャンル:",e),console.log("\uD83D\uDCCA フィルタリングされたテンプレート数:",p.length),console.log("\uD83D\uDCCB 全テンプレート数:",c.length),console.log("\uD83C\uDFAF 現在のアスペクト比:",i),console.log("\uD83D\uDCDD 全ジャンル（フィルタリング前）:",[...new Set(c.map(e=>e.genre))]),e},[p,c,i]),y=(0,a.useMemo)(()=>(e=>{let t={};return e.forEach(e=>{t[e]=(e=>R[e]||e)(e)}),t})(g),[g]);return h?(0,l.jsx)("div",{className:"w-full p-4 text-center",children:(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"テンプレートを読み込み中..."})}):(0,l.jsxs)(j.nD,{type:"multiple",className:"w-full",defaultValue:["aspect-ratio","templates"],children:[(0,l.jsxs)(j.As,{value:"aspect-ratio",children:[(0,l.jsx)(j.$m,{children:"アスペクト比"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[(0,l.jsx)(v.J,{children:"プリセット"}),(0,l.jsx)(z.O,{type:"single",value:"custom"===i?"":i,onValueChange:e=>{e&&n(e)},variant:"outline",className:"flex-wrap justify-start",children:L.map(e=>(0,l.jsx)(z.d,{value:e,"aria-label":"比率 ".concat(e),children:e},e))}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{children:"手動設定"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(f.p,{type:"number",placeholder:"幅",className:"w-24",value:r.width,onChange:e=>m(e,"width")}),(0,l.jsx)("span",{children:":"}),(0,l.jsx)(f.p,{type:"number",placeholder:"高さ",className:"w-24",value:r.height,onChange:e=>m(e,"height")})]}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"小さい数字で比率、大きい数字で解像度を指定できます。"})]})]})]}),(0,l.jsxs)(j.As,{value:"templates",children:[(0,l.jsx)(j.$m,{children:"テンプレート選択"}),(0,l.jsx)(j.ub,{className:"pt-4",children:g.length>0?(0,l.jsxs)(x.tU,{defaultValue:g[0],className:"w-full",children:[(0,l.jsx)(x.j7,{className:(0,S.cn)("w-full",g.length<=4?1===g.length?"grid grid-cols-1":2===g.length?"grid grid-cols-2":3===g.length?"grid grid-cols-3":"grid grid-cols-4":"flex overflow-x-auto space-x-1 p-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"),children:g.map(e=>(0,l.jsx)(x.Xi,{value:e,className:g.length>4?"min-w-fit whitespace-nowrap":"",children:y[e]},e))}),g.map(e=>(0,l.jsx)(x.av,{value:e,children:(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2 mt-4",children:p.filter(t=>t.genre===e).map(e=>(0,l.jsx)(E.Zp,{className:(0,S.cn)("cursor-pointer hover:border-primary transition-colors group",s===e.id&&"border-primary ring-2 ring-primary"),onClick:()=>t(e),children:(0,l.jsx)(E.Wu,{className:"p-0 rounded-md",children:(0,l.jsx)("div",{className:(0,S.cn)("w-full rounded-md flex items-center justify-center relative overflow-hidden","1:1"===i?"aspect-square":"4:3"===i?"aspect-[4/3]":"9:16"===i?"aspect-[9/16]":"aspect-video"),children:(0,l.jsx)(C.wF,{src:e.initialImageSrc,alt:e.name,aspectRatio:"16:9",breakpoints:{sm:200,md:250,lg:300},style:{objectFit:"cover"},className:"transition-transform duration-300 group-hover:scale-105"})})})},e.id))})},e))]}):(0,l.jsx)("div",{className:"text-center text-sm text-muted-foreground py-4",children:"このアスペクト比に対応するテンプレートはありません。"})})]})]})});var A=s(72811),I=s(90542);let P=a.memo(e=>{let{id:t,isSelected:s,text:i,color:n="white",fontSize:r="2rem",className:o,x:c,y:d,width:h,height:u,rotation:m,zIndex:x,onDragStop:p,onResizeStop:g,enableResizing:v,disableDragging:f}=e,{updateLayer:j}=k(),[w,y]=(0,a.useState)({x:c,y:d}),[b,N]=(0,a.useState)(!1),C=(0,a.useRef)(null),E=(0,a.useRef)(null);(0,a.useEffect)(()=>{y({x:c,y:d})},[c,d]);let z=(0,a.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),N(!0);let l=null==(s=C.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let i=a.getBoundingClientRect(),n=i.left+w.x+h/2,r=i.top+w.y+u/2,o=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;j(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-r,s)+90})},c=()=>{N(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",c)};window.addEventListener("touchmove",o),window.addEventListener("touchend",c)},[t,j,w.x,w.y,h,u]);return(0,a.useEffect)(()=>{let e=E.current;if(e)return e.addEventListener("touchstart",z,{passive:!1}),()=>{e.removeEventListener("touchstart",z)}},[z]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(A.p,{ref:C,size:{width:h,height:u},position:w,onDragStart:()=>{if(b)return!1},onDrag:(e,t)=>{b||y({x:t.x,y:t.y})},onDragStop:p,onResizeStop:g,minWidth:50,minHeight:20,enableResizing:v,disableDragging:f||b,className:"border border-dashed border-transparent hover:border-gray-500 transition-colors duration-200",style:{display:"flex",alignItems:"center",justifyContent:"center",zIndex:x},children:(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center",style:{transform:"rotate(".concat(m,"deg)"),transformOrigin:"center"},children:(0,l.jsx)("p",{className:(0,S.cn)("cursor-move",o),style:{color:n,fontSize:r,lineHeight:1,whiteSpace:"pre-wrap"},children:i})})}),s&&(0,l.jsx)("div",{ref:E,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),N(!0);let l=null==(s=C.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let i=a.getBoundingClientRect(),n=i.left+w.x+h/2,r=i.top+w.y+u/2,o=e=>{let s=e.clientX-n;j(t,{rotation:180/Math.PI*Math.atan2(e.clientY-r,s)+90})},c=()=>{N(!1),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",c)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",c)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-50",style:{left:w.x+h/2,top:w.y-30,transform:"translateX(-50%)"},children:(0,l.jsx)(I.A,{className:"h-4 w-4"})})]})}),F=a.memo(e=>{let{id:t,isSelected:s,src:i,alt:n,x:r,y:o,width:c,height:d,rotation:h,onDragStop:u,onResize:m,onResizeStop:x,onSelect:p,isLocked:g,isDraggable:v,lockAspectRatio:f,enableResizing:j,disableDragging:w,isBackground:y,zIndex:b}=e,{updateLayer:N}=k(),[C,E]=(0,a.useState)({x:r,y:o}),[z,R]=(0,a.useState)(!1),L=(0,a.useRef)(null),D=(0,a.useRef)(null);(0,a.useEffect)(()=>{E({x:r,y:o})},[r,o]);let P=(0,a.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),R(!0);let l=null==(s=L.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let i=a.getBoundingClientRect(),n=i.left+C.x+c/2,r=i.top+C.y+d/2,o=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;N(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-r,s)+90})},h=()=>{R(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",h)};window.addEventListener("touchmove",o),window.addEventListener("touchend",h)},[t,N,C.x,C.y,c,d]);return(0,a.useEffect)(()=>{let e=D.current;if(e)return e.addEventListener("touchstart",P,{passive:!1}),()=>{e.removeEventListener("touchstart",P)}},[P]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(A.p,{ref:L,size:y?{width:"100%",height:"100%"}:{width:c,height:d},position:y?{x:0,y:0}:C,onDragStart:()=>{if(z||y)return!1},onDrag:(e,t)=>{z||y||E({x:t.x,y:t.y})},onDragStop:u,onResize:m,onResizeStop:x,lockAspectRatio:f,enableResizing:!y&&j,disableDragging:y||w||z,className:(0,S.cn)("border border-dashed border-transparent transition-colors duration-200",{"hover:border-gray-500":!y&&s}),onClick:p,style:{zIndex:b},children:(0,l.jsx)("div",{style:{width:"100%",height:"100%",transform:"rotate(".concat(h,"deg)"),transformOrigin:"center"},children:(0,l.jsx)("div",{style:{width:"100%",height:"100%",backgroundImage:i?"url(".concat(i,")"):"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},title:n})})}),s&&!g&&!y&&(0,l.jsx)("div",{ref:D,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),R(!0);let l=null==(s=L.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let i=a.getBoundingClientRect(),n=i.left+C.x+c/2,r=i.top+C.y+d/2,o=e=>{let s=e.clientX-n;N(t,{rotation:180/Math.PI*Math.atan2(e.clientY-r,s)+90})},h=()=>{R(!1),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",h)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",h)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-50",style:{left:C.x+c/2,top:C.y-30,transform:"translateX(-50%)"},children:(0,l.jsx)(I.A,{className:"h-4 w-4"})})]})}),$=e=>{let{id:t,isSelected:s,shapeType:i,backgroundColor:n,borderColor:r,borderWidth:o,rotation:c,zIndex:d,onDragStop:h,onResize:u,onResizeStop:m,lockAspectRatio:x,enableResizing:p,disableDragging:g,x:v,y:f,width:j,height:w}=e,{updateLayer:y}=k(),[b,N]=(0,a.useState)({x:v||0,y:f||0}),[C,E]=(0,a.useState)(!1),S=(0,a.useRef)(null),z=(0,a.useRef)(null);(0,a.useEffect)(()=>{N({x:v||0,y:f||0})},[v,f]);let R=(0,a.useCallback)(e=>{var s;e.preventDefault(),e.stopPropagation(),E(!0);let l=null==(s=S.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let i=a.getBoundingClientRect(),n=i.left+b.x+j/2,r=i.top+b.y+w/2,o=e=>{if(0===e.touches.length)return;let s=e.touches[0].clientX-n;y(t,{rotation:180/Math.PI*Math.atan2(e.touches[0].clientY-r,s)+90})},c=()=>{E(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",c)};window.addEventListener("touchmove",o),window.addEventListener("touchend",c)},[t,y,b.x,b.y,j,w]);return(0,a.useEffect)(()=>{let e=z.current;if(e)return e.addEventListener("touchstart",R,{passive:!1}),()=>{e.removeEventListener("touchstart",R)}},[R]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(A.p,{ref:S,size:{width:j,height:w},position:b,onDragStart:()=>{if(C)return!1},onDrag:(e,t)=>{C||N({x:t.x,y:t.y})},onDragStop:h,onResize:u,onResizeStop:m,lockAspectRatio:x,enableResizing:p,disableDragging:g||C,className:"border border-dashed border-transparent hover:border-gray-500 transition-colors duration-200",style:{zIndex:d},children:(0,l.jsx)("div",{style:{width:"100%",height:"100%",transform:"rotate(".concat(c,"deg)"),transformOrigin:"center"},children:(()=>{let e={width:"100%",height:"100%",style:{overflow:"visible"}};switch(i){case"line":return(0,l.jsx)("svg",{...e,children:(0,l.jsx)("line",{x1:0,y1:w/2,x2:j,y2:w/2,stroke:r,strokeWidth:o})});case"arrow":return(0,l.jsxs)("svg",{...e,children:[(0,l.jsx)("defs",{children:(0,l.jsx)("marker",{id:"arrowhead-".concat(t),markerWidth:"10",markerHeight:"7",refX:"10",refY:"3.5",orient:"auto",fill:r,children:(0,l.jsx)("polygon",{points:"0 0, 10 3.5, 0 7"})})}),(0,l.jsx)("line",{x1:0,y1:w/2,x2:j-10,y2:w/2,stroke:r,strokeWidth:o,markerEnd:"url(#arrowhead-".concat(t,")")})]});default:return(0,l.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:n,border:"".concat(o,"px solid ").concat(r),borderRadius:"circle"===i?"50%":"0"}})}})()})}),s&&(0,l.jsx)("div",{ref:z,onMouseDown:e=>{var s;e.preventDefault(),e.stopPropagation(),E(!0);let l=null==(s=S.current)?void 0:s.getSelfElement();if(!l)return;let a=l.parentElement;if(!a)return;let i=a.getBoundingClientRect(),n=i.left+b.x+j/2,r=i.top+b.y+w/2,o=e=>{let s=e.clientX-n;y(t,{rotation:180/Math.PI*Math.atan2(e.clientY-r,s)+90})},c=()=>{E(!1),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",c)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",c)},className:"absolute cursor-grab active:cursor-grabbing bg-white border rounded-full p-1 shadow z-50",style:{left:b.x+j/2,top:b.y-30,transform:"translateX(-50%)"},children:(0,l.jsx)(I.A,{className:"h-4 w-4"})})]})};var T=s(57347),M=s(54654),J=s(94431),W=s(23191),O=s(28647),B=s(87727),X=s(58421),V=s(4307);let Y=()=>{let{layers:e,updateLayer:t,removeLayer:s,selectedLayerId:a,setSelectedLayerId:i,reorderLayers:n,duplicateLayer:o,moveLayerUp:c,moveLayerDown:d}=k();return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"レイヤー"}),(0,l.jsx)(X.F,{className:"h-[calc(100vh-250px)] w-full rounded-md border p-4",children:0===e.length?(0,l.jsx)("p",{className:"text-muted-foreground",children:"レイヤーがありません。"}):(0,l.jsx)(V.JY,{onDragEnd:e=>{e.destination&&n(e.source.index,e.destination.index)},children:(0,l.jsx)(V.gL,{droppableId:"layers",children:n=>(0,l.jsxs)("div",{...n.droppableProps,ref:n.innerRef,className:"space-y-2",children:[e.map((n,h)=>(0,l.jsx)(V.sx,{draggableId:n.id,index:h,children:(u,m)=>(0,l.jsxs)("div",{ref:u.innerRef,...u.draggableProps,...u.dragHandleProps,className:"flex items-center justify-between p-2 rounded-md border ".concat(a===n.id?"bg-accent":"bg-card"," ").concat(m.isDragging?"shadow-lg opacity-90 bg-blue-100":""),onClick:()=>i(n.id),children:[(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)("span",{className:"text-sm font-medium truncate w-24",children:n.name})}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(r.$,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),c(n.id)},disabled:0===h,children:(0,l.jsx)(T.A,{className:"h-4 w-4"})}),(0,l.jsx)(r.$,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),d(n.id)},disabled:h===e.length-1,children:(0,l.jsx)(M.A,{className:"h-4 w-4"})}),(0,l.jsx)(r.$,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),(s=>{var l;t(s,{visible:!(null==(l=e.find(e=>e.id===s))?void 0:l.visible)})})(n.id)},children:n.visible?(0,l.jsx)(J.A,{className:"h-4 w-4"}):(0,l.jsx)(W.A,{className:"h-4 w-4"})}),(0,l.jsx)(r.$,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),o(n.id)},children:(0,l.jsx)(O.A,{className:"h-4 w-4"})}),(0,l.jsx)(r.$,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),s(n.id)},children:(0,l.jsx)(B.A,{className:"h-4 w-4 text-red-500"})})]})]})},n.id)),n.placeholder]})})})})]})},_=["image/jpeg","image/jpg","image/png","image/webp"];function H(){let{isOpen:e,setIsOpen:t,isDesktop:s}=(0,h.c)({defaultOpen:!1,desktopDefaultOpen:!0}),[w,y]=a.useState("settings"),[b,N]=a.useState(!1),{handleAsyncError:C}=(0,u.u)(),{selectedTemplate:E,setSelectedTemplate:S,currentText:z,setCurrentText:R,layers:L,addLayer:A,updateLayer:I,selectedLayerId:T,setSelectedLayerId:M,aspectRatio:J,customAspectRatio:W}=k(),O=L.find(e=>e.id===T);a.useEffect(()=>{let e=e=>{"Shift"===e.key&&N(!0)},t=e=>{"Shift"===e.key&&N(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),a.useEffect(()=>{s?t(!0):t(!1)},[s]);let B=a.useCallback(async e=>{await C(async()=>{let t,s=document.getElementById("download-target");if(!s)throw Error("ダウンロード対象の要素が見つかりません");switch(e){case"normal":default:t=720;break;case"high":t=1080;break;case"super":t=2160}let l=16/9;if("custom"===J)W.width>0&&W.height>0&&(l=W.width/W.height);else{let[e,t]=J.split(":").map(Number);e>0&&t>0&&(l=e/t)}let a=Math.round(t*l),n=t,r=await (0,i.$E)(s,{cacheBust:!0,width:a,height:n}),o=document.createElement("a");o.download="creative_".concat(e,".png"),o.href=r,o.click()},"画像の生成に失敗しました")},[J,W,C]),X=a.useCallback((e,t,s)=>{I(e,{x:s.x,y:s.y})},[I]),V=a.useCallback((e,t,s,l,a)=>{I(e,{width:s.offsetWidth,height:s.offsetHeight,x:a.x,y:a.y})},[I]),H=e=>{let t=e.target.files;if(t){for(let e of Array.from(t)){if(e.size>0xa00000){n.oR.error("ファイルサイズが大きすぎます: ".concat(e.name),{description:"10MB以下のファイルを選択してください。"});continue}if(!_.includes(e.type)){n.oR.error("ファイル形式が無効です: ".concat(e.name),{description:"JPEG, PNG, WEBP形式の画像ファイルを選択してください。"});continue}let t=URL.createObjectURL(e);A({type:"image",name:e.name,visible:!0,locked:!1,x:s?550:50,y:s?250:50,width:s?300:150,height:s?300:150,src:t})}e.target.value=""}},U=e=>{let t=L.filter(e=>"shape"===e.type).length*(s?20:5),l=L.filter(t=>t.shapeType===e).length+1,a="",i=s?550:10,n=s?250:10,r=s?300:50,o=s?300:50,c=s?2:1,d=s?300:100,h=s?5:3;switch(e){case"rectangle":a="四角 ".concat(l);break;case"circle":a="円 ".concat(l);break;case"line":a="線 ".concat(l);break;case"arrow":a="矢印 ".concat(l)}A({type:"shape",shapeType:e,name:a,visible:!0,locked:!1,x:i+t,y:n+t,width:"line"===e||"arrow"===e?d:r,height:"line"===e||"arrow"===e?h:o,backgroundColor:"#cccccc",borderColor:"#000000",borderWidth:c})},q=()=>{A({type:"text",name:"テキスト ".concat(L.filter(e=>"text"===e.type).length+1),visible:!0,locked:!1,x:s?550:50,y:s?250:50,width:s?300:150,height:s?100:50,text:z,color:"#000000",fontSize:s?"2rem":"1rem"})};if(!E)return(0,l.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,l.jsx)("p",{children:"テンプレートを読み込み中..."})});let G=(0,l.jsxs)(x.tU,{value:w,onValueChange:y,className:"w-full",children:[(0,l.jsxs)(x.j7,{className:"grid w-full grid-cols-3",children:[(0,l.jsx)(x.Xi,{value:"settings",children:"テンプレート"}),(0,l.jsx)(x.Xi,{value:"tools",children:"ツール"}),(0,l.jsx)(x.Xi,{value:"layers",children:"レイヤー"})]}),(0,l.jsx)(x.av,{value:"settings",className:"mt-4",children:(0,l.jsx)(D,{onSelectTemplate:S,selectedTemplateId:E.id})}),(0,l.jsx)(x.av,{value:"tools",className:"mt-4",children:(0,l.jsxs)(j.nD,{type:"multiple",className:"w-full",defaultValue:["text"],children:[(0,l.jsxs)(j.As,{value:"text",children:[(0,l.jsx)(j.$m,{children:"テキスト"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"thumbnail-text",children:"テキスト内容"}),(0,l.jsx)(p.T,{id:"thumbnail-text",value:z,onChange:e=>R(e.target.value),className:"h-24"})]}),(0,l.jsx)("div",{className:"pt-4",children:(0,l.jsx)(r.$,{variant:"outline",className:"w-full",onClick:q,children:"テキストを追加"})})]})]}),(0,l.jsxs)(j.As,{value:"images",children:[(0,l.jsx)(j.$m,{children:"画像"}),(0,l.jsx)(j.ub,{className:"space-y-4 pt-4",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"add-images",children:"画像を追加"}),(0,l.jsx)(f.p,{id:"add-images",type:"file",accept:"image/*",multiple:!0,onChange:H})]})})]}),(0,l.jsxs)(j.As,{value:"shapes",children:[(0,l.jsx)(j.$m,{children:"図形"}),(0,l.jsx)(j.ub,{className:"space-y-4 pt-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)(r.$,{variant:"outline",onClick:()=>U("rectangle"),children:"四角を追加"}),(0,l.jsx)(r.$,{variant:"outline",onClick:()=>U("circle"),children:"円を追加"}),(0,l.jsx)(r.$,{variant:"outline",onClick:()=>U("line"),children:"線を追加"}),(0,l.jsx)(r.$,{variant:"outline",onClick:()=>U("arrow"),children:"矢印を追加"})]})})]}),(0,l.jsxs)(j.As,{value:"style",children:[(0,l.jsx)(j.$m,{children:"スタイル"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[!O&&(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"レイヤーを選択してください"}),(null==O?void 0:O.type)==="text"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"text-color",children:"テキストカラー"}),(0,l.jsx)("input",{id:"text-color",type:"color",value:O.color,onChange:e=>I(O.id,{color:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(v.J,{htmlFor:"font-size",children:["フォントサイズ (",O.fontSize,")"]}),(0,l.jsx)(g.A,{id:"font-size",min:1,max:8,step:.1,value:[parseFloat(O.fontSize||"1")],onValueChange:e=>I(O.id,{fontSize:"".concat(e[0],"rem")})})]})]}),(null==O?void 0:O.type)==="shape"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"shape-fill",children:"塗りつぶし"}),(0,l.jsx)("input",{id:"shape-fill",type:"color",value:O.backgroundColor,onChange:e=>I(O.id,{backgroundColor:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"shape-stroke",children:"枠線"}),(0,l.jsx)("input",{id:"shape-stroke",type:"color",value:O.borderColor,onChange:e=>I(O.id,{borderColor:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(v.J,{htmlFor:"shape-stroke-width",children:["枠線の太さ (",O.borderWidth,"px)"]}),(0,l.jsx)(g.A,{id:"shape-stroke-width",min:0,max:20,step:1,value:[O.borderWidth||0],onValueChange:e=>I(O.id,{borderWidth:e[0]})})]})]})]})]})]})}),(0,l.jsx)(x.av,{value:"layers",className:"mt-4",children:(0,l.jsx)(Y,{})})]}),Z=(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"テンプレート選択"})}),(0,l.jsx)(D,{onSelectTemplate:S,selectedTemplateId:E.id})]});return(0,l.jsxs)("div",{className:"relative flex flex-col lg:h-screen",children:[e&&!s&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>t(!1)}),(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row flex-grow lg:h-full lg:overflow-y-auto",children:[(0,l.jsxs)("main",{className:"flex-1 overflow-y-auto p-2 pt-20 lg:p-4 lg:pt-4",children:[(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{id:"thumbnail-preview",style:{aspectRatio:"custom"===J?"".concat(W.width," / ").concat(W.height):J.replace(":"," / ")},className:"w-full bg-card relative border rounded-md",children:(0,l.jsx)("div",{id:"download-target",className:"w-full h-full relative overflow-hidden",children:L.map(e=>{let t=e.id===T,s=t&&!e.locked,a=t&&!e.locked;return e.visible?"image"===e.type?(0,l.jsx)(F,{id:e.id,isSelected:t,src:e.src||"",alt:e.name,x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>X(e.id,t,s),onResize:(t,s,l,a,i)=>V(e.id,s,l,a,i),onResizeStop:(t,s,l,a,i)=>V(e.id,s,l,a,i),lockAspectRatio:b,enableResizing:a,disableDragging:!s,onSelect:()=>M(e.id),isLocked:e.locked,isDraggable:s,onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{},isBackground:e.isBackground,zIndex:e.zIndex},e.id):"text"===e.type?(0,l.jsx)(P,{id:e.id,isSelected:t,text:e.text||"",color:e.color||"#000000",fontSize:e.fontSize||"1rem",x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>X(e.id,t,s),onResizeStop:(t,s,l,a,i)=>V(e.id,s,l,a,i),enableResizing:a,disableDragging:!s,zIndex:e.zIndex},e.id):"shape"===e.type&&e.shapeType?(0,l.jsx)($,{id:e.id,isSelected:t,shapeType:e.shapeType,backgroundColor:e.backgroundColor||"#cccccc",borderColor:e.borderColor||"#000000",borderWidth:e.borderWidth||0,x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation,onDragStop:(t,s)=>X(e.id,t,s),onResize:(t,s,l,a,i)=>V(e.id,s,l,a,i),onResizeStop:(t,s,l,a,i)=>V(e.id,s,l,a,i),lockAspectRatio:b,enableResizing:a,disableDragging:!s,zIndex:e.zIndex},e.id):null:null})})}),(0,l.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,l.jsx)(r.$,{onClick:()=>B("normal"),size:"sm",children:"通常画質"}),(0,l.jsx)(r.$,{onClick:()=>B("high"),size:"sm",children:"高画質"}),(0,l.jsx)(r.$,{onClick:()=>B("super"),size:"sm",children:"最高画質"})]})]}),!s&&(0,l.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,l.jsx)("div",{className:"bg-card border rounded-lg p-4",children:(0,l.jsx)(j.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,l.jsxs)(j.As,{value:"tools",children:[(0,l.jsx)(j.$m,{children:(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"ツール"})}),(0,l.jsx)(j.ub,{className:"pt-4",children:(0,l.jsxs)(j.nD,{type:"multiple",className:"w-full",defaultValue:["text"],children:[(0,l.jsxs)(j.As,{value:"text",children:[(0,l.jsx)(j.$m,{children:"テキスト"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"thumbnail-text",children:"テキスト内容"}),(0,l.jsx)(p.T,{id:"thumbnail-text",value:z,onChange:e=>R(e.target.value),className:"h-24"})]}),(0,l.jsx)("div",{className:"pt-4",children:(0,l.jsx)(r.$,{variant:"outline",className:"w-full",onClick:q,children:"テキストを追加"})})]})]}),(0,l.jsxs)(j.As,{value:"images",children:[(0,l.jsx)(j.$m,{children:"画像"}),(0,l.jsx)(j.ub,{className:"space-y-4 pt-4",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"add-images",children:"画像を追加"}),(0,l.jsx)(f.p,{id:"add-images",type:"file",accept:"image/*",multiple:!0,onChange:H})]})})]}),(0,l.jsxs)(j.As,{value:"shapes",children:[(0,l.jsx)(j.$m,{children:"図形"}),(0,l.jsx)(j.ub,{className:"space-y-4 pt-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)(r.$,{variant:"outline",onClick:()=>U("rectangle"),children:"四角を追加"}),(0,l.jsx)(r.$,{variant:"outline",onClick:()=>U("circle"),children:"円を追加"}),(0,l.jsx)(r.$,{variant:"outline",onClick:()=>U("line"),children:"線を追加"}),(0,l.jsx)(r.$,{variant:"outline",onClick:()=>U("arrow"),children:"矢印を追加"})]})})]}),(0,l.jsxs)(j.As,{value:"style",children:[(0,l.jsx)(j.$m,{children:"スタイル"}),(0,l.jsxs)(j.ub,{className:"space-y-4 pt-4",children:[!O&&(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"レイヤーを選択してください"}),(null==O?void 0:O.type)==="text"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"text-color",children:"テキストカラー"}),(0,l.jsx)("input",{id:"text-color",type:"color",value:O.color,onChange:e=>I(O.id,{color:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(v.J,{htmlFor:"font-size",children:["フォントサイズ (",O.fontSize,")"]}),(0,l.jsx)(g.A,{id:"font-size",min:1,max:8,step:.1,value:[parseFloat(O.fontSize||"1")],onValueChange:e=>I(O.id,{fontSize:"".concat(e[0],"rem")})})]})]}),(null==O?void 0:O.type)==="shape"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"shape-fill",children:"塗りつぶし"}),(0,l.jsx)("input",{id:"shape-fill",type:"color",value:O.backgroundColor,onChange:e=>I(O.id,{backgroundColor:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(v.J,{htmlFor:"shape-stroke",children:"枠線"}),(0,l.jsx)("input",{id:"shape-stroke",type:"color",value:O.borderColor,onChange:e=>I(O.id,{borderColor:e.target.value}),className:"w-full h-10 rounded-md"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(v.J,{htmlFor:"shape-stroke-width",children:["枠線の太さ (",O.borderWidth,"px)"]}),(0,l.jsx)(g.A,{id:"shape-stroke-width",min:0,max:20,step:1,value:[O.borderWidth||0],onValueChange:e=>I(O.id,{borderWidth:e[0]})})]})]})]})]})]})})]})})}),(0,l.jsx)("div",{className:"bg-card border rounded-lg p-4",children:(0,l.jsx)(Y,{})})]})]}),!e&&(0,l.jsx)(m.R,{onOpen:()=>t(!0),isDesktop:s,tabs:[{id:"settings",label:"テンプレート",icon:(0,l.jsx)(o.A,{className:"h-4 w-4"})},{id:"tools",label:"ツール",icon:(0,l.jsx)(c.A,{className:"h-4 w-4"})},{id:"layers",label:"レイヤー",icon:(0,l.jsx)(d.A,{className:"h-4 w-4"})}],onTabClick:e=>{console.log("Tab clicked:",e)}}),(0,l.jsx)(m.B,{isOpen:e,onClose:()=>t(!1),title:"",isDesktop:s,className:"lg:w-1/4",children:s?G:Z})]})]})}function U(){return(0,l.jsx)(N,{children:(0,l.jsx)(H,{})})}},80318:(e,t,s)=>{Promise.resolve().then(s.bind(s,50811))}},e=>{e.O(0,[96,76,358],()=>e(e.s=80318)),_N_E=e.O()}]);